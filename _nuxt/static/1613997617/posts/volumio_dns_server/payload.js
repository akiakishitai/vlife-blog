__NUXT_JSONP__("/posts/volumio_dns_server", (function(a,b){return {data:[{posted:{filename:"volumio_dns_server.adoc",rendered:"\u003Cdiv id=\"toc\" class=\"toc\"\u003E\n\u003Cdiv id=\"toctitle\"\u003E目次\u003C\u002Fdiv\u003E\n\u003Cul class=\"sectlevel1\"\u003E\n\u003Cli\u003E\u003Ca href=\"#_はじめに\"\u003Eはじめに🧀\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_dnsmasq_設定\"\u003E\u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E 設定💻\u003C\u002Fa\u003E\n\u003Cul class=\"sectlevel2\"\u003E\n\u003Cli\u003E\u003Ca href=\"#_設定ファイル修正\"\u003E設定ファイル修正\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_上位dnsサーバーの設定\"\u003E上位DNSサーバーの設定\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_内部ホスト名\"\u003E内部ホスト名\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_dnsmasq_の自動起動オプションを修正\"\u003E\u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E の自動起動オプションを修正\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_広告ブロック\"\u003E広告ブロック🚫\u003C\u002Fa\u003E\n\u003Cul class=\"sectlevel2\"\u003E\n\u003Cli\u003E\u003Ca href=\"#_おわりに\"\u003Eおわりに😎\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"#_参考\"\u003E参考📖\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_はじめに\"\u003Eはじめに🧀\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E\u003Cem\u003EVolumio\u003C\u002Fem\u003E を音楽再生のためだけに常時稼働させているのがもったいないので、ついでに内部 \u003Cem\u003EDNS\u003C\u002Fem\u003E サーバーとしての役割も兼用してみる。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E基本的には \u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E で \u003Cem\u003EDNS\u003C\u002Fem\u003E サーバーを建てる方法と一緒。\u003Cbr\u003E\nただし、\u003Cem\u003EVolumio\u003C\u002Fem\u003E では \u003Ccode\u003Esystemd\u003C\u002Fcode\u003E ユニットの設定を修正する必要がある。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Ctable class=\"tableblock frame-all grid-all stretch\"\u003E\n\u003Ccaption class=\"title\"\u003ETable 1. 環境\u003C\u002Fcaption\u003E\n\u003Ccolgroup\u003E\n\u003Ccol style=\"width: 50%;\"\u003E\n\u003Ccol style=\"width: 50%;\"\u003E\n\u003C\u002Fcolgroup\u003E\n\u003Cthead\u003E\n\u003Ctr\u003E\n\u003Cth class=\"tableblock halign-left valign-top\"\u003ETool\u003C\u002Fth\u003E\n\u003Cth class=\"tableblock halign-left valign-top\"\u003EVersion\u003C\u002Fth\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Fthead\u003E\n\u003Ctbody\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"tableblock halign-left valign-top\"\u003E\u003Cp class=\"tableblock\"\u003ERaspberry Pi 3A\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\n\u003Ctd class=\"tableblock halign-left valign-top\"\u003E\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"tableblock halign-left valign-top\"\u003E\u003Cp class=\"tableblock\"\u003EVolumio\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\n\u003Ctd class=\"tableblock halign-left valign-top\"\u003E\u003Cp class=\"tableblock\"\u003E2.861\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftbody\u003E\n\u003C\u002Ftable\u003E\n\u003Cdiv class=\"admonitionblock note\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Ci class=\"fa icon-note\" title=\"Note\" data-md-icon=\"info\"\u003E\u003C\u002Fi\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\n\u003Cdiv class=\"title\"\u003Eテキストエディタ\u003C\u002Fdiv\u003E\n\u003Cem\u003EVolumio\u003C\u002Fem\u003E にインストールされているエディタは \u003Ccode\u003Evim\u003C\u002Fcode\u003E ではなく \u003Ccode\u003Enano\u003C\u002Fcode\u003E になる。\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_dnsmasq_設定\"\u003E\u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E 設定💻\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003EVolumioでは元から \u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E がインストール済みになっている。\u003Cbr\u003E\nよって \u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E の設定を編集して内部 \u003Cem\u003EDNS\u003C\u002Fem\u003E サーバーを実装する。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_設定ファイル修正\"\u003E設定ファイル修正\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E内部 \u003Cem\u003EDNS\u003C\u002Fem\u003E サーバー用に設定。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"admonitionblock important\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Ci class=\"fa icon-important\" title=\"Important\" data-md-icon=\"report\"\u003E\u003C\u002Fi\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\n\u003Cdiv class=\"title\"\u003E元の設定ファイルをバックアップ\u003C\u002Fdiv\u003E\n\u003Cdiv \n    class=\"listingblock no-line-numbers command-line\"\u003E\n\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight command-line\" data-user=\"volumio\"\n    data-host=\"volumio\"\n    \u003E\u003Ccode class=\"language-bash\"\n    data-lang=\"bash\"\u003Esudo cp \u002Fetc\u002Fdnsmasq.conf{,.bak}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"exampleblock\"\u003E\n\u003Cdiv class=\"title\"\u003EExample 1. \u002Fetc\u002Fdnsmasq.conf\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cdiv \n    class=\"listingblock\"\u003E\n\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight \" \u003E\u003Ccode class=\"language-ini\"\n    data-lang=\"ini\"\u003Edomain-needed   \u003Ci class=\"conum\" data-value=\"1\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(1)\u003C\u002Fb\u003E\nbogus-priv      \u003Ci class=\"conum\" data-value=\"2\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(2)\u003C\u002Fb\u003E\nno-resolv       \u003Ci class=\"conum\" data-value=\"3\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(3)\u003C\u002Fb\u003E\naddn-hosts=\u002Fetc\u002Fdnsmasq.hosts.d   \u003Ci class=\"conum\" data-value=\"4\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(4)\u003C\u002Fb\u003E\nexpand-hosts    \u003Ci class=\"conum\" data-value=\"5\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(5)\u003C\u002Fb\u003E\ndomain=my.homenet,192.168.100.0\u002F24,local  \u003Ci class=\"conum\" data-value=\"6\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(6)\u003C\u002Fb\u003E\ncache-size=0    \u003Ci class=\"conum\" data-value=\"7\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(7)\u003C\u002Fb\u003E\nconf-dir=\u002Fetc\u002Fdnsmasq.d,.conf     \u003Ci class=\"conum\" data-value=\"8\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(8)\u003C\u002Fb\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"colist arabic\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"1\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E1\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003Eドメインが指定されていない場合は上位ネームサーバーに問い合わせない。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"2\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E2\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Ccode\u003E\u002Fetc\u002Fhosts\u003C\u002Fcode\u003E や \u003Cem\u003EDHCP\u003C\u002Fem\u003E リースの範囲にないプライベートIPの逆引きを上位ネームサーバーに転送しない。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"3\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E3\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Ccode\u003E\u002Fetc\u002Fresolv.conf\u003C\u002Fcode\u003E ファイルを読み込まない。\u003Cbr\u003E\n上位 \u003Cem\u003EDNS\u003C\u002Fem\u003E サーバの指定は後述する \u003Ccode\u003Econf-dir\u003C\u002Fcode\u003E オプションのディレクトリ以下で指定する。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"4\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E4\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003E読み込む \u003Ccode\u003Ehosts\u003C\u002Fcode\u003E ファイルを追加する。\u003Cbr\u003E\nディレクトリパスを指定すると、そのディレクトリに含まれるすべてのファイルが読み込まれる。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"5\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E5\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Ccode\u003E\u002Fetc\u002Fhosts\u003C\u002Fcode\u003E に書かれたドメインなしのホスト名に、下記の \u003Ccode\u003Edomain\u003C\u002Fcode\u003E プロパティ値を付加する。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"6\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E6\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003E任意のローカルドメインと使用するローカルLANのIPアドレス範囲を指定。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"7\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E7\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003Eキャッシュを無効化（キャッシュポイズニング対策）。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"8\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E8\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003E追加で読み込みたい、他の設定ファイルがあるディレクトリパスとファイル拡張子を指定。\u003Cbr\u003E\n上位 \u003Cem\u003EDNS\u003C\u002Fem\u003E サーバーやブロックするドメインなどの設定は別ファイルにしたかったので記述した。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"admonitionblock caution\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Ci class=\"fa icon-caution\" title=\"Caution\" data-md-icon=\"local_fire_department\"\u003E\u003C\u002Fi\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\n\u003Cem\u003EHotspot\u003C\u002Fem\u003E 時に \u003Cem\u003EVolumio\u003C\u002Fem\u003E ドメイン名が変わるかも。\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E設定編集後は以下のコマンドでチェックする。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv \n    class=\"listingblock no-line-numbers command-line\"\u003E\n\u003Cdiv class=\"title\"\u003Ednsmasq設定のチェック\u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight command-line\" data-host=\"volumio\"\n    data-user=\"volumio\"\n    data-output=\"2\"\n    \u003E\u003Ccode class=\"language-bash\"\n    data-lang=\"bash\"\u003E\u002Fusr\u002Fsbin\u002Fdnsmasq --test\ndnsmasq: syntax check OK.\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_上位dnsサーバーの設定\"\u003E上位DNSサーバーの設定\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E\u003Ccode\u003Eresolv-file\u003C\u002Fcode\u003E プロパティで指定したファイルで上位DNSサーバーを指定する。\u003Cbr\u003E\n親ルーターとか \u003Cem\u003EGoogle\u003C\u002Fem\u003E や \u003Cem\u003ECloudflare\u003C\u002Fem\u003E の公開DNSとか。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"exampleblock\"\u003E\n\u003Cdiv class=\"title\"\u003EExample 2. \u002Fetc\u002Fdnsmasq.d\u002Fnameservers.conf\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cdiv \n    class=\"listingblock\"\u003E\n\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight \" \u003E\u003Ccode class=\"language-ini\"\n    data-lang=\"ini\"\u003E# Cloudflare DNS\nserver=1.1.1.1\nserver=1.0.0.1\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_内部ホスト名\"\u003E内部ホスト名\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E内部LANにあるホストに関しては短縮名だけ記述すればいい。\u003Cbr\u003E\n今までの設定により、短縮名だけでもローカルドメインを自動的に付与するようになっているため。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"exampleblock\"\u003E\n\u003Cdiv class=\"title\"\u003EExample 3. 内部LAN用のホスト名を指定\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cdiv \n    class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003E\u002Fetc\u002Fdnsmasq.hosts.d\u002Finternals\u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight \" \u003E\u003Ccode class=\"language-ini\"\n    data-lang=\"ini\"\u003E192.168.100.2                       volumio\n172.16.1.10   example01.other.net   example01\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_dnsmasq_の自動起動オプションを修正\"\u003E\u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E の自動起動オプションを修正\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E\u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E の \u003Ccode\u003Esystemd\u003C\u002Fcode\u003E ユニット設定を修正する。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E\u003Cem\u003EVolumio\u003C\u002Fem\u003E では \u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E の自動起動時に \u003Ccode\u003E--address=\u002F#\u002F192.168.xxx.1\u003C\u002Fcode\u003E オプションが付け加えられている。\u003Cbr\u003E\nこれによって \u003Ccode\u003E\u002Fetc\u002Fhosts\u003C\u002Fcode\u003E や \u003Cem\u003EDHCP\u003C\u002Fem\u003E から応答がない場合は、すべて \u003Ccode\u003E192.168.xxx.1\u003C\u002Fcode\u003E アドレスとして処理してしまう。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003Eこのオプションのせいで名前解決がうまくいかないので、以下の操作で取り除く。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"exampleblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cdiv \n    class=\"listingblock no-line-numbers command-line\"\u003E\n\u003Cdiv class=\"title\"\u003Eドロップインファイル用ディレクトリを作成\u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight command-line\" data-user=\"volumio\"\n    data-host=\"volumio\"\n    \u003E\u003Ccode class=\"language-bash\"\n    data-lang=\"bash\"\u003Esudo mkdir \u002Fetc\u002Fsystemd\u002Fsystem\u002Fdnsmasq.service.d\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv \n    class=\"listingblock\"\u003E\n\u003Cdiv class=\"title\"\u003E\u002Fetc\u002Fsystemd\u002Fsystem\u002Fdnsmasq.service.d\u002Foverride.conf\u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight \" \u003E\u003Ccode class=\"language-ini\"\n    data-lang=\"ini\"\u003E[Service]\nExecStart=  \u003Ci class=\"conum\" data-value=\"1\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(1)\u003C\u002Fb\u003E\nExecStart=\u002Fusr\u002Fsbin\u002Fdnsmasq -2 --interface=wlan0  \u003Ci class=\"conum\" data-value=\"2\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(2)\u003C\u002Fb\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"colist arabic\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"1\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E1\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Ccode\u003EExecStart\u003C\u002Fcode\u003E は置き換える前に空にする必要がある。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"2\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E2\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003E\u003Ccode\u003E--address=&#8230;&#8203;\u003C\u002Fcode\u003E オプションを削除した起動コマンド。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"admonitionblock caution\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd class=\"icon\"\u003E\n\u003Ci class=\"fa icon-caution\" title=\"Caution\" data-md-icon=\"local_fire_department\"\u003E\u003C\u002Fi\u003E\n\u003C\u002Ftd\u003E\n\u003Ctd class=\"content\"\u003E\n\u003Ccode\u003E--interface=\u003C\u002Fcode\u003E の値は各デバイスにより違うので注意する。\n\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv \n    class=\"listingblock no-line-numbers command-line\"\u003E\n\u003Cdiv class=\"title\"\u003Eユニットファイルをリロードして再起動\u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight command-line\" data-user=\"volumio\"\n    data-host=\"volumio\"\n    \u003E\u003Ccode class=\"language-bash\"\n    data-lang=\"bash\"\u003Esudo systemctl daemon-reload\nsudo systemctl restart dnsmasq\nsudo systemctl status dnsmasq\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E上記設定後、エラーなどがなければルーターが参照する \u003Cem\u003EDNS\u003C\u002Fem\u003E サーバーを \u003Cem\u003EVolumio\u003C\u002Fem\u003E のIPアドレスに変更しておく。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_広告ブロック\"\u003E広告ブロック🚫\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E必要なら広告ドメインのブロックも行っておく。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E広告のドメインに対して \u003Cem\u003ENXDOMAIN\u003C\u002Fem\u003E を返すようにすればいい。\u003Cbr\u003E\nよって \u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E 設定の \u003Ccode\u003Eaddress\u003C\u002Fcode\u003E オプションにて、 \u003Ccode\u003Eaddress=\u002Fad.domain\u002F\u003C\u002Fcode\u003E というようにIPアドレスを指定しなければいい。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"exampleblock\"\u003E\n\u003Cdiv class=\"title\"\u003EExample 4. \u002Fetc\u002Fdnsmasq.d\u002Fadblock-sample.conf\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cdiv \n    class=\"listingblock\"\u003E\n\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight \" \u003E\u003Ccode class=\"language-ini\"\n    data-lang=\"ini\"\u003Eaddress=\u002Fad.hoge.com\u002F\naddress=\u002Fads.hoge.com\u002F\naddress=\u002Fads-foo.bar.com\u002F\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E今回は\u003Ca href=\"https:\u002F\u002F280blocker.net\" target=\"_blank\" rel=\"noopener\"\u003E280blocker\u003C\u002Fa\u003Eさんの広告ドメインリストを利用させてもらった。\u003Cbr\u003E\nこの場合、リストファイルがBOM付きUTF-8の改行コードCRLFなので、BOM無し改行LFに変換しておく必要がある。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"exampleblock\"\u003E\n\u003Cdiv class=\"content\"\u003E\n\u003Cdiv \n    class=\"listingblock no-line-numbers command-line\"\u003E\n\u003Cdiv class=\"title\"\u003E広告ドメインリストを取得し、dnsmasq設定ファイルに変換\u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight command-line\" data-user=\"volumio\"\n    data-host=\"volumio\"\n    data-output=\"3\"\n    \u003E\u003Ccode class=\"language-bash\"\n    data-lang=\"bash\"\u003Ecurl -Ss -o 280blocker.txt \\\n  \"https:\u002F\u002F280blocker.net\u002Ffiles\u002F280blocker_domain_$(date +'%Y%m').txt\"\n\ntail --byte=+4 280blocker.txt |    \u003Ci class=\"conum\" data-value=\"1\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(1)\u003C\u002Fb\u003E\n  sed \"s\u002F\\r\u002F\u002Fg\" |   \u003Ci class=\"conum\" data-value=\"2\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(2)\u003C\u002Fb\u003E\n  sed -E \"s@(^[a-zA-Z0-9].+)@address=\u002F\\1\u002F@g\" |  \u003Ci class=\"conum\" data-value=\"3\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E(3)\u003C\u002Fb\u003E\n  sudo tee \u002Fetc\u002Fdnsmasq.d\u002F280blocker.conf &gt; \u002Fdev\u002Fnull\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"colist arabic\"\u003E\n\u003Ctable\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"1\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E1\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003Eファイルから \u003Cem\u003EBOM\u003C\u002Fem\u003E を削除。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"2\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E2\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003Eファイルの改行コードを \u003Cem\u003ECRLF\u003C\u002Fem\u003E から \u003Cem\u003ELF\u003C\u002Fem\u003E に変換。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Ci class=\"conum\" data-value=\"3\"\u003E\u003C\u002Fi\u003E\u003Cb\u003E3\u003C\u002Fb\u003E\u003C\u002Ftd\u003E\n\u003Ctd\u003Eドメインリストを \u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E の設定プロパティ（\u003Ccode\u003Eaddress=\u002F&lt;domain&gt;\u002F\u003C\u002Fcode\u003E）に変換。\u003C\u002Ftd\u003E\n\u003C\u002Ftr\u003E\n\u003C\u002Ftable\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E設定終了したら \u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E を再起動。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv \n    class=\"listingblock no-line-numbers command-line\"\u003E\n\n  \u003Cdiv class=\"content\"\u003E\n  \u003Cpre class=\"highlight command-line\" data-user=\"volumio\"\n    data-host=\"volumio\"\n    \u003E\u003Ccode class=\"language-bash\"\n    data-lang=\"bash\"\u003Esudo systemctl restart dnsmasq\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n  \u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect2\"\u003E\n\u003Ch3 id=\"_おわりに\"\u003Eおわりに😎\u003C\u002Fh3\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003E最初 \u003Ccode\u003Evim\u003C\u002Fcode\u003E を使おうとしてなかったのと、\u003Ccode\u003Ednsmasq\u003C\u002Fcode\u003E の起動オプションになかなか気づけなかったところで詰まってた。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"paragraph\"\u003E\n\u003Cp\u003Eとりあえずこれで \u003Cem\u003EVolumio\u003C\u002Fem\u003E 兼 \u003Cem\u003EDNS\u003C\u002Fem\u003E サーバーなのでエコと言い張れるはず。\u003C\u002Fp\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"sect1\"\u003E\n\u003Ch2 id=\"_参考\"\u003E参考📖\u003C\u002Fh2\u003E\n\u003Cdiv class=\"sectionbody\"\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cdiv class=\"title\"\u003Ednsmasq\u003C\u002Fdiv\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fwiki.archlinux.jp\u002Findex.php\u002FDnsmasq\" target=\"_blank\" rel=\"noopener\"\u003Ednsmasq - ArchWiki\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fmanpages.ubuntu.com\u002Fmanpages\u002Fbionic\u002Fman8\u002Fdnsmasq.8.html\" target=\"_blank\" rel=\"noopener\"\u003EUbuntu Manpage: dnsmasq - A lightweight DHCP and caching DNS server.\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cdiv class=\"title\"\u003Esystemd\u003C\u002Fdiv\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgihyo.jp\u002Fadmin\u002Fserial\u002F01\u002Fubuntu-recipe\u002F0598?page=1\" target=\"_blank\" rel=\"noopener\"\u003E第598回　systemdユニットの設定を変える：Ubuntu Weekly Recipe｜gihyo.jp … 技術評論社\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003Cdiv class=\"ulist\"\u003E\n\u003Cdiv class=\"title\"\u003E\u002Fetc\u002Fhosts\u003C\u002Fdiv\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Faccess.redhat.com\u002Fja\u002Fsolutions\u002F2312031\" target=\"_blank\" rel=\"noopener\"\u003ERHEL クラスターノードに \u002Fetc\u002Fhosts ファイルを設定する - Red Hat Customer Portal\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E",title:"Volumioで内部DNSサーバーも兼用する",created_at:b,tags:["volumio","raspberrypi","dns","dnsmasq"],updated_at:b,author:"秋々すすき",description:a,revision:"1.0",revision_remark:a},navi:{next:{path:"\u002Fposts\u002Fnuxt_routing_extend",title:"Nuxtで独自のルーティングを追加・拡張する"},prev:{path:"\u002Fposts\u002Fgithub_actions_annotation",title:"GitHub ワークフローにおいて発生したエラーを Problem Matcher でアノテーションする"}},currentPath:"https:\u002F\u002Fvlike-vlife.netlify.app\u002Fposts\u002Fvolumio_dns_server"}],fetch:[],mutations:a}}(void 0,"2021-02-03")));