{"filename":"vscode_remote_container_command.adoc","rendered":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">目次</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_はじめに\">はじめに🤔</a></li>\n<li><a href=\"#_各プロパティの実行タイミング\">各プロパティの実行タイミング🏄</a></li>\n<li><a href=\"#_おわりに\">おわりに🐾</a></li>\n<li><a href=\"#_参考\">参考📖</a></li>\n</ul>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_はじめに\">はじめに🤔</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><em>VS Code</em> 拡張機能の <em>Remote Containers</em> を使ったときにコンテナ内でコマンド実行させるには <code>postCreateCommand</code>, <code>postStartCommand</code>, <code>postAttachCommand</code> プロパティで指定すればいい。<br>\nが、<a href=\"https://code.visualstudio.com/docs/remote/devcontainerjson-reference\" target=\"_blank\" rel=\"noopener\">devcontainer.jsonのリファレンス</a>を見ても、実際にどのタイミングで実行されるのかいまいち分からなかったのでメモ。</p>\n</div>\n<div class=\"paragraph\">\n<p>なお下記バージョンでの確認であることに注意。<br>\nGitHubのIssue見てると実行タイミングについて変更されているので、今後のバージョンによって変わることは十分ありえる。</p>\n</div>\n<table class=\"tableblock frame-all grid-all fit-content\">\n<caption class=\"title\">Table 1. 環境</caption>\n<colgroup>\n<col>\n<col>\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">App</th>\n<th class=\"tableblock halign-left valign-top\">Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">VS Code</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">1.52.1</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Remote-Containers</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">0.154.1</p></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_各プロパティの実行タイミング\">各プロパティの実行タイミング🏄</h2>\n<div class=\"sectionbody\">\n<details>\n<summary class=\"title\">テスト用に <code>devcontainer.json</code> ファイルを書いて確認した結果が以下の表。</summary>\n<div class=\"content\">\n<div \n    class=\"listingblock\">\n<div class=\"title\">.devcontainer/devcontainer.json</div>\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-json\"\n    data-lang=\"json\">{\n  \"name\": \"Test for devcontainer\",\n  \"image\": \"alpine:3.12\",\n  \"extensions\": [\"mhutchie.git-graph\"],\n\n  \"postAttachCommand\": \"echo '---Attach---'\",\n  \"postCreateCommand\": \"echo '---Create---'\",\n  \"postStartCommand\": \"echo '--Start---'\"\n}</code></pre>\n  </div>\n</div>\n</div>\n</details>\n<table class=\"tableblock frame-all grid-all fit-content\">\n<caption class=\"title\">Table 2. コンテナ内でのコマンド実行</caption>\n<colgroup>\n<col>\n<col>\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">Property</th>\n<th class=\"tableblock halign-left valign-top\">Desc</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><code>postCreateCommand</code></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">コンテナ作成後、<em>dotfiles</em> や拡張機能のインストール前に実行される。<br>\nコンテナ作成時の1回のみ実行される。</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><code>postStartCommand</code></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">VS Code Server 接続後に実行される。<br>\n拡張機能以外のコンテナ設定が終わった後に実行される。<br>\nリモート接続するたびに実行される。</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><code>postAttachCommand</code></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><code>postStartCommand</code> の後に実行される。<br>\n拡張機能のインストールと並列実行されている。<br>\nリモート接続するたびに実行される。</p></td>\n</tr>\n</tbody>\n</table>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-note\" title=\"Note\" data-md-icon=\"info\"></i>\n</td>\n<td class=\"content\">\n各コマンドは <code>remoteUser</code> によって実行される（デフォルトは <code>root</code> ）。\n</td>\n</tr>\n</table>\n</div>\n<div class=\"imageblock kroki\">\n<div class=\"content\">\n<span class=\"alt\">Remote Containers 実行フロー</span>\n</div>\n<div class=\"title\">Figure 1. Remote Containers 実行フロー</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_おわりに\">おわりに🐾</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>とりあえず <code>postCreateCommand</code> を使っておけば大丈夫かと思ったけど、意外とそうでもなかった。</p>\n</div>\n<div class=\"paragraph\">\n<p>コマンドを1度だけ実行したいのか、毎回実行したいのかで使い分ける必要がわかってよかった。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\">参考📖</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://code.visualstudio.com/docs/remote/devcontainerjson-reference\" target=\"_blank\" rel=\"noopener\">devcontainer.json reference</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","title":"VSCode拡張機能 Remote Containers におけるpostCreateCommandなどの実行タイミングについて","created_at":"2021-01-06","tags":["vscode","remote-containers","devcontainer.json"],"updated_at":"2021-01-06","author":"秋々すすき","revision":"1.0"}