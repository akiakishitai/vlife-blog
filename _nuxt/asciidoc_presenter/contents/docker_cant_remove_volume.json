{
  "filename": "docker_cant_remove_volume.adoc",
  "rendered": [
    "<div id=\"toc\" class=\"toc\">",
    "<div id=\"toctitle\">目次</div>",
    "<ul class=\"sectlevel1\">",
    "<li><a href=\"#_原因\">原因🥢</a></li>",
    "<li><a href=\"#_対処方法\">対処方法🍣</a></li>",
    "<li><a href=\"#_参考\">参考📖</a></li>",
    "</ul>",
    "</div>",
    "<div id=\"preamble\">",
    "<div class=\"sectionbody\">",
    "<table class=\"tableblock frame-all grid-all stretch\">",
    "<caption class=\"title\">Table 1. 環境</caption>",
    "<colgroup>",
    "<col style=\"width: 50%;\">",
    "<col style=\"width: 50%;\">",
    "</colgroup>",
    "<thead>",
    "<tr>",
    "<th class=\"tableblock halign-left valign-top\">App</th>",
    "<th class=\"tableblock halign-left valign-top\">Version</th>",
    "</tr>",
    "</thead>",
    "<tbody>",
    "<tr>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Windows 10</p></td>",
    "<td class=\"tableblock halign-left valign-top\"></td>",
    "</tr>",
    "<tr>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Docker Desktop</p></td>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">3.2.2</p></td>",
    "</tr>",
    "<tr>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">PowerShell</p></td>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">7.1.2</p></td>",
    "</tr>",
    "</tbody>",
    "</table>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_原因\">原因🥢</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p>エラーメッセージ通り。<br>",
    "その <em>Volume</em> を使用しているコンテナがまだ削除されずに残っていることが原因。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>自分の場合は停止状態（ <em>exited</em> ）のままコンテナが残っていたせいだった。</p>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_対処方法\">対処方法🍣</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p>次のコマンドを実行して、停止状態のコンテナを削除すればいい。</p>",
    "</div>",
    "<div class=\"exampleblock\">",
    "<div class=\"title\">Example 1. 停止状態のコンテナすべてを削除したあとに volume を削除</div>",
    "<div class=\"content\">",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-prompt=\"PS C:\\&gt;\"",
    "    ><code class=\"language-powershell\"",
    "    data-lang=\"powershell\">docker container prune --force &amp;&amp;   <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>",
    "  docker volume rm &lt;volume name&gt;</code></pre>",
    "  </div>",
    "</div>",
    "<div class=\"colist arabic\">",
    "<table>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>",
    "<td>停止状態のコンテナすべてを削除する。</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>また、削除すべきコンテナを絞り込むこともできる。<br>",
    "下記のように <code>--filter</code> オプションを利用して、<em>volume</em> をマウントしているコンテナのみを抽出して削除する。</p>",
    "</div>",
    "<div class=\"exampleblock\">",
    "<div class=\"title\">Example 2. 対象の volume をマウントしているコンテナだけを削除</div>",
    "<div class=\"content\">",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-prompt=\"PS C:\\&gt;\"",
    "    data-output=\"2\"",
    "    ><code class=\"language-powershell\"",
    "    data-lang=\"powershell\">$target = 'target-volume-name'  <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>",
    "",
    "docker ps -a --quiet --filter \"status=exited\" --filter \"volume=$target\" |   <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>",
    "  %{ docker container rm $_ } &amp;&amp;   <i class=\"conum\" data-value=\"3\"></i><b>(3)</b>",
    "  docker volume rm $target</code></pre>",
    "  </div>",
    "</div>",
    "<div class=\"colist arabic\">",
    "<table>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>",
    "<td>削除したい <em>volume</em> の名前。</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>",
    "<td>停止状態かつ対象の <em>volume</em> をマウントしているコンテナのIDを抽出。</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>",
    "<td>抽出されたコンテナを削除。</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"admonitionblock tip\">",
    "<table>",
    "<tr>",
    "<td class=\"icon\">",
    "<i class=\"fa icon-tip\" title=\"Tip\" data-md-icon=\"emoji_objects\"></i>",
    "</td>",
    "<td class=\"content\">",
    "<code>docker container prune</code> コマンドでは現在のところ、 <em>volume</em> についてフィルタリングできない（<a href=\"https://docs.docker.com/engine/reference/commandline/container_prune/#filtering\" target=\"_blank\" rel=\"noopener\">Docker Documentation</a>）。",
    "</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_参考\">参考📖</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"ulist\">",
    "<ul>",
    "<li>",
    "<p><a href=\"https://stackoverflow.com/questions/34658836/docker-is-in-volume-in-use-but-there-arent-any-docker-containers\" target=\"_blank\" rel=\"noopener\">Docker is in volume in use, but there aren&#8217;t any Docker containers - Stack Overflow</a></p>",
    "</li>",
    "<li>",
    "<p><a href=\"https://docs.docker.com/engine/reference/commandline/ps/\" target=\"_blank\" rel=\"noopener\">docker ps | Docker Documentation</a></p>",
    "</li>",
    "</ul>",
    "</div>",
    "</div>",
    "</div>"
  ],
  "title": "docker volume rm コマンド実行時に「volume is in use」と言われて削除できないときの対処方法",
  "created_at": "2021-04-14",
  "tags": [
    "docker",
    "備忘録"
  ],
  "updated_at": "2021-04-14",
  "author": "秋々すすき",
  "revision": "1.1"
}