{
  "filename": "git_credential_windows.adoc",
  "rendered": [
    "<div id=\"toc\" class=\"toc\">",
    "<div id=\"toctitle\">目次</div>",
    "<ul class=\"sectlevel1\">",
    "<li><a href=\"#_はじめに\">はじめに📌</a>",
    "<ul class=\"sectlevel2\">",
    "<li><a href=\"#_やったこと\">やったこと</a></li>",
    "</ul>",
    "</li>",
    "<li><a href=\"#_個人アクセストークンの利用方法\">個人アクセストークンの利用方法🔑</a></li>",
    "<li><a href=\"#_git_の_credential_helper\">Git の credential helper 🔐</a>",
    "<ul class=\"sectlevel2\">",
    "<li><a href=\"#_credential_helperがうまく設定されない場合\">credential.helperがうまく設定されない場合</a></li>",
    "</ul>",
    "</li>",
    "<li><a href=\"#_windows資格情報マネージャーへの登録\">Windows資格情報マネージャーへの登録🗃️</a>",
    "<ul class=\"sectlevel2\">",
    "<li><a href=\"#_powershell_から登録する\">PowerShell から登録する</a>",
    "<ul class=\"sectlevel3\">",
    "<li><a href=\"#_登録した資格情報の確認\">登録した資格情報の確認</a></li>",
    "<li><a href=\"#_資格情報の削除\">資格情報の削除</a></li>",
    "</ul>",
    "</li>",
    "<li><a href=\"#_guiで登録する場合\">GUIで登録する場合</a></li>",
    "</ul>",
    "</li>",
    "<li><a href=\"#_おわりに\">おわりに😎</a></li>",
    "<li><a href=\"#_参考\">参考📖</a></li>",
    "</ul>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_はじめに\">はじめに📌</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p><em>GitHub</em> はHTTPプロトコルにおけるパスワード認証を廃止して個人アクセストークン認証への切り替えを推奨している（<a href=\"https://github.blog/2020-12-15-token-authentication-requirements-for-git-operations/\" target=\"_blank\" rel=\"noopener\">参考</a>）。<br>",
    "今までは主にSSH認証を使っていたけど、この際だから推奨されている <em>個人アクセストークン認証 over HTTPS</em> に切り替えることにした。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>とはいえ <code>git</code> 操作のたびにユーザ名や個人アクセストークンを入力するのは面倒なので、自動的に認証するよう設定を行う。</p>",
    "</div>",
    "<table class=\"tableblock frame-all grid-all fit-content\">",
    "<caption class=\"title\">Table 1. 環境</caption>",
    "<colgroup>",
    "<col>",
    "<col>",
    "</colgroup>",
    "<thead>",
    "<tr>",
    "<th class=\"tableblock halign-left valign-top\">App</th>",
    "<th class=\"tableblock halign-left valign-top\">Version</th>",
    "</tr>",
    "</thead>",
    "<tbody>",
    "<tr>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Windows10</p></td>",
    "<td class=\"tableblock halign-left valign-top\"></td>",
    "</tr>",
    "<tr>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">git</p></td>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">2.27.0.windows.1</p></td>",
    "</tr>",
    "<tr>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">PowerShell</p></td>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">7.0.3</p></td>",
    "</tr>",
    "</tbody>",
    "</table>",
    "<div class=\"sect2\">",
    "<h3 id=\"_やったこと\">やったこと</h3>",
    "<div class=\"imageblock kroki\">",
    "<div class=\"content\">",
    "<img src=\"_images/flow-1071868ee58a6c63be5fb7234052d217fb469931.svg\" alt=\"flow\">",
    "</div>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>個人アクセストークンを作成した後、次のコマンドを叩いたら設定終わり。</p>",
    "</div>",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "<div class=\"title\">Git認証・Windows資格情報の設定</div>",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-prompt=\"PS C:\\workspace&gt;\"",
    "    data-output=\"2,7\"",
    "    ><code class=\"language-powershell\"",
    "    data-lang=\"powershell\">git config --global credential.helper wincred",
    "",
    "$cred = Get-Credential -Credential <em>YOUR_GITHUB_USERNAME</em>",
    "cmdkey /generic:git:https://github.com `",
    "  /user:$($cred.UserName) `",
    "  /pass:$($cred.GetNetworkCredential().Password)",
    "",
    "Remove-Variable cred</code></pre>",
    "  </div>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_個人アクセストークンの利用方法\">個人アクセストークンの利用方法🔑</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p>使うときは単純にパスワードとして個人アクセストークンの値を入力すればいいみたい。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>個人アクセストークンの作成方法については<a href=\"https://docs.github.com/ja/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token\" target=\"_blank\" rel=\"noopener\">公式リファレンス</a>を参考。<br>",
    "スコープはとりあえず <code>repo</code> にチェックしておけばよいかと。</p>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_git_の_credential_helper\">Git の credential helper 🔐</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p>GitではHTTPプロトコルを利用する場合の認証情報を保存するための仕組みが有り、<code>credential.helper</code> オプションで設定する。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>今回はWindows環境なので <code>wincred</code> を使い、Windowsの資格情報マネージャーで認証を管理する。</p>",
    "</div>",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "<div class=\"title\">gitの認証ツールとしてwincredを利用する</div>",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-prompt=\"PS C:\\workspace&gt;\"",
    "    ><code class=\"language-powershell\"",
    "    data-lang=\"powershell\">git config --global credential.helper wincred</code></pre>",
    "  </div>",
    "</div>",
    "<div class=\"admonitionblock note\">",
    "<table>",
    "<tr>",
    "<td class=\"icon\">",
    "<i class=\"fa icon-note\" title=\"Note\" data-md-icon=\"info\"></i>",
    "</td>",
    "<td class=\"content\">",
    "<div class=\"title\">定番の認証ツール</div>",
    "<div class=\"dlist\">",
    "<dl>",
    "<dt class=\"hdlist1\">Windows</dt>",
    "<dd>",
    "<p>Windows資格情報を利用する <code>wincred</code></p>",
    "</dd>",
    "<dt class=\"hdlist1\">MacOS</dt>",
    "<dd>",
    "<p><code>osxkeychain</code></p>",
    "</dd>",
    "<dt class=\"hdlist1\">Linux</dt>",
    "<dd>",
    "<p>調べてみたところではみんなまちまちっぽい。<br>",
    "<code>cache</code> でメモリに短時間保存する、または <a href=\"https://github.com/microsoft/Git-Credential-Manager-Core\" target=\"_blank\" rel=\"noopener\">Git Credential Manager Core</a> を使ってGPG暗号化して管理するのが主流？</p>",
    "</dd>",
    "</dl>",
    "</div>",
    "</td>",
    "</tr>",
    "</table>",
    "</div>",
    "<div class=\"sect2\">",
    "<h3 id=\"_credential_helperがうまく設定されない場合\">credential.helperがうまく設定されない場合</h3>",
    "<div class=\"paragraph\">",
    "<p>自分の場合は <code>~/.gitcofig</code> ファイルに <code>[credential \"helperselector\"]</code> が設定されていたので、これを削除して改めて <code>wincred</code> を設定した。</p>",
    "</div>",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-prompt=\"PS C:\\workspace&gt;\"",
    "    ><code class=\"language-powershell\"",
    "    data-lang=\"powershell\">git config --global --unset credential.helperselector.selected",
    "git config --global credential.helper wincred</code></pre>",
    "  </div>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_windows資格情報マネージャーへの登録\">Windows資格情報マネージャーへの登録🗃️</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p><code>credential.helperselector</code> を上記で設定していれば、最初の <code>git</code> 操作時に認証情報の入力を求められて自動的に保存される。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>以下はその最初の入力をコマンドやGUIから能動的にやる方法。<br>",
    "なので必須作業ではないです。</p>",
    "</div>",
    "<div class=\"sect2\">",
    "<h3 id=\"_powershell_から登録する\">PowerShell から登録する</h3>",
    "<div class=\"paragraph\">",
    "<p><a href=\"https://docs.microsoft.com/ja-jp/windows-server/administration/windows-commands/cmdkey\" target=\"_blank\" rel=\"noopener\"><code>cmdkey</code> コマンド</a>を使えば <em>PowerShell</em> から登録できる。<br>",
    "今回は <em>GitHub</em> の認証情報を登録していく。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>一応セキュリティを考慮して、個人アクセストークンを平文で扱うことは避け、<a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/get-credential?view=powershell-7.1\" target=\"_blank\" rel=\"noopener\"><code>Get-Credential</code> コマンドレット</a>により暗号化してから扱うことにした。</p>",
    "</div>",
    "<div class=\"exampleblock\">",
    "<div class=\"title\">Example 1. GitHubのユーザ名と個人アクセストークンを資格情報に登録する</div>",
    "<div class=\"content\">",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-prompt=\"PS C:\\workspace&gt;\"",
    "    data-output=\"1,3-8,12-13\"",
    "    ><code class=\"language-powershell\"",
    "    data-lang=\"powershell\"><i class=\"conum\" data-value=\"1\"></i><b>(1)</b>",
    "$cred = Get-Credential -Credential YOUR_GITHUB_USERNAME",
    "",
    "PowerShell credential request",
    "Enter your credentials.",
    "Password for user YOUR_GITHUB_USERNAME: *****  <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>",
    "",
    "<i class=\"conum\" data-value=\"3\"></i><b>(3)</b>",
    "cmdkey /generic:git:https://github.com `",
    "  /user:$($cred.UserName) `",
    "  /pass:$($cred.GetNetworkCredential().Password)",
    "",
    "<i class=\"conum\" data-value=\"4\"></i><b>(4)</b>",
    "Remove-Variable cred</code></pre>",
    "  </div>",
    "</div>",
    "<div class=\"colist arabic\">",
    "<table>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>",
    "<td><em>GitHub</em> の認証情報を変数 <code>$cred</code> に保存する。<br>",
    "<code>YOUR_GITHUB_USERNAME</code> はそれぞれ自分の <em>GitHub</em> ユーザ名に修正する。</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>",
    "<td>ここで個人アクセストークンを入力する。これは暗号化される。</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>",
    "<td><code>cmdkey</code> コマンドで汎用資格情報に登録する。<br>",
    "今回は <em>GitHub</em> を対象にするので、ターゲットを <code>git:https://github.com</code> とする。</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"4\"></i><b>4</b></td>",
    "<td>必要なくなった変数 <code>$cred</code> を削除。</td>",
    "</tr>",
    "</table>",
    "</div>",
    "<div class=\"admonitionblock tip\">",
    "<table>",
    "<tr>",
    "<td class=\"icon\">",
    "<i class=\"fa icon-tip\" title=\"Tip\" data-md-icon=\"emoji_objects\"></i>",
    "</td>",
    "<td class=\"content\">",
    "<div class=\"title\">変数展開の仕方について</div>",
    "<code>cmdkey</code> はうまく <em>PowerShell</em> 変数オブジェクトをあつかえない。<br>",
    "よって変数 <code>$cred</code> がコマンドに渡される前に変数展開させておく必要がある。<br>",
    "このため変数展開には部分式（ <code>$($&#8230;&#8203;)</code> ）を使うことで先行評価させている（参考: <a href=\"https://tech.guitarrapc.com/entry/2015/01/17/073225\" target=\"_blank\" rel=\"noopener\">PowerShell のString評価の方法と罠</a>）。",
    "</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p><code>Get-Credential</code> コマンドレットを実行したとき、環境によってはCLIの代わりに次のようなダイアログが出る。<br>",
    "このときもパスワード欄に個人アクセストークンを入力すればいい。<br>",
    "<span class=\"image\"><img src=\"_images/windows/credential/powershell-credential_input.png\" alt=\"資格情報入力ダイアログ\"></span></p>",
    "</div>",
    "<hr>",
    "<div class=\"paragraph\">",
    "<p>以上で <code>git</code> 利用時の <em>GitHub</em> 認証情報が登録された。<br>",
    "これによりプライベートリポジトリをクローンするときなどで、毎回ユーザ名・パスワードを入力する手間が省ける。</p>",
    "</div>",
    "<div class=\"sect3\">",
    "<h4 id=\"_登録した資格情報の確認\">登録した資格情報の確認</h4>",
    "<div class=\"paragraph\">",
    "<p>資格情報マネージャーに登録された <em>Git</em> の認証情報を確認したい場合は <code>cmdkey /list:&lt;TARGET_NAME&gt;</code> コマンドで一覧表示できる。</p>",
    "</div>",
    "<div class=\"exampleblock\">",
    "<div class=\"title\">Example 2. 登録されているgit資格情報の一覧確認</div>",
    "<div class=\"content\">",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-prompt=\"PS C:\\workspace&gt;\"",
    "    data-output=\"2-6\"",
    "    ><code class=\"language-powershell\"",
    "    data-lang=\"powershell\">cmdkey /list:git:http*",
    "",
    "    ターゲット: git:https://github.com",
    "    種類: 汎用",
    "    ユーザー: <em>YOUR_GITHUB_USERNAME</em>",
    "    ローカル コンピューターの常設</code></pre>",
    "  </div>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect3\">",
    "<h4 id=\"_資格情報の削除\">資格情報の削除</h4>",
    "<div class=\"paragraph\">",
    "<p>間違えた資格情報を登録してしまったときなど、削除するには <code>cmdkey /delete:&lt;TARGET_NAME&gt;</code> コマンドを使う。</p>",
    "</div>",
    "<div class=\"exampleblock\">",
    "<div class=\"title\">Example 3. GutHubの資格情報を削除</div>",
    "<div class=\"content\">",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-prompt=\"PS C:\\workspace&gt;\"",
    "    data-output=\"2-3\"",
    "    ><code class=\"language-powershell\"",
    "    data-lang=\"powershell\">cmdkey /delete:git:https://github.com",
    "",
    "CMDKEY: 資格情報を正しく削除しました。</code></pre>",
    "  </div>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect2\">",
    "<h3 id=\"_guiで登録する場合\">GUIで登録する場合</h3>",
    "<div class=\"olist arabic\">",
    "<ol class=\"arabic\">",
    "<li>",
    "<p><code>コントロールパネル</code> &#8594; <code>ユーザーアカウント</code> &#8594; <code>資格情報マネージャー</code> &#8594; <code>Windows資格情報</code> を開く</p>",
    "</li>",
    "<li>",
    "<p><code>汎用資格情報の追加</code> からGit認証情報を追加</p>",
    "</li>",
    "<li>",
    "<p>今回はGitHub接続時の認証情報を追加</p>",
    "<div class=\"ulist\">",
    "<ul>",
    "<li>",
    "<p><code>インターネットまたはドメインのアドレス</code> には <code>git:https://github.com</code> を指定。</p>",
    "</li>",
    "<li>",
    "<p><code>ユーザー名</code> はGitHubに登録しているユーザ名またはメールアドレス。</p>",
    "</li>",
    "<li>",
    "<p><code>パスワード</code> に個人アクセストークンを入力する。</p>",
    "</li>",
    "</ul>",
    "</div>",
    "</li>",
    "</ol>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_おわりに\">おわりに😎</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p>今回は <code>git</code> コマンドによる <em>GitHub</em> への認証をWindows資格情報マネージャーで管理することで、自動的に認証されるようにした。<br>",
    "これでもうHTTPSプロトコルでの認証もこわくない。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>記事の主体が資格情報マネージャーのコマンド操作になった気がするけど、まあええやろの精神😗。</p>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_参考\">参考📖</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"ulist\">",
    "<ul>",
    "<li>",
    "<p><a href=\"https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%81%95%E3%81%BE%E3%81%96%E3%81%BE%E3%81%AA%E3%83%84%E3%83%BC%E3%83%AB-%E8%AA%8D%E8%A8%BC%E6%83%85%E5%A0%B1%E3%81%AE%E4%BF%9D%E5%AD%98\" target=\"_blank\" rel=\"noopener\">Git - 認証情報の保存</a></p>",
    "</li>",
    "<li>",
    "<p><a href=\"https://docs.microsoft.com/ja-jp/windows-server/administration/windows-commands/cmdkey\" target=\"_blank\" rel=\"noopener\">cmdkey | Microsoft Docs</a></p>",
    "</li>",
    "<li>",
    "<p><a href=\"https://tech.guitarrapc.com/entry/2014/01/14/101056\" target=\"_blank\" rel=\"noopener\">PowerShell で Get-Credential を利用する - tech.guitarrapc.cóm</a></p>",
    "</li>",
    "<li>",
    "<p><a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/get-credential?view=powershell-7.1\" target=\"_blank\" rel=\"noopener\">Get-Credential (Microsoft.PowerShell.Security) - PowerShell | Microsoft Docs</a></p>",
    "</li>",
    "</ul>",
    "</div>",
    "</div>",
    "</div>"
  ],
  "title": "Gitにおけるパスワード入力を省略する（Windows編）",
  "created_at": "2021-01-07",
  "tags": [
    "git",
    "github",
    "windows",
    "資格情報マネージャー",
    "powershell"
  ],
  "updated_at": "2021-01-07",
  "author": "秋々すすき",
  "revision": "1.1"
}