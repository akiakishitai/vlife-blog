{"filename":"git_partial_clone.adoc","rendered":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">目次</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_どう使うかの結論\">💪どう使うかの結論</a></li>\n<li><a href=\"#_パーシャルクローン_partial_clone_とは\">🍕パーシャルクローン（ <em>partial clone</em> ）とは</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_ブロブレスクローン\">🌟ブロブレス・クローン</a></li>\n<li><a href=\"#_ツリーレスクローン\">ツリーレス・クローン</a></li>\n</ul>\n</li>\n<li><a href=\"#_一部のファイルディレクトリだけをクローンする_sparse_checkout\">🧩一部のファイル/ディレクトリだけをクローンする（ <em>sparse-checkout</em> ）</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_git_sparse_checkout_コマンドについて\"><code>git sparse-checkout</code> コマンドについて</a></li>\n</ul>\n</li>\n<li><a href=\"#_参考\">📖参考</a></li>\n</ul>\n</div>\n<div id=\"preamble\">\n<div class=\"sectionbody\">\n<table class=\"tableblock frame-all grid-all stretch\">\n<caption class=\"title\">Table 1. 環境</caption>\n<colgroup>\n<col style=\"width: 50%;\">\n<col style=\"width: 50%;\">\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">App</th>\n<th class=\"tableblock halign-left valign-top\">Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><em>git</em></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">2.32.0</p></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_どう使うかの結論\">💪どう使うかの結論</h2>\n<div class=\"sectionbody\">\n<div class=\"imageblock kroki\">\n<div class=\"content\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" contentScriptType=\"application/ecmascript\" contentStyleType=\"text/css\" height=\"380px\" preserveAspectRatio=\"none\" style=\"width:654px;height:380px;background:#FFFFFF;\" version=\"1.1\" viewBox=\"0 0 654 380\" width=\"654px\" zoomAndPan=\"magnify\"><defs><filter height=\"300%\" id=\"f158lkogibl9kb\" width=\"300%\" x=\"-1\" y=\"-1\"><feGaussianBlur result=\"blurOut\" stdDeviation=\"2.0\"/><feColorMatrix in=\"blurOut\" result=\"blurOut2\" type=\"matrix\" values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0\"/><feOffset dx=\"4.0\" dy=\"4.0\" in=\"blurOut2\" result=\"blurOut3\"/><feBlend in=\"SourceGraphic\" in2=\"blurOut3\" mode=\"normal\"/></filter></defs><g><polygon fill=\"#FEFECE\" filter=\"url(#f158lkogibl9kb)\" points=\"266.5,11.8999,398.5,11.8999,410.5,23.8999,398.5,35.8999,266.5,35.8999,254.5,23.8999,266.5,11.8999\" style=\"stroke:#A80036;stroke-width:1.5;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"132\" x=\"266.5\" y=\"28.2999\">リポジトリでgit作業する？</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"16\" x=\"238.5\" y=\"21.6999\">yes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"12\" x=\"410.5\" y=\"21.6999\">no</text><polygon fill=\"#FEFECE\" filter=\"url(#f158lkogibl9kb)\" points=\"103,45.8999,235,45.8999,247,57.8999,235,69.8999,103,69.8999,91,57.8999,103,45.8999\" style=\"stroke:#A80036;stroke-width:1.5;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"132\" x=\"103\" y=\"62.2999\">リポジトリが大きすぎる？</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"16\" x=\"75\" y=\"55.6999\">yes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"12\" x=\"247\" y=\"55.6999\">no</text><rect fill=\"#90EE90\" filter=\"url(#f158lkogibl9kb)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke:#A80036;stroke-width:1.5;\" width=\"140\" x=\"11\" y=\"79.8999\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"120\" x=\"21\" y=\"101.9\">ブロブレス・クローン</text><rect fill=\"#90EE90\" filter=\"url(#f158lkogibl9kb)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke:#A80036;stroke-width:1.5;\" width=\"104\" x=\"205\" y=\"79.8999\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"84\" x=\"215\" y=\"101.9\">通常のクローン</text><polygon fill=\"#FEFECE\" filter=\"url(#f158lkogibl9kb)\" points=\"169,120.3,181,132.3,169,144.3,157,132.3,169,120.3\" style=\"stroke:#A80036;stroke-width:1.5;\"/><polygon fill=\"#FEFECE\" filter=\"url(#f158lkogibl9kb)\" points=\"441,45.8999,551,45.8999,563,57.8999,551,69.8999,441,69.8999,429,57.8999,441,45.8999\" style=\"stroke:#A80036;stroke-width:1.5;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"110\" x=\"441\" y=\"62.2999\">コミット履歴が必要？</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"16\" x=\"413\" y=\"55.6999\">yes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"12\" x=\"563\" y=\"55.6999\">no</text><rect fill=\"#90EE90\" filter=\"url(#f158lkogibl9kb)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke:#A80036;stroke-width:1.5;\" width=\"140\" x=\"349\" y=\"79.8999\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"120\" x=\"359\" y=\"101.9\">ツリーレス・クローン</text><rect fill=\"#90EE90\" filter=\"url(#f158lkogibl9kb)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke:#A80036;stroke-width:1.5;\" width=\"128\" x=\"509\" y=\"79.8999\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"108\" x=\"519\" y=\"101.9\">シャロー・クローン</text><polygon fill=\"#FEFECE\" filter=\"url(#f158lkogibl9kb)\" points=\"496,120.3,508,132.3,496,144.3,484,132.3,496,120.3\" style=\"stroke:#A80036;stroke-width:1.5;\"/><polygon fill=\"#FEFECE\" filter=\"url(#f158lkogibl9kb)\" points=\"332.5,150.3,344.5,162.3,332.5,174.3,320.5,162.3,332.5,150.3\" style=\"stroke:#A80036;stroke-width:1.5;\"/><rect fill=\"#B0C4DE\" filter=\"url(#f158lkogibl9kb)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke:#A80036;stroke-width:1.5;\" width=\"117\" x=\"274\" y=\"242.8999\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"97\" x=\"284\" y=\"264.9\">sparse-checkout</text><polygon fill=\"#FEFECE\" filter=\"url(#f158lkogibl9kb)\" points=\"226.5,194.3,438.5,194.3,450.5,206.3,438.5,218.3,226.5,218.3,214.5,206.3,226.5,194.3\" style=\"stroke:#A80036;stroke-width:1.5;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"16\" x=\"336.5\" y=\"229.2999\">yes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"212\" x=\"226.5\" y=\"210.7\">一部のファイル/ディレクトリだけが必要？</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"12\" x=\"450.5\" y=\"204.1\">no</text><polygon fill=\"#FEFECE\" filter=\"url(#f158lkogibl9kb)\" points=\"332.5,297.3,344.5,309.3,332.5,321.3,320.5,309.3,332.5,297.3\" style=\"stroke:#A80036;stroke-width:1.5;\"/><ellipse cx=\"332.5\" cy=\"352.3\" fill=\"#FFFFFF\" filter=\"url(#f158lkogibl9kb)\" rx=\"11\" ry=\"11\" style=\"stroke:#000000;stroke-width:1.0;\"/><ellipse cx=\"332.5\" cy=\"352.3\" fill=\"#000000\" rx=\"6\" ry=\"6\" style=\"stroke:#7F7F7F;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"91\" x2=\"81\" y1=\"57.8999\" y2=\"57.8999\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"81\" x2=\"81\" y1=\"57.8999\" y2=\"79.8999\"/><polygon fill=\"#A80036\" points=\"77,69.8999,81,79.8999,85,69.8999,81,73.8999\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"247\" x2=\"257\" y1=\"57.8999\" y2=\"57.8999\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"257\" x2=\"257\" y1=\"57.8999\" y2=\"79.8999\"/><polygon fill=\"#A80036\" points=\"253,69.8999,257,79.8999,261,69.8999,257,73.8999\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"81\" x2=\"81\" y1=\"114.3\" y2=\"132.3\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"81\" x2=\"157\" y1=\"132.3\" y2=\"132.3\"/><polygon fill=\"#A80036\" points=\"147,128.3,157,132.3,147,136.3,151,132.3\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"257\" x2=\"257\" y1=\"114.3\" y2=\"132.3\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"257\" x2=\"181\" y1=\"132.3\" y2=\"132.3\"/><polygon fill=\"#A80036\" points=\"191,128.3,181,132.3,191,136.3,187,132.3\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"429\" x2=\"419\" y1=\"57.8999\" y2=\"57.8999\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"419\" x2=\"419\" y1=\"57.8999\" y2=\"79.8999\"/><polygon fill=\"#A80036\" points=\"415,69.8999,419,79.8999,423,69.8999,419,73.8999\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"563\" x2=\"573\" y1=\"57.8999\" y2=\"57.8999\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"573\" x2=\"573\" y1=\"57.8999\" y2=\"79.8999\"/><polygon fill=\"#A80036\" points=\"569,69.8999,573,79.8999,577,69.8999,573,73.8999\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"419\" x2=\"419\" y1=\"114.3\" y2=\"132.3\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"419\" x2=\"484\" y1=\"132.3\" y2=\"132.3\"/><polygon fill=\"#A80036\" points=\"474,128.3,484,132.3,474,136.3,478,132.3\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"573\" x2=\"573\" y1=\"114.3\" y2=\"132.3\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"573\" x2=\"508\" y1=\"132.3\" y2=\"132.3\"/><polygon fill=\"#A80036\" points=\"518,128.3,508,132.3,518,136.3,514,132.3\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"254.5\" x2=\"169\" y1=\"23.8999\" y2=\"23.8999\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"169\" x2=\"169\" y1=\"23.8999\" y2=\"45.8999\"/><polygon fill=\"#A80036\" points=\"165,35.8999,169,45.8999,173,35.8999,169,39.8999\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"410.5\" x2=\"496\" y1=\"23.8999\" y2=\"23.8999\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"496\" x2=\"496\" y1=\"23.8999\" y2=\"45.8999\"/><polygon fill=\"#A80036\" points=\"492,35.8999,496,45.8999,500,35.8999,496,39.8999\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"169\" x2=\"169\" y1=\"144.3\" y2=\"162.3\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"169\" x2=\"320.5\" y1=\"162.3\" y2=\"162.3\"/><polygon fill=\"#A80036\" points=\"310.5,158.3,320.5,162.3,310.5,166.3,314.5,162.3\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"496\" x2=\"496\" y1=\"144.3\" y2=\"162.3\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"496\" x2=\"344.5\" y1=\"162.3\" y2=\"162.3\"/><polygon fill=\"#A80036\" points=\"354.5,158.3,344.5,162.3,354.5,166.3,350.5,162.3\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"332.5\" x2=\"332.5\" y1=\"218.3\" y2=\"242.8999\"/><polygon fill=\"#A80036\" points=\"328.5,232.8999,332.5,242.8999,336.5,232.8999,332.5,236.8999\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"450.5\" x2=\"462.5\" y1=\"206.3\" y2=\"206.3\"/><polygon fill=\"#A80036\" points=\"458.5,250.1,462.5,260.1,466.5,250.1,462.5,254.1\" style=\"stroke:#A80036;stroke-width:1.5;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"462.5\" x2=\"462.5\" y1=\"206.3\" y2=\"309.3\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"462.5\" x2=\"344.5\" y1=\"309.3\" y2=\"309.3\"/><polygon fill=\"#A80036\" points=\"354.5,305.3,344.5,309.3,354.5,313.3,350.5,309.3\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"332.5\" x2=\"332.5\" y1=\"277.3\" y2=\"297.3\"/><polygon fill=\"#A80036\" points=\"328.5,287.3,332.5,297.3,336.5,287.3,332.5,291.3\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"332.5\" x2=\"332.5\" y1=\"174.3\" y2=\"194.3\"/><polygon fill=\"#A80036\" points=\"328.5,184.3,332.5,194.3,336.5,184.3,332.5,188.3\" style=\"stroke:#A80036;stroke-width:1.0;\"/><line style=\"stroke:#A80036;stroke-width:1.5;\" x1=\"332.5\" x2=\"332.5\" y1=\"321.3\" y2=\"341.3\"/><polygon fill=\"#A80036\" points=\"328.5,331.3,332.5,341.3,336.5,331.3,332.5,335.3\" style=\"stroke:#A80036;stroke-width:1.0;\"/><!--MD5=[bf9a98d6783359666c566469eb72b43f]\n@startuml\nif (リポジトリでgit作業する？) then (yes)\n    if (リポジトリが大きすぎる？) then (yes)\n        #LightGreen:**ブロブレス・クローン**;\n    else (no)\n        #LightGreen:**通常のクローン**;\n    endif\nelse (no)\n    if (コミット履歴が必要？) then (yes)\n        #LightGreen:**ツリーレス・クローン**;\n    else (no)\n        #LightGreen:**シャロー・クローン**;\n    endif\nendif\n\nif (一部のファイル/ディレクトリだけが必要？) then (yes)\n    #LightSteelBlue:**sparse-checkout**;\nelse (no)\nendif\n\nstop\n@enduml\n\nPlantUML version 1.2021.16(Wed Dec 08 17:25:22 GMT 2021)\n(GPL source distribution)\nJava Runtime: OpenJDK Runtime Environment\nJVM: OpenJDK 64-Bit Server VM\nDefault Encoding: UTF-8\nLanguage: en\nCountry: US\n--></g></svg>\n</div>\n<div class=\"title\">Figure 1. クローン方法を選ぶワークフロー</div>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 1. 一般的な使い方をするとき</div>\n<div class=\"content\">\n<div class=\"paragraph\">\n<p>リポジトリで作業をする場合はブロブレス・クローンを利用する。</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --filter=blob:none &lt;URL&gt;</code></pre>\n  </div>\n</div>\n</div>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 2. ビルド生成物だけが必要なとき</div>\n<div class=\"content\">\n<div class=\"paragraph\">\n<p><em>CI</em> でビルドするためだけに使うなど、リポジトリにおいて <em>git</em> 操作をほぼ行わない場合はツリーレス・クローンまたはシャロー・クローンを利用する。</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">コミット履歴は参照したいならツリーレス・クローン</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --filter=tree:0 &lt;URL&gt;</code></pre>\n  </div>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">コミット履歴も不要ならばシャロー・クローン</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --depth=1 &lt;URL&gt;</code></pre>\n  </div>\n</div>\n</div>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 3. 一部のファイル/ディレクトリだけ必要なとき</div>\n<div class=\"content\">\n<div class=\"paragraph\">\n<p><em>sparse-checkout</em> 機能を使う。<br>\nパーシャルクローンと組み合わせると更に効果的。</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --filter=blob:none --sparse &lt;URL&gt;\ncd &lt;REPOSITORY&gt;\ngit sparse-checkout init --cone\ngit sparse-checkout set &lt;PATTERN1&gt; [&lt;PATTERN2&gt; ...]</code></pre>\n  </div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_パーシャルクローン_partial_clone_とは\">🍕パーシャルクローン（ <em>partial clone</em> ）とは</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>指定されたコミットの範囲内でダウンロードする <em>blob</em> オブジェクト<sup class=\"footnote\">[<a id=\"_footnoteref_1\" class=\"footnote\" href=\"#_footnotedef_1\" title=\"View footnote.\">1</a>]</sup>や <em>tree</em> オブジェクト<sup class=\"footnote\">[<a id=\"_footnoteref_2\" class=\"footnote\" href=\"#_footnotedef_2\" title=\"View footnote.\">2</a>]</sup>の数を制限してクローンする機能のこと。<br>\n巨大なリポジトリから必要なものだけをクローンすることで、ダウンロード時間やディスク使用容量を削減するために使われる。</p>\n</div>\n<div class=\"paragraph\">\n<p>パーシャルクローンは <code>git clone</code> コマンドにおいて <code>--filter</code> オプションを指定することで有効化される。</p>\n</div>\n<div class=\"paragraph\">\n<p><em>GitHub</em> から利用できるパーシャルクローンは <em>ブロブレス・クローン</em> と <em>ツリーレス・クローン</em> の2種類がある。</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_ブロブレスクローン\">🌟ブロブレス・クローン</h3>\n<div class=\"paragraph\">\n<p><code>git clone</code> 実行時にすべてのコミット履歴と <em>tree</em> オブジェクトはダウンロードされるが、各 <em>blob</em> オブジェクトはそれぞれが必要となった時にダウンロードされる<sup class=\"footnote\" id=\"_footnote_cloned\">[<a id=\"_footnoteref_3\" class=\"footnote\" href=\"#_footnotedef_3\" title=\"View footnote.\">3</a>]</sup>。<br>\nこのブロブレス・クローンは汎用的に使えるパーシャルクローンであり、一般的に使われる手法である。</p>\n</div>\n<div class=\"paragraph\">\n<p>リポジトリでの作業において、<em>blob</em> オブジェクトを必要とするコマンドは使用頻度が比較的低い。<br>\nそのため、ブロブレス・クローンは通常のクローンと同じような感覚で使える。</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">ブロブレス・クローンの実行</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --filter=blob:none &lt;URL&gt;</code></pre>\n  </div>\n</div>\n<div class=\"admonitionblock caution\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-caution\" title=\"Caution\" data-md-icon=\"local_fire_department\"></i>\n</td>\n<td class=\"content\">\n<div class=\"title\">blobオブジェクトのダウンロードが行われるコマンド</div>\n<div class=\"paragraph\">\n<p><code>git checkout</code> や <code>git pull</code>、 <code>git blame</code> など。<br>\nファイル内容を利用するコマンドが該当する。</p>\n</div>\n</td>\n</tr>\n</table>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_ツリーレスクローン\">ツリーレス・クローン</h3>\n<div class=\"paragraph\">\n<p><code>git clone</code> 実行時にはすべてのコミット履歴のみがダウンロードされ、<em>tree</em> オブジェクトと <em>blob</em> オブジェクトはそれぞれが必要となった時にダウンロードされる<sup class=\"footnoteref\">[<a class=\"footnote\" href=\"#_footnotedef_3\" title=\"View footnote.\">3</a>]</sup>。</p>\n</div>\n<div class=\"paragraph\">\n<p>利用方法はシャロー・クローンと似たような感じになり、使い所が限られる。<br>\n（<em>tree</em> オブジェクトを必要とする <em>git</em> コマンドが意外とあるみたい）</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">ツリーレス・クローンの実行</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --filter=tree:0 &lt;URL&gt;</code></pre>\n  </div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_一部のファイルディレクトリだけをクローンする_sparse_checkout\">🧩一部のファイル/ディレクトリだけをクローンする（ <a href=\"https://git-scm.com/docs/git-sparse-checkout\" target=\"_blank\" rel=\"noopener\"><em>sparse-checkout</em></a> ）</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><em>sparse-checkout</em> 機能を利用することで、一部のファイルまたはディレクトリだけに制限してクローンすることができる。<br>\nこの <em>sparse-checkout</em> 機能は <code>git sparse-checkout</code> コマンドから操作する。</p>\n</div>\n<div class=\"paragraph\">\n<p>例として <a href=\"https://github.com/derrickstolee/sparse-checkout-example\" target=\"_blank\" rel=\"noopener\"><em>Sparse-Checkout Example Repo</em></a> リポジトリを対象にすると次のようになる。</p>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 4. 一部のファイル/ディレクトリだけをクローンする例</div>\n<div class=\"content\">\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">パーシャルクローンと組み合わせ</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"5,9,11\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone \\\n    --filter=blob:none \\    <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\n    --sparse \\              <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\n    https://github.com/derrickstolee/sparse-checkout-example\n\ncd ./sparse-checkout-example\ngit sparse-checkout init --cone         <i class=\"conum\" data-value=\"3\"></i><b>(3)</b>\ngit sparse-checkout set web/browser     <i class=\"conum\" data-value=\"4\"></i><b>(4)</b>\n\nls -AF\nbootstrap.sh  .git/  LICENSE.md  README.md  web/</code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>ブロブレス・クローンとして実行<sup class=\"footnote\">[<a id=\"_footnoteref_4\" class=\"footnote\" href=\"#_footnotedef_4\" title=\"View footnote.\">4</a>]</sup>。</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>リポジトリのルート直下にあるファイルだけをダウンロードするオプション。</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>\n<td><em>sparse-checkout</em> 機能の有効化。</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"4\"></i><b>4</b></td>\n<td>ダウンロードしたいファイル/ディレクトリのパスをパターンで新規指定。<br>\nパターンを追加する場合は <code>add</code> サブコマンドを使う。</td>\n</tr>\n</table>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-note\" title=\"Note\" data-md-icon=\"info\"></i>\n</td>\n<td class=\"content\">\n<em>git v2.27.0</em> 以降では <code>--no-checkout</code> オプションと <code>git sparse-checkout</code> の組み合わせはバグがあったため機能しない。<br>\nただし v2.32.0 では修正されて動作するっぽい。\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_git_sparse_checkout_コマンドについて\"><code>git sparse-checkout</code> コマンドについて</h3>\n<div class=\"admonitionblock caution\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-caution\" title=\"Caution\" data-md-icon=\"local_fire_department\"></i>\n</td>\n<td class=\"content\">\n<em>git v2.32.0</em> でもまだ実験的なコマンドのため、動作やサブコマンドが変更される可能性がある。\n</td>\n</tr>\n</table>\n</div>\n<div class=\"dlist\">\n<dl>\n<dt class=\"hdlist1\"><em>sparse-checkout</em> 機能の有効化</dt>\n<dd>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git sparse-checkout init --cone</code></pre>\n  </div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>パフォーマンス改善のため、 <code>--cone</code> オプションが一般的に付けられる（詳細は <a href=\"https://git-scm.com/docs/git-sparse-checkout#_cone_pattern_set\" target=\"_blank\" rel=\"noopener\">CONE PATTERN SET</a> を参照）。</p>\n</li>\n</ul>\n</div>\n</dd>\n<dt class=\"hdlist1\">必要なパスのパターンを登録</dt>\n<dd>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"2-10\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git sparse-checkout set &lt;PATTERN1&gt; [&lt;PATTERN2&gt; ...]\ngit sparse-checkout add &lt;PATTERN1&gt; [&lt;PATTERN2&gt; ...]</code></pre>\n  </div>\n</div>\n<table class=\"tableblock frame-all grid-all fit-content\">\n<colgroup>\n<col>\n<col>\n</colgroup>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><code>set</code></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">指定したパターンで登録リストを新規作成。<br>\n既存のリストは上書きされる。</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><code>add</code></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">登録リストに指定したパターンを追加登録。</p></td>\n</tr>\n</tbody>\n</table>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>指定するパターンの書式は <code>.gitignore</code> と同様。</p>\n</li>\n</ul>\n</div>\n</dd>\n<dt class=\"hdlist1\">登録されているパターンの一覧</dt>\n<dd>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"2-10\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git sparse-checkout list</code></pre>\n  </div>\n</div>\n</dd>\n<dt class=\"hdlist1\"><em>sparse-checkout</em> 機能を再適用</dt>\n<dd>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"2-10\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git sparse-checkout reapply</code></pre>\n  </div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>git merge</code> や <code>git rebase</code> でパスを実体化した場合に使ったりする。</p>\n</li>\n</ul>\n</div>\n</dd>\n<dt class=\"hdlist1\"><em>sparse-checkout</em> 機能を無効化</dt>\n<dd>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"2-10\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git sparse-checkout disable</code></pre>\n  </div>\n</div>\n</dd>\n</dl>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\">📖参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<div class=\"title\">Partial Clone</div>\n<ul>\n<li>\n<p><a href=\"https://git-scm.com/docs/partial-clone\" target=\"_blank\" rel=\"noopener\">Git - partial-clone Documentation</a></p>\n</li>\n<li>\n<p><a href=\"https://github.blog/jp/2021-01-13-get-up-to-speed-with-partial-clone-and-shallow-clone/\" target=\"_blank\" rel=\"noopener\">パーシャルクローンとシャロークローンを活用しよう - GitHubブログ</a></p>\n</li>\n</ul>\n</div>\n<div class=\"ulist\">\n<div class=\"title\">sparse-checkout</div>\n<ul>\n<li>\n<p><a href=\"https://git-scm.com/docs/git-sparse-checkout\" target=\"_blank\" rel=\"noopener\">git-sparse-checkout Documentation</a></p>\n</li>\n<li>\n<p><a href=\"https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/\" target=\"_blank\" rel=\"noopener\">Bring your monorepo down to size with sparse-checkout | The GitHub Blog</a></p>\n</li>\n<li>\n<p><a href=\"https://iucstscui.hatenablog.com/entry/2020/08/29/080322\" target=\"_blank\" rel=\"noopener\">git2.27以降にgit sparse-checkoutを使う場合はno-checkoutではなくsparseを使おう - はんなりと、ゆるやかに</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div id=\"footnotes\">\n<hr>\n<div class=\"footnote\" id=\"_footnotedef_1\">\n<a href=\"#_footnoteref_1\">1</a>. <em>git</em> 内部で使用されているオブジェクトタイプ。リポジトリ内の各ファイルの中身が保存されている。\n</div>\n<div class=\"footnote\" id=\"_footnotedef_2\">\n<a href=\"#_footnoteref_2\">2</a>. ディレクトリのようなもの。各オブジェクトの階層情報が保存されている。\n</div>\n<div class=\"footnote\" id=\"_footnotedef_3\">\n<a href=\"#_footnoteref_3\">3</a>. <code>HEAD</code> コミットだけは全てのデータがダウンロードされている。\n</div>\n<div class=\"footnote\" id=\"_footnotedef_4\">\n<a href=\"#_footnoteref_4\">4</a>. 通常のクローンと比較して、この例では <em>172MB</em> &#8594; <em>504KB</em> へとサイズ削減できた。\n</div>\n</div>","title":"巨大なリポジトリをクローンするときに便利なパーシャルクローンとsparse-checkout","created_at":"2021-07-22","tags":["git","partial-clone"],"updated_at":"2021-07-22","author":"秋々すすき","revision":"1.0"}