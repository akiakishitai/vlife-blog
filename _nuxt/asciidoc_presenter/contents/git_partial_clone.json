{"filename":"git_partial_clone.adoc","rendered":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">目次</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_どう使うかの結論\">💪どう使うかの結論</a></li>\n<li><a href=\"#_パーシャルクローン_partial_clone_とは\">🍕パーシャルクローン（ <em>partial clone</em> ）とは</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_ブロブレスクローン\">🌟ブロブレス・クローン</a></li>\n<li><a href=\"#_ツリーレスクローン\">ツリーレス・クローン</a></li>\n</ul>\n</li>\n<li><a href=\"#_一部のファイルディレクトリだけをクローンする_sparse_checkout\">🧩一部のファイル/ディレクトリだけをクローンする（ <em>sparse-checkout</em> ）</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_git_sparse_checkout_コマンドについて\"><code>git sparse-checkout</code> コマンドについて</a></li>\n</ul>\n</li>\n<li><a href=\"#_参考\">📖参考</a></li>\n</ul>\n</div>\n<div id=\"preamble\">\n<div class=\"sectionbody\">\n<table class=\"tableblock frame-all grid-all stretch\">\n<caption class=\"title\">Table 1. 環境</caption>\n<colgroup>\n<col style=\"width: 50%;\">\n<col style=\"width: 50%;\">\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">App</th>\n<th class=\"tableblock halign-left valign-top\">Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><em>git</em></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">2.32.0</p></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_どう使うかの結論\">💪どう使うかの結論</h2>\n<div class=\"sectionbody\">\n<div class=\"imageblock kroki\">\n<div class=\"content\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" contentStyleType=\"text/css\" height=\"373px\" preserveAspectRatio=\"none\" style=\"width:648px;height:373px;background:#FFFFFF;\" version=\"1.1\" viewBox=\"0 0 648 373\" width=\"648px\" zoomAndPan=\"magnify\"><defs/><g><polygon fill=\"#F1F1F1\" points=\"265,11.8989,400,11.8989,412,23.8989,400,35.8989,265,35.8989,253,23.8989,265,11.8989\" style=\"stroke:#181818;stroke-width:0.5;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"135\" x=\"265\" y=\"27.707\">リポジトリでgit作業する？</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"20\" x=\"233\" y=\"21.3047\">yes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"14\" x=\"412\" y=\"21.3047\">no</text><polygon fill=\"#F1F1F1\" points=\"103,45.8989,235,45.8989,247,57.8989,235,69.8989,103,69.8989,91,57.8989,103,45.8989\" style=\"stroke:#181818;stroke-width:0.5;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"132\" x=\"103\" y=\"61.707\">リポジトリが大きすぎる？</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"20\" x=\"71\" y=\"55.3047\">yes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"14\" x=\"247\" y=\"55.3047\">no</text><rect fill=\"#90EE90\" height=\"33.9688\" rx=\"12.5\" ry=\"12.5\" style=\"stroke:#181818;stroke-width:0.5;\" width=\"140\" x=\"11\" y=\"79.8989\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"120\" x=\"21\" y=\"101.0376\">ブロブレス・クローン</text><rect fill=\"#90EE90\" height=\"33.9688\" rx=\"12.5\" ry=\"12.5\" style=\"stroke:#181818;stroke-width:0.5;\" width=\"104\" x=\"205\" y=\"79.8989\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"84\" x=\"215\" y=\"101.0376\">通常のクローン</text><polygon fill=\"#F1F1F1\" points=\"169,119.8677,181,131.8677,169,143.8677,157,131.8677,169,119.8677\" style=\"stroke:#181818;stroke-width:0.5;\"/><polygon fill=\"#F1F1F1\" points=\"441,45.8989,551,45.8989,563,57.8989,551,69.8989,441,69.8989,429,57.8989,441,45.8989\" style=\"stroke:#181818;stroke-width:0.5;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"110\" x=\"441\" y=\"61.707\">コミット履歴が必要？</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"20\" x=\"409\" y=\"55.3047\">yes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"14\" x=\"563\" y=\"55.3047\">no</text><rect fill=\"#90EE90\" height=\"33.9688\" rx=\"12.5\" ry=\"12.5\" style=\"stroke:#181818;stroke-width:0.5;\" width=\"140\" x=\"349\" y=\"79.8989\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"120\" x=\"359\" y=\"101.0376\">ツリーレス・クローン</text><rect fill=\"#90EE90\" height=\"33.9688\" rx=\"12.5\" ry=\"12.5\" style=\"stroke:#181818;stroke-width:0.5;\" width=\"128\" x=\"509\" y=\"79.8989\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"108\" x=\"519\" y=\"101.0376\">シャロー・クローン</text><polygon fill=\"#F1F1F1\" points=\"496,119.8677,508,131.8677,496,143.8677,484,131.8677,496,119.8677\" style=\"stroke:#181818;stroke-width:0.5;\"/><polygon fill=\"#F1F1F1\" points=\"332.5,149.8677,344.5,161.8677,332.5,173.8677,320.5,161.8677,332.5,149.8677\" style=\"stroke:#181818;stroke-width:0.5;\"/><rect fill=\"#B0C4DE\" height=\"33.9688\" rx=\"12.5\" ry=\"12.5\" style=\"stroke:#181818;stroke-width:0.5;\" width=\"138\" x=\"263.5\" y=\"242.27\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"118\" x=\"273.5\" y=\"263.4087\">sparse-checkout</text><polygon fill=\"#F1F1F1\" points=\"226,193.8677,439,193.8677,451,205.8677,439,217.8677,226,217.8677,214,205.8677,226,193.8677\" style=\"stroke:#181818;stroke-width:0.5;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"20\" x=\"336.5\" y=\"228.0781\">yes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"213\" x=\"226\" y=\"209.6758\">一部のファイル/ディレクトリだけが必要？</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacing\" textLength=\"14\" x=\"451\" y=\"203.2734\">no</text><polygon fill=\"#F1F1F1\" points=\"332.5,296.2388,344.5,308.2388,332.5,320.2388,320.5,308.2388,332.5,296.2388\" style=\"stroke:#181818;stroke-width:0.5;\"/><ellipse cx=\"332.5\" cy=\"351.2388\" fill=\"none\" rx=\"11\" ry=\"11\" style=\"stroke:#222222;stroke-width:1.0;\"/><ellipse cx=\"332.5\" cy=\"351.2388\" fill=\"#222222\" rx=\"6\" ry=\"6\" style=\"stroke:#111111;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"91\" x2=\"81\" y1=\"57.8989\" y2=\"57.8989\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"81\" x2=\"81\" y1=\"57.8989\" y2=\"79.8989\"/><polygon fill=\"#181818\" points=\"77,69.8989,81,79.8989,85,69.8989,81,73.8989\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"247\" x2=\"257\" y1=\"57.8989\" y2=\"57.8989\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"257\" x2=\"257\" y1=\"57.8989\" y2=\"79.8989\"/><polygon fill=\"#181818\" points=\"253,69.8989,257,79.8989,261,69.8989,257,73.8989\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"81\" x2=\"81\" y1=\"113.8677\" y2=\"131.8677\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"81\" x2=\"157\" y1=\"131.8677\" y2=\"131.8677\"/><polygon fill=\"#181818\" points=\"147,127.8677,157,131.8677,147,135.8677,151,131.8677\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"257\" x2=\"257\" y1=\"113.8677\" y2=\"131.8677\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"257\" x2=\"181\" y1=\"131.8677\" y2=\"131.8677\"/><polygon fill=\"#181818\" points=\"191,127.8677,181,131.8677,191,135.8677,187,131.8677\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"429\" x2=\"419\" y1=\"57.8989\" y2=\"57.8989\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"419\" x2=\"419\" y1=\"57.8989\" y2=\"79.8989\"/><polygon fill=\"#181818\" points=\"415,69.8989,419,79.8989,423,69.8989,419,73.8989\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"563\" x2=\"573\" y1=\"57.8989\" y2=\"57.8989\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"573\" x2=\"573\" y1=\"57.8989\" y2=\"79.8989\"/><polygon fill=\"#181818\" points=\"569,69.8989,573,79.8989,577,69.8989,573,73.8989\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"419\" x2=\"419\" y1=\"113.8677\" y2=\"131.8677\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"419\" x2=\"484\" y1=\"131.8677\" y2=\"131.8677\"/><polygon fill=\"#181818\" points=\"474,127.8677,484,131.8677,474,135.8677,478,131.8677\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"573\" x2=\"573\" y1=\"113.8677\" y2=\"131.8677\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"573\" x2=\"508\" y1=\"131.8677\" y2=\"131.8677\"/><polygon fill=\"#181818\" points=\"518,127.8677,508,131.8677,518,135.8677,514,131.8677\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"253\" x2=\"169\" y1=\"23.8989\" y2=\"23.8989\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"169\" x2=\"169\" y1=\"23.8989\" y2=\"45.8989\"/><polygon fill=\"#181818\" points=\"165,35.8989,169,45.8989,173,35.8989,169,39.8989\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"412\" x2=\"496\" y1=\"23.8989\" y2=\"23.8989\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"496\" x2=\"496\" y1=\"23.8989\" y2=\"45.8989\"/><polygon fill=\"#181818\" points=\"492,35.8989,496,45.8989,500,35.8989,496,39.8989\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"169\" x2=\"169\" y1=\"143.8677\" y2=\"161.8677\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"169\" x2=\"320.5\" y1=\"161.8677\" y2=\"161.8677\"/><polygon fill=\"#181818\" points=\"310.5,157.8677,320.5,161.8677,310.5,165.8677,314.5,161.8677\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"496\" x2=\"496\" y1=\"143.8677\" y2=\"161.8677\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"496\" x2=\"344.5\" y1=\"161.8677\" y2=\"161.8677\"/><polygon fill=\"#181818\" points=\"354.5,157.8677,344.5,161.8677,354.5,165.8677,350.5,161.8677\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"332.5\" x2=\"332.5\" y1=\"217.8677\" y2=\"242.27\"/><polygon fill=\"#181818\" points=\"328.5,232.27,332.5,242.27,336.5,232.27,332.5,236.27\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"451\" x2=\"463\" y1=\"205.8677\" y2=\"205.8677\"/><polygon fill=\"#181818\" points=\"459,249.2544,463,259.2544,467,249.2544,463,253.2544\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"463\" x2=\"463\" y1=\"205.8677\" y2=\"308.2388\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"463\" x2=\"344.5\" y1=\"308.2388\" y2=\"308.2388\"/><polygon fill=\"#181818\" points=\"354.5,304.2388,344.5,308.2388,354.5,312.2388,350.5,308.2388\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"332.5\" x2=\"332.5\" y1=\"276.2388\" y2=\"296.2388\"/><polygon fill=\"#181818\" points=\"328.5,286.2388,332.5,296.2388,336.5,286.2388,332.5,290.2388\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"332.5\" x2=\"332.5\" y1=\"173.8677\" y2=\"193.8677\"/><polygon fill=\"#181818\" points=\"328.5,183.8677,332.5,193.8677,336.5,183.8677,332.5,187.8677\" style=\"stroke:#181818;stroke-width:1.0;\"/><line style=\"stroke:#181818;stroke-width:1.0;\" x1=\"332.5\" x2=\"332.5\" y1=\"320.2388\" y2=\"340.2388\"/><polygon fill=\"#181818\" points=\"328.5,330.2388,332.5,340.2388,336.5,330.2388,332.5,334.2388\" style=\"stroke:#181818;stroke-width:1.0;\"/><!--MD5=[48860e177cc03a3a74820b11308c3df7]\n@startuml\nif (リポジトリでgit作業する？) then (yes)\n    if (リポジトリが大きすぎる？) then (yes)\n        #LightGreen:**ブロブレス・クローン**;\n    else (no)\n        #LightGreen:**通常のクローン**;\n    endif\nelse (no)\n    if (コミット履歴が必要？) then (yes)\n        #LightGreen:**ツリーレス・クローン**;\n    else (no)\n        #LightGreen:**シャロー・クローン**;\n    endif\nendif\n\nif (一部のファイル/ディレクトリだけが必要？) then (yes)\n    #LightSteelBlue:**sparse-checkout**;\nelse (no)\nendif\n\nstop\n@enduml\n\nPlantUML version 1.2022.12(Sun Oct 23 18:12:26 GMT 2022)\n(GPL source distribution)\nJava Runtime: OpenJDK Runtime Environment\nJVM: OpenJDK 64-Bit Server VM\nDefault Encoding: UTF-8\nLanguage: en\nCountry: US\n--></g></svg>\n</div>\n<div class=\"title\">Figure 1. クローン方法を選ぶワークフロー</div>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 1. 一般的な使い方をするとき</div>\n<div class=\"content\">\n<div class=\"paragraph\">\n<p>リポジトリで作業をする場合はブロブレス・クローンを利用する。</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --filter=blob:none &lt;URL&gt;</code></pre>\n  </div>\n</div>\n</div>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 2. ビルド生成物だけが必要なとき</div>\n<div class=\"content\">\n<div class=\"paragraph\">\n<p><em>CI</em> でビルドするためだけに使うなど、リポジトリにおいて <em>git</em> 操作をほぼ行わない場合はツリーレス・クローンまたはシャロー・クローンを利用する。</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">コミット履歴は参照したいならツリーレス・クローン</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --filter=tree:0 &lt;URL&gt;</code></pre>\n  </div>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">コミット履歴も不要ならばシャロー・クローン</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --depth=1 &lt;URL&gt;</code></pre>\n  </div>\n</div>\n</div>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 3. 一部のファイル/ディレクトリだけ必要なとき</div>\n<div class=\"content\">\n<div class=\"paragraph\">\n<p><em>sparse-checkout</em> 機能を使う。<br>\nパーシャルクローンと組み合わせると更に効果的。</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --filter=blob:none --sparse &lt;URL&gt;\ncd &lt;REPOSITORY&gt;\ngit sparse-checkout init --cone\ngit sparse-checkout set &lt;PATTERN1&gt; [&lt;PATTERN2&gt; ...]</code></pre>\n  </div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_パーシャルクローン_partial_clone_とは\">🍕パーシャルクローン（ <em>partial clone</em> ）とは</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>指定されたコミットの範囲内でダウンロードする <em>blob</em> オブジェクト<sup class=\"footnote\">[<a id=\"_footnoteref_1\" class=\"footnote\" href=\"#_footnotedef_1\" title=\"View footnote.\">1</a>]</sup>や <em>tree</em> オブジェクト<sup class=\"footnote\">[<a id=\"_footnoteref_2\" class=\"footnote\" href=\"#_footnotedef_2\" title=\"View footnote.\">2</a>]</sup>の数を制限してクローンする機能のこと。<br>\n巨大なリポジトリから必要なものだけをクローンすることで、ダウンロード時間やディスク使用容量を削減するために使われる。</p>\n</div>\n<div class=\"paragraph\">\n<p>パーシャルクローンは <code>git clone</code> コマンドにおいて <code>--filter</code> オプションを指定することで有効化される。</p>\n</div>\n<div class=\"paragraph\">\n<p><em>GitHub</em> から利用できるパーシャルクローンは <em>ブロブレス・クローン</em> と <em>ツリーレス・クローン</em> の2種類がある。</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_ブロブレスクローン\">🌟ブロブレス・クローン</h3>\n<div class=\"paragraph\">\n<p><code>git clone</code> 実行時にすべてのコミット履歴と <em>tree</em> オブジェクトはダウンロードされるが、各 <em>blob</em> オブジェクトはそれぞれが必要となった時にダウンロードされる<sup class=\"footnote\" id=\"_footnote_cloned\">[<a id=\"_footnoteref_3\" class=\"footnote\" href=\"#_footnotedef_3\" title=\"View footnote.\">3</a>]</sup>。<br>\nこのブロブレス・クローンは汎用的に使えるパーシャルクローンであり、一般的に使われる手法である。</p>\n</div>\n<div class=\"paragraph\">\n<p>リポジトリでの作業において、<em>blob</em> オブジェクトを必要とするコマンドは使用頻度が比較的低い。<br>\nそのため、ブロブレス・クローンは通常のクローンと同じような感覚で使える。</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">ブロブレス・クローンの実行</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --filter=blob:none &lt;URL&gt;</code></pre>\n  </div>\n</div>\n<div class=\"admonitionblock caution\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-caution\" title=\"Caution\" data-md-icon=\"local_fire_department\"></i>\n</td>\n<td class=\"content\">\n<div class=\"title\">blobオブジェクトのダウンロードが行われるコマンド</div>\n<div class=\"paragraph\">\n<p><code>git checkout</code> や <code>git pull</code>、 <code>git blame</code> など。<br>\nファイル内容を利用するコマンドが該当する。</p>\n</div>\n</td>\n</tr>\n</table>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_ツリーレスクローン\">ツリーレス・クローン</h3>\n<div class=\"paragraph\">\n<p><code>git clone</code> 実行時にはすべてのコミット履歴のみがダウンロードされ、<em>tree</em> オブジェクトと <em>blob</em> オブジェクトはそれぞれが必要となった時にダウンロードされる<sup class=\"footnoteref\">[<a class=\"footnote\" href=\"#_footnotedef_3\" title=\"View footnote.\">3</a>]</sup>。</p>\n</div>\n<div class=\"paragraph\">\n<p>利用方法はシャロー・クローンと似たような感じになり、使い所が限られる。<br>\n（<em>tree</em> オブジェクトを必要とする <em>git</em> コマンドが意外とあるみたい）</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">ツリーレス・クローンの実行</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone --filter=tree:0 &lt;URL&gt;</code></pre>\n  </div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_一部のファイルディレクトリだけをクローンする_sparse_checkout\">🧩一部のファイル/ディレクトリだけをクローンする（ <a href=\"https://git-scm.com/docs/git-sparse-checkout\" target=\"_blank\" rel=\"noopener\"><em>sparse-checkout</em></a> ）</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><em>sparse-checkout</em> 機能を利用することで、一部のファイルまたはディレクトリだけに制限してクローンすることができる。<br>\nこの <em>sparse-checkout</em> 機能は <code>git sparse-checkout</code> コマンドから操作する。</p>\n</div>\n<div class=\"paragraph\">\n<p>例として <a href=\"https://github.com/derrickstolee/sparse-checkout-example\" target=\"_blank\" rel=\"noopener\"><em>Sparse-Checkout Example Repo</em></a> リポジトリを対象にすると次のようになる。</p>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 4. 一部のファイル/ディレクトリだけをクローンする例</div>\n<div class=\"content\">\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">パーシャルクローンと組み合わせ</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"5,9,11\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git clone \\\n    --filter=blob:none \\    <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\n    --sparse \\              <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\n    https://github.com/derrickstolee/sparse-checkout-example\n\ncd ./sparse-checkout-example\ngit sparse-checkout init --cone         <i class=\"conum\" data-value=\"3\"></i><b>(3)</b>\ngit sparse-checkout set web/browser     <i class=\"conum\" data-value=\"4\"></i><b>(4)</b>\n\nls -AF\nbootstrap.sh  .git/  LICENSE.md  README.md  web/</code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>ブロブレス・クローンとして実行<sup class=\"footnote\">[<a id=\"_footnoteref_4\" class=\"footnote\" href=\"#_footnotedef_4\" title=\"View footnote.\">4</a>]</sup>。</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>リポジトリのルート直下にあるファイルだけをダウンロードするオプション。</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>\n<td><em>sparse-checkout</em> 機能の有効化。</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"4\"></i><b>4</b></td>\n<td>ダウンロードしたいファイル/ディレクトリのパスをパターンで新規指定。<br>\nパターンを追加する場合は <code>add</code> サブコマンドを使う。</td>\n</tr>\n</table>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-note\" title=\"Note\" data-md-icon=\"info\"></i>\n</td>\n<td class=\"content\">\n<em>git v2.27.0</em> 以降では <code>--no-checkout</code> オプションと <code>git sparse-checkout</code> の組み合わせはバグがあったため機能しない。<br>\nただし v2.32.0 では修正されて動作するっぽい。\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_git_sparse_checkout_コマンドについて\"><code>git sparse-checkout</code> コマンドについて</h3>\n<div class=\"admonitionblock caution\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-caution\" title=\"Caution\" data-md-icon=\"local_fire_department\"></i>\n</td>\n<td class=\"content\">\n<em>git v2.32.0</em> でもまだ実験的なコマンドのため、動作やサブコマンドが変更される可能性がある。\n</td>\n</tr>\n</table>\n</div>\n<div class=\"dlist\">\n<dl>\n<dt class=\"hdlist1\"><em>sparse-checkout</em> 機能の有効化</dt>\n<dd>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git sparse-checkout init --cone</code></pre>\n  </div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>パフォーマンス改善のため、 <code>--cone</code> オプションが一般的に付けられる（詳細は <a href=\"https://git-scm.com/docs/git-sparse-checkout#_cone_pattern_set\" target=\"_blank\" rel=\"noopener\">CONE PATTERN SET</a> を参照）。</p>\n</li>\n</ul>\n</div>\n</dd>\n<dt class=\"hdlist1\">必要なパスのパターンを登録</dt>\n<dd>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"2-10\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git sparse-checkout set &lt;PATTERN1&gt; [&lt;PATTERN2&gt; ...]\ngit sparse-checkout add &lt;PATTERN1&gt; [&lt;PATTERN2&gt; ...]</code></pre>\n  </div>\n</div>\n<table class=\"tableblock frame-all grid-all fit-content\">\n<colgroup>\n<col>\n<col>\n</colgroup>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><code>set</code></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">指定したパターンで登録リストを新規作成。<br>\n既存のリストは上書きされる。</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><code>add</code></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">登録リストに指定したパターンを追加登録。</p></td>\n</tr>\n</tbody>\n</table>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>指定するパターンの書式は <code>.gitignore</code> と同様。</p>\n</li>\n</ul>\n</div>\n</dd>\n<dt class=\"hdlist1\">登録されているパターンの一覧</dt>\n<dd>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"2-10\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git sparse-checkout list</code></pre>\n  </div>\n</div>\n</dd>\n<dt class=\"hdlist1\"><em>sparse-checkout</em> 機能を再適用</dt>\n<dd>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"2-10\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git sparse-checkout reapply</code></pre>\n  </div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>git merge</code> や <code>git rebase</code> でパスを実体化した場合に使ったりする。</p>\n</li>\n</ul>\n</div>\n</dd>\n<dt class=\"hdlist1\"><em>sparse-checkout</em> 機能を無効化</dt>\n<dd>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"2-10\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">git sparse-checkout disable</code></pre>\n  </div>\n</div>\n</dd>\n</dl>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\">📖参考</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<div class=\"title\">Partial Clone</div>\n<ul>\n<li>\n<p><a href=\"https://git-scm.com/docs/partial-clone\" target=\"_blank\" rel=\"noopener\">Git - partial-clone Documentation</a></p>\n</li>\n<li>\n<p><a href=\"https://github.blog/jp/2021-01-13-get-up-to-speed-with-partial-clone-and-shallow-clone/\" target=\"_blank\" rel=\"noopener\">パーシャルクローンとシャロークローンを活用しよう - GitHubブログ</a></p>\n</li>\n</ul>\n</div>\n<div class=\"ulist\">\n<div class=\"title\">sparse-checkout</div>\n<ul>\n<li>\n<p><a href=\"https://git-scm.com/docs/git-sparse-checkout\" target=\"_blank\" rel=\"noopener\">git-sparse-checkout Documentation</a></p>\n</li>\n<li>\n<p><a href=\"https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/\" target=\"_blank\" rel=\"noopener\">Bring your monorepo down to size with sparse-checkout | The GitHub Blog</a></p>\n</li>\n<li>\n<p><a href=\"https://iucstscui.hatenablog.com/entry/2020/08/29/080322\" target=\"_blank\" rel=\"noopener\">git2.27以降にgit sparse-checkoutを使う場合はno-checkoutではなくsparseを使おう - はんなりと、ゆるやかに</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div id=\"footnotes\">\n<hr>\n<div class=\"footnote\" id=\"_footnotedef_1\">\n<a href=\"#_footnoteref_1\">1</a>. <em>git</em> 内部で使用されているオブジェクトタイプ。リポジトリ内の各ファイルの中身が保存されている。\n</div>\n<div class=\"footnote\" id=\"_footnotedef_2\">\n<a href=\"#_footnoteref_2\">2</a>. ディレクトリのようなもの。各オブジェクトの階層情報が保存されている。\n</div>\n<div class=\"footnote\" id=\"_footnotedef_3\">\n<a href=\"#_footnoteref_3\">3</a>. <code>HEAD</code> コミットだけは全てのデータがダウンロードされている。\n</div>\n<div class=\"footnote\" id=\"_footnotedef_4\">\n<a href=\"#_footnoteref_4\">4</a>. 通常のクローンと比較して、この例では <em>172MB</em> &#8594; <em>504KB</em> へとサイズ削減できた。\n</div>\n</div>","title":"巨大なリポジトリをクローンするときに便利なパーシャルクローンとsparse-checkout","created_at":"2021-07-22","tags":["git","partial-clone"],"updated_at":"2021-07-22","author":"秋々すすき","revision":"1.0"}