{"filename":"github_actions_dispatch.adoc","rendered":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">目次</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_はじめに\">はじめに</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_やりたいこと\">やりたいこと💭</a></li>\n<li><a href=\"#_やったこと\">やったこと💪</a></li>\n</ul>\n</li>\n<li><a href=\"#_方法について\">方法について🍣</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_ワークフローの手動実行\">ワークフローの手動実行</a></li>\n<li><a href=\"#_workflow_dispatch_イベント\"><code>workflow_dispatch</code> イベント</a></li>\n<li><a href=\"#_rest_api_からイベント発行\">REST API からイベント発行</a>\n<ul class=\"sectlevel3\">\n<li><a href=\"#_個人アクセストークン_personal_access_token_の作成\">個人アクセストークン（ <em>Personal Access Token</em> ）の作成</a></li>\n</ul>\n</li>\n<li><a href=\"#_別ワークフローからイベント発行\">別ワークフローからイベント発行</a></li>\n</ul>\n</li>\n<li><a href=\"#_おわりに\">おわりに😎</a></li>\n<li><a href=\"#_参考\">参考📖</a></li>\n</ul>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_はじめに\">はじめに</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_やりたいこと\">やりたいこと💭</h3>\n<div class=\"paragraph\">\n<p><code>orphan</code> ブランチの更新に合わせて <code>main</code> ブランチのワークフローを実行させたい。</p>\n</div>\n<div class=\"imageblock kroki\">\n<div class=\"content\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" contentScriptType=\"application/ecmascript\" contentStyleType=\"text/css\" height=\"384px\" preserveAspectRatio=\"none\" style=\"width:433px;height:384px;\" version=\"1.1\" viewBox=\"0 0 433 384\" width=\"433px\" zoomAndPan=\"magnify\"><defs><filter height=\"300%\" id=\"f1mp1nrsftwqus\" width=\"300%\" x=\"-1\" y=\"-1\"><feGaussianBlur result=\"blurOut\" stdDeviation=\"2.0\"/><feColorMatrix in=\"blurOut\" result=\"blurOut2\" type=\"matrix\" values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0\"/><feOffset dx=\"4.0\" dy=\"4.0\" in=\"blurOut2\" result=\"blurOut3\"/><feBlend in=\"SourceGraphic\" in2=\"blurOut3\" mode=\"normal\"/></filter></defs><g><rect fill=\"#FFFFFF\" filter=\"url(#f1mp1nrsftwqus)\" height=\"161.0001\" style=\"stroke: #A80036; stroke-width: 1.0;\" width=\"10\" x=\"152.5\" y=\"120.3999\"/><rect fill=\"#FFFFFF\" filter=\"url(#f1mp1nrsftwqus)\" height=\"59.2\" style=\"stroke: #A80036; stroke-width: 1.0;\" width=\"10\" x=\"250.5\" y=\"150\"/><rect fill=\"#FFFFFF\" filter=\"url(#f1mp1nrsftwqus)\" height=\"101.8\" style=\"stroke: #A80036; stroke-width: 1.0;\" width=\"10\" x=\"356\" y=\"179.6\"/><line style=\"stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;\" x1=\"22\" x2=\"22\" y1=\"88.7999\" y2=\"299.4\"/><line style=\"stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;\" x1=\"157.5\" x2=\"157.5\" y1=\"88.7999\" y2=\"299.4\"/><line style=\"stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;\" x1=\"255.5\" x2=\"255.5\" y1=\"88.7999\" y2=\"299.4\"/><line style=\"stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;\" x1=\"360.5\" x2=\"360.5\" y1=\"88.7999\" y2=\"299.4\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"29\" x=\"5\" y=\"85.9999\">User</text><ellipse cx=\"22.5\" cy=\"15\" fill=\"#FEFECE\" filter=\"url(#f1mp1nrsftwqus)\" rx=\"8\" ry=\"8\" style=\"stroke: #A80036; stroke-width: 2.0;\"/><path d=\"M22.5,23 L22.5,50 M9.5,31 L35.5,31 M22.5,50 L9.5,65 M22.5,50 L35.5,65 \" fill=\"none\" filter=\"url(#f1mp1nrsftwqus)\" style=\"stroke: #A80036; stroke-width: 2.0;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"29\" x=\"5\" y=\"312.3999\">User</text><ellipse cx=\"22.5\" cy=\"325.1999\" fill=\"#FEFECE\" filter=\"url(#f1mp1nrsftwqus)\" rx=\"8\" ry=\"8\" style=\"stroke: #A80036; stroke-width: 2.0;\"/><path d=\"M22.5,333.1999 L22.5,360.1999 M9.5,341.1999 L35.5,341.1999 M22.5,360.1999 L9.5,375.1999 M22.5,360.1999 L35.5,375.1999 \" fill=\"none\" filter=\"url(#f1mp1nrsftwqus)\" style=\"stroke: #A80036; stroke-width: 2.0;\"/><rect fill=\"#FEFECE\" filter=\"url(#f1mp1nrsftwqus)\" height=\"30.7999\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"58\" x=\"126.5\" y=\"53\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"44\" x=\"133.5\" y=\"73.9999\">GitHub</text><rect fill=\"#FEFECE\" filter=\"url(#f1mp1nrsftwqus)\" height=\"30.7999\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"58\" x=\"126.5\" y=\"298.4\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"44\" x=\"133.5\" y=\"319.3999\">GitHub</text><rect fill=\"#FEFECE\" filter=\"url(#f1mp1nrsftwqus)\" height=\"30.7999\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"100\" x=\"203.5\" y=\"53\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"86\" x=\"210.5\" y=\"73.9999\">OrphanAction</text><rect fill=\"#FEFECE\" filter=\"url(#f1mp1nrsftwqus)\" height=\"30.7999\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"100\" x=\"203.5\" y=\"298.4\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"86\" x=\"210.5\" y=\"319.3999\">OrphanAction</text><rect fill=\"#FEFECE\" filter=\"url(#f1mp1nrsftwqus)\" height=\"30.7999\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"83\" x=\"317.5\" y=\"53\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"69\" x=\"324.5\" y=\"73.9999\">MainAction</text><rect fill=\"#FEFECE\" filter=\"url(#f1mp1nrsftwqus)\" height=\"30.7999\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"83\" x=\"317.5\" y=\"298.4\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"69\" x=\"324.5\" y=\"319.3999\">MainAction</text><rect fill=\"#FFFFFF\" filter=\"url(#f1mp1nrsftwqus)\" height=\"161.0001\" style=\"stroke: #A80036; stroke-width: 1.0;\" width=\"10\" x=\"152.5\" y=\"120.3999\"/><rect fill=\"#FFFFFF\" filter=\"url(#f1mp1nrsftwqus)\" height=\"59.2\" style=\"stroke: #A80036; stroke-width: 1.0;\" width=\"10\" x=\"250.5\" y=\"150\"/><rect fill=\"#FFFFFF\" filter=\"url(#f1mp1nrsftwqus)\" height=\"101.8\" style=\"stroke: #A80036; stroke-width: 1.0;\" width=\"10\" x=\"356\" y=\"179.6\"/><line style=\"stroke: #A80036; stroke-width: 2.0;\" x1=\"134.5\" x2=\"144.5\" y1=\"115.3999\" y2=\"125.3999\"/><line style=\"stroke: #A80036; stroke-width: 2.0;\" x1=\"134.5\" x2=\"144.5\" y1=\"125.3999\" y2=\"115.3999\"/><line style=\"stroke: #A80036; stroke-width: 1.0;\" x1=\"22.5\" x2=\"139.5\" y1=\"120.3999\" y2=\"120.3999\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"111\" x=\"29.5\" y=\"115.7999\">push orphan branch</text><polygon fill=\"#A80036\" points=\"238.5,146,248.5,150,238.5,154,242.5,150\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.0;\" x1=\"162.5\" x2=\"244.5\" y1=\"150\" y2=\"150\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"69\" x=\"169.5\" y=\"145.4\">\"push\" event</text><line style=\"stroke: #A80036; stroke-width: 2.0;\" x1=\"338\" x2=\"348\" y1=\"174.6\" y2=\"184.6\"/><line style=\"stroke: #A80036; stroke-width: 2.0;\" x1=\"338\" x2=\"348\" y1=\"184.6\" y2=\"174.6\"/><line style=\"stroke: #A80036; stroke-width: 1.0;\" x1=\"260.5\" x2=\"343\" y1=\"179.6\" y2=\"179.6\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"70\" x=\"267.5\" y=\"175\">trigger event</text><polygon fill=\"#A80036\" points=\"173.5,205.2,163.5,209.2,173.5,213.2,169.5,209.2\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;\" x1=\"167.5\" x2=\"254.5\" y1=\"209.2\" y2=\"209.2\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"20\" x=\"179.5\" y=\"204.6\">exit</text><line style=\"stroke: #A80036; stroke-width: 1.0;\" x1=\"366\" x2=\"408\" y1=\"238.8\" y2=\"238.8\"/><line style=\"stroke: #A80036; stroke-width: 1.0;\" x1=\"408\" x2=\"408\" y1=\"238.8\" y2=\"251.8\"/><line style=\"stroke: #A80036; stroke-width: 1.0;\" x1=\"367\" x2=\"408\" y1=\"251.8\" y2=\"251.8\"/><polygon fill=\"#A80036\" points=\"377,247.8,367,251.8,377,255.8,373,251.8\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"53\" x=\"373\" y=\"234.2\">working...</text><polygon fill=\"#A80036\" points=\"168.5,277.4,158.5,281.4,168.5,285.4,164.5,281.4\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;\" x1=\"162.5\" x2=\"360\" y1=\"281.4\" y2=\"281.4\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"20\" x=\"174.5\" y=\"276.8\">exit</text><!--MD5=[b94d6e1a4c4c939a4251e672455345b0]\n@startuml\nactor User\n\nUser -x GitHub: push orphan branch\nactivate GitHub\n  GitHub -> OrphanAction: \"push\" event\n  activate OrphanAction\n    OrphanAction -x MainAction: trigger event\n    activate MainAction\n    GitHub <- - OrphanAction : exit\n  deactivate OrphanAction\n\n  MainAction -> MainAction: working...\n  MainAction - -> GitHub: exit\n  deactivate MainAction\ndeactivate GitHub\n@enduml\n\nPlantUML version 1.2020.19(Mon Oct 12 15:10:01 GMT 2020)\n(GPL source distribution)\nJava Runtime: OpenJDK Runtime Environment\nJVM: OpenJDK 64-Bit Server VM\nDefault Encoding: UTF-8\nLanguage: en\nCountry: US\n--></g></svg>\n</div>\n<div class=\"title\">Figure 1. やりたいことのイメージ</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_やったこと\">やったこと💪</h3>\n<div class=\"imageblock kroki\">\n<div class=\"content\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" contentScriptType=\"application/ecmascript\" contentStyleType=\"text/css\" height=\"513px\" preserveAspectRatio=\"none\" style=\"width:892px;height:513px;\" version=\"1.1\" viewBox=\"0 0 892 513\" width=\"892px\" zoomAndPan=\"magnify\"><defs><filter height=\"300%\" id=\"f1eue1h9643946\" width=\"300%\" x=\"-1\" y=\"-1\"><feGaussianBlur result=\"blurOut\" stdDeviation=\"2.0\"/><feColorMatrix in=\"blurOut\" result=\"blurOut2\" type=\"matrix\" values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0\"/><feOffset dx=\"4.0\" dy=\"4.0\" in=\"blurOut2\" result=\"blurOut3\"/><feBlend in=\"SourceGraphic\" in2=\"blurOut3\" mode=\"normal\"/></filter></defs><g><ellipse cx=\"278.5\" cy=\"48.6998\" fill=\"#000000\" filter=\"url(#f1eue1h9643946)\" rx=\"10\" ry=\"10\" style=\"stroke: none; stroke-width: 1.0;\"/><rect fill=\"#000000\" filter=\"url(#f1eue1h9643946)\" height=\"6\" rx=\"2.5\" ry=\"2.5\" style=\"stroke: #000000; stroke-width: 1.0;\" width=\"497\" x=\"21\" y=\"78.6998\"/><path d=\"M211,115.7 L211,132.3 L191,136.3 L211,140.3 L211,156.9 A0,0 0 0 0 211,156.9 L346,156.9 A0,0 0 0 0 346,156.9 L346,125.7 L336,115.7 L211,115.7 A0,0 0 0 0 211,115.7 \" fill=\"#FBFB77\" filter=\"url(#f1eue1h9643946)\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><path d=\"M336,115.7 L336,125.7 L346,125.7 L336,115.7 \" fill=\"#FBFB77\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"17\" x=\"217\" y=\"133.7\">on:</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"108\" x=\"223\" y=\"149.3\">workflow_dispatch:</text><rect fill=\"#FEFECE\" filter=\"url(#f1eue1h9643946)\" height=\"63.2003\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"158\" x=\"33\" y=\"104.6998\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"70\" x=\"43\" y=\"126.6999\">ワークフローで</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"138\" x=\"43\" y=\"141.1\">workflow_dispatchイベント</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"110\" x=\"43\" y=\"155.5001\">をトリガーするよう追記</text><rect fill=\"#FEFECE\" filter=\"url(#f1eue1h9643946)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"105\" x=\"59.5\" y=\"202.3002\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"85\" x=\"69.5\" y=\"224.3003\">リポジトリにpush</text><rect fill=\"#FEFECE\" filter=\"url(#f1eue1h9643946)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"150\" x=\"356\" y=\"119.0999\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"130\" x=\"366\" y=\"141.1\">個人アクセストークンを作成</text><rect fill=\"#FEFECE\" filter=\"url(#f1eue1h9643946)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"83\" x=\"389.5\" y=\"187.9001\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"63\" x=\"399.5\" y=\"209.9002\">Secretに登録</text><rect fill=\"#000000\" filter=\"url(#f1eue1h9643946)\" height=\"6\" rx=\"2.5\" ry=\"2.5\" style=\"stroke: #000000; stroke-width: 1.0;\" width=\"497\" x=\"21\" y=\"256.7003\"/><line style=\"stroke: #000000; stroke-width: 2.0;\" x1=\"15\" x2=\"15\" y1=\"12.1\" y2=\"496.7008\"/><rect fill=\"#FEFECE\" filter=\"url(#f1eue1h9643946)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"150\" x=\"543\" y=\"282.7003\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"130\" x=\"553\" y=\"304.7004\">ワークフロー・ファイル作成</text><path d=\"M722,348.1006 L722,364.7006 L702,368.7006 L722,372.7006 L722,389.3006 A0,0 0 0 0 722,389.3006 L868,389.3006 A0,0 0 0 0 868,389.3006 L868,358.1006 L858,348.1006 L722,348.1006 A0,0 0 0 0 722,348.1006 \" fill=\"#FBFB77\" filter=\"url(#f1eue1h9643946)\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><path d=\"M858,348.1006 L858,358.1006 L868,358.1006 L858,348.1006 \" fill=\"#FBFB77\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"33\" x=\"728\" y=\"366.1006\">steps:</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"119\" x=\"734\" y=\"381.7006\">- run: curl -X POST ...</text><rect fill=\"#FEFECE\" filter=\"url(#f1eue1h9643946)\" height=\"63.2003\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"168\" x=\"534\" y=\"337.1004\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"65\" x=\"544\" y=\"359.1005\">main.yamlに</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"148\" x=\"544\" y=\"373.5006\">workflow_dispatchイベントを</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"92\" x=\"544\" y=\"387.9007\">送信するstepを作成</text><rect fill=\"#FEFECE\" filter=\"url(#f1eue1h9643946)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"105\" x=\"565.5\" y=\"420.3007\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"85\" x=\"575.5\" y=\"442.3008\">リポジトリにpush</text><ellipse cx=\"618\" cy=\"485.7008\" fill=\"#FFFFFF\" filter=\"url(#f1eue1h9643946)\" rx=\"11\" ry=\"11\" style=\"stroke: #000000; stroke-width: 1.0;\"/><ellipse cx=\"618\" cy=\"485.7008\" fill=\"#000000\" rx=\"6\" ry=\"6\" style=\"stroke: #7F7F7F; stroke-width: 1.0;\"/><line style=\"stroke: #000000; stroke-width: 2.0;\" x1=\"528\" x2=\"528\" y1=\"12.1\" y2=\"496.7008\"/><line style=\"stroke: #000000; stroke-width: 2.0;\" x1=\"873\" x2=\"873\" y1=\"12.1\" y2=\"496.7008\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"112\" x2=\"112\" y1=\"167.9001\" y2=\"202.3002\"/><polygon fill=\"#A80036\" points=\"108,192.3002,112,202.3002,116,192.3002,112,196.3002\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"431\" x2=\"431\" y1=\"153.5\" y2=\"187.9001\"/><polygon fill=\"#A80036\" points=\"427,177.9001,431,187.9001,435,177.9001,431,181.9001\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"112\" x2=\"112\" y1=\"84.6998\" y2=\"104.6998\"/><polygon fill=\"#A80036\" points=\"108,94.6998,112,104.6998,116,94.6998,112,98.6998\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"431\" x2=\"431\" y1=\"84.6998\" y2=\"119.0999\"/><polygon fill=\"#A80036\" points=\"427,109.0999,431,119.0999,435,109.0999,431,113.0999\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"112\" x2=\"112\" y1=\"236.7003\" y2=\"256.7003\"/><polygon fill=\"#A80036\" points=\"108,246.7003,112,256.7003,116,246.7003,112,250.7003\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"431\" x2=\"431\" y1=\"222.3002\" y2=\"256.7003\"/><polygon fill=\"#A80036\" points=\"427,246.7003,431,256.7003,435,246.7003,431,250.7003\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"278.5\" x2=\"278.5\" y1=\"58.6998\" y2=\"78.6998\"/><polygon fill=\"#A80036\" points=\"274.5,68.6998,278.5,78.6998,282.5,68.6998,278.5,72.6998\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"618\" x2=\"618\" y1=\"317.1004\" y2=\"337.1004\"/><polygon fill=\"#A80036\" points=\"614,327.1004,618,337.1004,622,327.1004,618,331.1004\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"618\" x2=\"618\" y1=\"400.3007\" y2=\"420.3007\"/><polygon fill=\"#A80036\" points=\"614,410.3007,618,420.3007,622,410.3007,618,414.3007\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"618\" x2=\"618\" y1=\"454.7008\" y2=\"474.7008\"/><polygon fill=\"#A80036\" points=\"614,464.7008,618,474.7008,622,464.7008,618,468.7008\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"278.5\" x2=\"278.5\" y1=\"262.7003\" y2=\"267.7003\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"278.5\" x2=\"618\" y1=\"267.7003\" y2=\"267.7003\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"618\" x2=\"618\" y1=\"267.7003\" y2=\"282.7003\"/><polygon fill=\"#A80036\" points=\"614,272.7003,618,282.7003,622,272.7003,618,276.7003\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"18\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"95\" x=\"224\" y=\"30.0999\">mainブランチ</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"18\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"112\" x=\"644.5\" y=\"30.0999\">orphanブランチ</text><!--MD5=[e89283ace5f2f8e54c458e6d0da00662]\n@startuml\n|mainブランチ|\nstart\n\nfork\n  :ワークフローで\n  workflow_dispatchイベント\n  をトリガーするよう追記;\n  note right\n  on:\n    workflow_dispatch:\n  end note\n  :リポジトリにpush;\nfork again\n  :個人アクセストークンを作成;\n  :Secretに登録;\nend fork\n\n|orphanブランチ|\n:ワークフロー・ファイル作成;\n:main.yamlに\nworkflow_dispatchイベントを\n送信するstepを作成;\nnote right\nsteps:\n  - run: curl -X POST ...\nend note\n:リポジトリにpush;\n\nstop\n@enduml\n\nPlantUML version 1.2020.19(Mon Oct 12 15:10:01 GMT 2020)\n(GPL source distribution)\nJava Runtime: OpenJDK Runtime Environment\nJVM: OpenJDK 64-Bit Server VM\nDefault Encoding: UTF-8\nLanguage: en\nCountry: US\n--></g></svg>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>簡単にできた😊。</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_方法について\">方法について🍣</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_ワークフローの手動実行\">ワークフローの手動実行</h3>\n<div class=\"paragraph\">\n<p>ここでの手動実行とは、<em>GitHub</em> 上から実行したり <em>REST API</em> から実行したりすること。<br>\n今回は他ワークフローを呼び出したいので、<em>REST API</em> から実行することを目指す。</p>\n</div>\n<div class=\"paragraph\">\n<p>ワークフロー・イベントを次のどちらかに指定しておけば <em>REST API</em> からそのイベントを受信できる。</p>\n</div>\n<table class=\"tableblock frame-all grid-all stretch\">\n<caption class=\"title\">Table 1. 手動実行が可能となるイベント</caption>\n<colgroup>\n<col style=\"width: 33.3333%;\">\n<col style=\"width: 66.6667%;\">\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">イベント</th>\n<th class=\"tableblock halign-left valign-top\">特徴</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><strong><code>workflow_dispatch</code></strong></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">特定（単一）のワークフローを実行する<br>\nブランチやタグの指定も可能</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><code>repository_dispatch</code></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">複数のワークフローを実行する<br>\nカスタムイベントやイベント型を作成可能</p></td>\n</tr>\n</tbody>\n</table>\n<div class=\"paragraph\">\n<p>他のワークフローを呼び出す目的には <code>workflow_dispatch</code> イベントが必要十分。</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_workflow_dispatch_イベント\"><code>workflow_dispatch</code> イベント</h3>\n<div class=\"paragraph\">\n<p>特定のワークフローを実行するために使われるイベント。<br>\nイベント発行時にブランチやタグの指定が可能。</p>\n</div>\n<div class=\"paragraph\">\n<p>デフォルト入力値やプロパティの定義は <code>github.event.inputs</code> コンテキストで設定可能。</p>\n</div>\n<div class=\"paragraph\">\n<p><strong><em>REST API</em> から呼び出される</strong> ワークフローがこのイベントをトリガーとするように指定する（今回だと <code>main</code> ブランチのワークフローに設定）。</p>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 1. mainブランチのワークフロー例</div>\n<div class=\"content\">\n<div \n    class=\"listingblock\">\n<div class=\"title\">.github/workflows/main.yaml</div>\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-yaml\"\n    data-lang=\"yaml\">on:\n  push:\n    branches:\n      - main\n  workflow_dispatch:  # <b class=\"conum\">(1)</b>\n    branches:\n      - main\n\njobs:\n  build:\n    runs-on: ubuntu-18.04\n    steps:\n      - run: ...</code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<ol>\n<li>\n<p><code>workflow_dispatch</code> イベントをトリガー</p>\n</li>\n</ol>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_rest_api_からイベント発行\">REST API からイベント発行</h3>\n<div class=\"paragraph\">\n<p>上記で編集したワークフローが手動実行できるかどうか、ローカルのシェルから試してみる。</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">ローカル端末からワークフローを実行</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">curl -X POST \\\n  -H \"Authorization: token ${GITHUB_TOKEN}\" \\\n  -H \"Accept: application/vnd.github.v3+json\" \\\n  https://api.github.com/repos/${owner}/${repo}/actions/workflows/${workflow_id}/dispatches \\\n  -d '{\"ref\": \"main\"}'</code></pre>\n  </div>\n</div>\n<table class=\"tableblock frame-all grid-all stretch\">\n<colgroup>\n<col style=\"width: 20%;\">\n<col style=\"width: 80%;\">\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">プロパティ</th>\n<th class=\"tableblock halign-left valign-top\">説明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">GITHUB_TOKEN</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">個人アクセストークン（<em>Personal Access Token</em>）。<br>\n<code>repo</code> スコープ（プライベートリポジトリを含む）ないし<br>\n<code>public_repo</code> スコープの許可が必要。</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">owner</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">リポジトリの所有者名</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">repo</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">リポジトリ名</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">workflow_id</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">イベント送信先の ワークフローID または<br>\nワークフローの拡張子つきファイル名（例えば <code>main.yaml</code> ）</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">{\"ref\": \"&#8230;&#8203;\"}</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">ブランチやタグを指定する</p></td>\n</tr>\n</tbody>\n</table>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\"><span class=\"material-icons cursor-default\" alt=\"Note\" title=\"Note\">create</span></div>\n</td>\n<td class=\"content\">\nワークフローIDは <em>REST API</em> から取得する必要があるため、ファイル名を指定するほうが簡単。\n</td>\n</tr>\n</table>\n</div>\n<div class=\"admonitionblock warning\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\"><span class=\"material-icons cursor-default\" alt=\"Warning\" title=\"Warning\">warning</span></div>\n</td>\n<td class=\"content\">\n個人アクセストークンは直書きせず、環境変数やパスワードマネージャーで設定する。\n</td>\n</tr>\n</table>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_個人アクセストークン_personal_access_token_の作成\">個人アクセストークン（ <em>Personal Access Token</em> ）の作成</h4>\n<div class=\"paragraph\">\n<p><em>REST API</em> を使うために作成。<br>\n以前に作成して <em>Secrets</em> 登録したやつがあったのでそれを使った。</p>\n</div>\n<div class=\"paragraph\">\n<p>新規作成する場合は、下記ドキュメントを参考にする。</p>\n</div>\n<div class=\"olist arabic\">\n<ol class=\"arabic\">\n<li>\n<p><a href=\"https://docs.github.com/ja/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token\" target=\"_blank\" rel=\"noopener\">個人アクセストークンを使用する</a> を参考に作成</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>repo</code> または <code>public_repo</code> スコープを許可する</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p>作成したトークンは <a href=\"https://docs.github.com/ja/free-pro-team@latest/actions/reference/encrypted-secrets\" target=\"_blank\" rel=\"noopener\">暗号化されたシークレット</a> を参考にリポジトリの <em>Secrets</em> に登録</p>\n</li>\n</ol>\n</div>\n<div class=\"paragraph\">\n<p>登録した <em>Secrets</em> はワークフローにおいて <code>${{ secrets.XXX }}</code> という形で参照できる。</p>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_別ワークフローからイベント発行\">別ワークフローからイベント発行</h3>\n<div class=\"paragraph\">\n<p>上記の <code>curl</code> コマンドをワークフロー内で実行すればいい。</p>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 2. <code>orphan</code> ブランチのワークフロー例</div>\n<div class=\"content\">\n<div \n    class=\"listingblock\">\n<div class=\"title\">.github/workflows/orphan.yaml</div>\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-yaml\"\n    data-lang=\"yaml\">on:\n  push:\n    branches:\n      - orphan-branch\n\nenv:  # <b class=\"conum\">(1)</b>\n  WORKFLOW_ID: main.yml\n  DISPATCH_API: https://api.github.com/repos/$GITHUB_REPOSITORY/actions/workflows/$WORKFLOW_ID/dispatches\n\njobs:\n  trigger:\n    runs-on: ubuntu-18.04\n    steps:\n      - name: logger\n        run: echo \"::debug::POST to ${{ env.DISPATCH_API }}\"\n\n      - name: publish the event  # <b class=\"conum\">(2)</b>\n        run: |\n          curl -X POST \\\n            -H \"Authorization: token ${{ secrets.PERSONAL_TOKEN }}\" \\\n            -H \"Accept: application/vnd.github.v3+json\" \\\n            ${{ env.DISPATCH_API }} \\\n            -d '{\"ref\": \"main\"}'</code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<ol>\n<li>\n<p>環境変数としてURLを設定</p>\n</li>\n<li>\n<p><em>REST API</em> から <code>workflow_dispatch</code> イベントを発行</p>\n</li>\n</ol>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\"><span class=\"material-icons cursor-default\" alt=\"Note\" title=\"Note\">create</span></div>\n</td>\n<td class=\"content\">\n<code>GITHUB_REPOSITORY</code> はデフォルト環境変数で、 <code>オーナー名/リポジトリ名</code> が設定されている。\n</td>\n</tr>\n</table>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\"><span class=\"material-icons cursor-default\" alt=\"Note\" title=\"Note\">create</span></div>\n</td>\n<td class=\"content\">\n<code>env</code> の変数で他の環境変数を使った場合に <code>steps</code> 内で参照するときは、<br>\n<code>${{ env.XXX }}</code> としないとうまく環境変数を展開してくれなかった。\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_おわりに\">おわりに😎</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>以上で <code>orphan</code> ブランチを更新すれば <code>main</code> ブランチの <em>GitHub Actions</em> が実行するようにできた。</p>\n</div>\n<div class=\"paragraph\">\n<p>これで <em>Nuxt</em> プログラムコードと記事ソースのブランチを分けて、記事だけを更新しても自動的にデプロイ用ワークフローを実行してくれるようにできた。<br>\nおかげでブログ更新も捗る……といいな！🙄<span class=\"line-through\">進捗どうですか</span>。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\">参考📖</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://docs.github.com/ja/free-pro-team@latest/actions/reference/events-that-trigger-workflows\" target=\"_blank\" rel=\"noopener\">ワークフローをトリガーするイベント - GitHub Docs</a></p>\n</li>\n<li>\n<p><a href=\"https://docs.github.com/en/free-pro-team@latest/rest/reference/actions#workflows\" target=\"_blank\" rel=\"noopener\">Actions#workflows - GitHub Docs</a></p>\n</li>\n<li>\n<p><a href=\"https://docs.github.com/ja/free-pro-team@latest/rest/guides/getting-started-with-the-rest-api\" target=\"_blank\" rel=\"noopener\">REST API を使ってみる - GitHub Docs</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","title":"Github Actions を手動実行するための workflow_dispatch イベント","created_at":"2020-11-13","tags":["github","github-actions"],"updated_at":"2020-11-19","author":"秋々すすき","revision":"1.1"}