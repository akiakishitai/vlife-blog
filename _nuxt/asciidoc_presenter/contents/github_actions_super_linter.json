{"filename":"github_actions_super_linter.adoc","rendered":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">目次</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_はじめに\">はじめに📝</a></li>\n<li><a href=\"#_使ってみた感想\">使ってみた感想🤗</a></li>\n<li><a href=\"#_設定\">設定🧪</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_各リンターの規約設定\">各リンターの規約設定</a></li>\n<li><a href=\"#_チェックする言語の選択\">チェックする言語の選択</a></li>\n<li><a href=\"#_レポートの出力\">レポートの出力</a>\n<ul class=\"sectlevel3\">\n<li><a href=\"#_レポートについて\">レポートについて</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#_トラブルシューティング\">トラブルシューティング🛠️</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_新規ファイルが認識されない\">新規ファイルが認識されない</a></li>\n</ul>\n</li>\n<li><a href=\"#_参考\">参考📖</a></li>\n</ul>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_はじめに\">はじめに📝</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>GitHub公式の全部のせ <em>linter</em> アクションである <a href=\"https://github.com/github/super-linter\" target=\"_blank\" rel=\"noopener\"><em>Super Linter</em></a> を使ってみたときのメモ。</p>\n</div>\n<table class=\"tableblock frame-all grid-all fit-content\">\n<caption class=\"title\">Table 1. 環境</caption>\n<colgroup>\n<col>\n<col>\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">Name</th>\n<th class=\"tableblock halign-left valign-top\">Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Super Linter</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">3.14.3</p></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_使ってみた感想\">使ってみた感想🤗</h2>\n<div class=\"sectionbody\">\n<div class=\"dlist\">\n<dl>\n<dt class=\"hdlist1\"><span class=\"flex items-center text-green-500\"><span class=\"material-icons\">check</span>メリット</span></dt>\n<dd>\n<p>様々なリンターが全部つめ込まれて設定済みなので、リンターを利用するまでにかかる手間が少ない。<br>\n迷ったらとりあえず <em>Super Linter</em> を使ってみたらいい。</p>\n</dd>\n<dt class=\"hdlist1\"><span class=\"flex items-center text-red-500\"><span class=\"material-icons\">close</span>デメリット</span></dt>\n<dd>\n<p>Dockerイメージのサイズがかなり大きいため、実行開始までの時間が長い（2~3分）。<br>\n実行結果のログ（レポート）の確認がしづらい。リポジトリの <em>Actions</em> タブからコンソールログを見に行くか、アーティファクトとして保存したレポートを取得するか。</p>\n</dd>\n</dl>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_設定\">設定🧪</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>よく使いそうな設定について抜粋。</p>\n</div>\n<details>\n<summary class=\"title\">Super Linter ワークフローのサンプル</summary>\n<div class=\"content\">\n<div \n    class=\"listingblock\">\n\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-yaml\"\n    data-lang=\"yaml\">name: Super-Linter\n\non:\n  pull_request:\n\njobs:\n  linter:\n    runs-on: ubuntu-20.04\n    steps:\n      - name: checkout\n        uses: actions/checkout@v2\n        with:\n          fetch-depth: 0\n\n      - name: lint\n        # ref: https://github.com/github/super-linter\n        uses: docker://github/super-linter:v3.14.3  #<b class=\"conum\">(1)</b>\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n          # ACTIONS_RUNNER_DEBUG: true\n          DEFAULT_BRANCH: main\n          OUTPUT_FORMAT: tap\n          OUTPUT_DETAILS: detailed\n          DISABLE_ERRORS: true\n          VALIDATE_ALL_CODEBASE: true\n          # use standard.js\n          VALIDATE_JAVASCRIPT_ES: false\n          VALIDATE_TYPESCRIPT_ES: false\n\n      - name: upload reports  #<b class=\"conum\">(2)</b>\n        uses: actions/upload-artifact@v2\n        with:\n          name: super-linter\n          path: super-linter.report/</code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<ol>\n<li>\n<p>時間短縮のためにビルド済みDockerイメージを利用。<br>\nパブリックアクションを利用すると処理がDockerイメージのビルドから行われてしまう。</p>\n</li>\n<li>\n<p>出力されたレポートをアーティファクトとして保存。</p>\n</li>\n</ol>\n</div>\n</div>\n</details>\n<div class=\"sect2\">\n<h3 id=\"_各リンターの規約設定\">各リンターの規約設定</h3>\n<div class=\"paragraph\">\n<p><em>Super Linter</em> によってデフォルト設定されているので特に設定しなくても動作する。</p>\n</div>\n<div class=\"paragraph\">\n<p>カスタマイズしたい場合は <code>.github/linters/</code> ディレクトリ以下に各設定ファイルを配置する（ディレクトリやファイルパスは環境変数で変更可能）。</p>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\"><span class=\"material-icons cursor-default\" alt=\"Note\" title=\"Note\">create</span></div>\n</td>\n<td class=\"content\">\n<div class=\"title\">Super Linter のデフォルト設定</div>\n<a href=\"https://github.com/github/super-linter/tree/master/TEMPLATES\"><em>Super Linter</em> リポジトリの TEMPLATES ディレクトリ</a>に各設定ファイルが存在する。\n</td>\n</tr>\n</table>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_チェックする言語の選択\">チェックする言語の選択</h3>\n<div class=\"paragraph\">\n<p><em>Super Linter</em> でチェックする言語の選択には <code>VALIDATE_[language]</code> 変数を使用して制御する。<br>\n以下のように、ちょっと特殊な動作をする。</p>\n</div>\n<table class=\"tableblock frame-all grid-all fit-content\">\n<colgroup>\n<col>\n<col>\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">VALIDATE_[language] 変数</th>\n<th class=\"tableblock halign-left valign-top\">動作</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">すべて指定してない（デフォルト）</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">すべての言語が有効となる。</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">いずれかの変数が <code>true</code></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><strong><code>true</code> に設定した言語のみが有効。</strong><br>\n他の言語は無効となる。</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">いずれかの変数が <code>false</code></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><strong><code>false</code> に設定した言語のみが無効。</strong><br>\n他の言語は有効となる。</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><code>true</code> と <code>false</code> 設定が混在</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">エラー。</p></td>\n</tr>\n</tbody>\n</table>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_レポートの出力\">レポートの出力</h3>\n<div class=\"paragraph\">\n<p>出力させるには <code>OUTPUT_FORMAT</code> オプションを設定しておく必要があることに注意する（<a href=\"https://github.com/github/super-linter/issues/584#issuecomment-680083356\" target=\"_blank\" rel=\"noopener\">参考</a>）。</p>\n</div>\n<div \n    class=\"listingblock\">\n<div class=\"title\">レポートを出力する設定例</div>\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-yaml\"\n    data-lang=\"yaml\">- uses: docker://github/super-linter:v3.14.3\n  env:\n    OUTPUT_FORMAT: tap  #<b class=\"conum\">(1)</b>\n    OUTPUT_FOLDER: super-linter.report  #<b class=\"conum\">(2)</b>\n    OUTPUT_DETAILS: detailed  #<b class=\"conum\">(3)</b>\n\n- uses: actions/upload-artifact@v2  #<b class=\"conum\">(4)</b>\n  with:\n    name: super-linter\n    path: super-linter.report/</code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<ol>\n<li>\n<p>出力する場合には指定が<strong>必須</strong>。現状では指定できる値は <code>tap</code> のみ。</p>\n</li>\n<li>\n<p>出力先ディレクトリ。<br>\nデフォルトは <code>super-linter.report</code> ディレクトリが指定されている。</p>\n</li>\n<li>\n<p>レポートの詳細度。<code>simpler</code> （デフォルト）または <code>detailed</code> が指定可能。</p>\n</li>\n<li>\n<p>必要ならレポートをアーティファクトとして保存。</p>\n</li>\n</ol>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\"><span class=\"material-icons cursor-default\" alt=\"Note\" title=\"Note\">create</span></div>\n</td>\n<td class=\"content\">\n出力されるレポートのファイル名は <code>super-linter-&lt;LANGUAGE&gt;.tap</code> となる。\n</td>\n</tr>\n</table>\n</div>\n<div class=\"sect3\">\n<h4 id=\"_レポートについて\">レポートについて</h4>\n<div class=\"paragraph\">\n<p><em>Super Linter</em> のレポートは <em>tap</em> (<a href=\"https://testanything.org\" target=\"_blank\" rel=\"noopener\">Test Anything Protocol</a>)形式で出力される。<br>\nそして <code>message</code> プロパティに各 <em>linter</em> からの出力メッセージをそのまま記述しているみたい。</p>\n</div>\n<details>\n<summary class=\"title\">出力ログの例</summary>\n<div class=\"content\">\n<div \n    class=\"listingblock\">\n\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-text\"\n    data-lang=\"text\">TAP version 13\n1..8\nok 1 - labels.yml\nok 2 - semantic.yml\nok 3 - automerge.yml\nok 4 - ci.yml\nok 5 - create-pr.yml\nok 6 - label-manager.yml\nok 7 - labeler.yml\nok 8 - linter.yml\n\nTAP version 13\n1..2\nnot ok 1 - pull_request_template.md\n  ---\n  message: /github/workspace/.github/pull_request_template.md 1 MD041/first-line-heading/first-line-h1 First line in file should be a top level heading [Context  \"## Proposed Changes - 変更点の要約\"]\\n\n  ...\nok 2 - README.md\n\nTAP version 13\n1..1\nnot ok 1 - wrong.js\n  ---\n  message: standard  Use JavaScript Standard Style (https //standardjs.com)\\nstandard  Run `standard --fix` to automatically fix some problems.\\n  /github/workspace/test/wrong.js  'wrong' is defined but never used.\\n  /github/workspace/test/wrong.js  Missing space before function parentheses.\\n  /github/workspace/test/wrong.js  Opening curly brace does not appear on the same line as controlling statement.\\n  /github/workspace/test/wrong.js  Expected indentation of 2 spaces but found 16.\\n  /github/workspace/test/wrong.js  'miss' is assigned a value but never used.\\n  /github/workspace/test/wrong.js  Extra semicolon.\\n  /github/workspace/test/wrong.js  Expected indentation of 2 spaces but found 0.\\n  /github/workspace/test/wrong.js  Extra semicolon.\\n  /github/workspace/test/wrong.js  Missing whitespace after semicolon.\\n\n  ...</code></pre>\n  </div>\n</div>\n</div>\n</details>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_トラブルシューティング\">トラブルシューティング🛠️</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_新規ファイルが認識されない\">新規ファイルが認識されない</h3>\n<div class=\"paragraph\">\n<p>変更ファイルのみを対象にしようとして <code>VALIDATE_ALL_CODEBASE: false</code> にした場合に発生。</p>\n</div>\n<div class=\"dlist\">\n<dl>\n<dt class=\"hdlist1\">原因</dt>\n<dd>\n<p><em>Super Linter</em> は <code>DEFAULT_BRANCH</code> にチェックアウトするため、このとき新規追加ファイルはファイルシステム上から削除されてしまう。<br>\nこれにより検証がスキップされる。</p>\n</dd>\n<dt class=\"hdlist1\">対策</dt>\n<dd>\n<p>新規追加ファイルも検証したいなら <code>VALIDATE_ALL_CODEBASE: true</code> にしておく。</p>\n<div class=\"paragraph\">\n<p>ファイルが多すぎる場合は <code>FILTER_REGEX_EXCLUDE</code> 変数や <code>FILTER_REGEX_INCLUDE</code> 変数で検証するファイルを制限する。<br>\nもしくは <em>Super Linter</em> を諦めて個別の <em>linter</em> の導入を考える。</p>\n</div>\n</dd>\n</dl>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\">参考📖</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://github.com/github/super-linter\" target=\"_blank\" rel=\"noopener\">github/super-linter</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","title":"GitHubのSuper Linterを使ってみる","created_at":"2020-12-28","tags":["github","github-actions","linter","備忘録"],"updated_at":"2020-12-28","author":"秋々すすき","revision":"1.0"}