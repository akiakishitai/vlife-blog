{
  "filename": "golang_and_rust_statically_linked.adoc",
  "rendered": [
    "<div id=\"toc\" class=\"toc\">",
    "<div id=\"toctitle\">ç›®æ¬¡</div>",
    "<ul class=\"sectlevel1\">",
    "<li><a href=\"#_å‹•æ©Ÿ\">ğŸª“å‹•æ©Ÿ</a></li>",
    "<li><a href=\"#_ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³\">âš™ï¸ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³</a>",
    "<ul class=\"sectlevel2\">",
    "<li><a href=\"#_go_è¨€èª\">Go è¨€èª</a></li>",
    "<li><a href=\"#_rust_è¨€èª\">Rust è¨€èª</a></li>",
    "</ul>",
    "</li>",
    "<li><a href=\"#_dockerfile_ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®åˆ©ç”¨ä¾‹\">ğŸ³ <em>Dockerfile</em> ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®åˆ©ç”¨ä¾‹</a></li>",
    "<li><a href=\"#_å‚è€ƒ\">ğŸ“–å‚è€ƒ</a></li>",
    "</ul>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_å‹•æ©Ÿ\">ğŸª“å‹•æ©Ÿ</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p>ãŸã¨ãˆã° <em>Alpine</em> ã§ãƒ“ãƒ«ãƒ‰ã—ãŸã®ã¡ã€ä»–ã® <em>Linux</em> ã§ã‚‚å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«é™çš„ãƒªãƒ³ã‚¯ã§ãƒ“ãƒ«ãƒ‰ã•ã›ãŸã„ã€‚</p>",
    "</div>",
    "<table class=\"tableblock frame-all grid-all stretch\">",
    "<caption class=\"title\">Table 1. å®Ÿè¡Œç’°å¢ƒ</caption>",
    "<colgroup>",
    "<col style=\"width: 50%;\">",
    "<col style=\"width: 50%;\">",
    "</colgroup>",
    "<thead>",
    "<tr>",
    "<th class=\"tableblock halign-left valign-top\">Tool</th>",
    "<th class=\"tableblock halign-left valign-top\">Version</th>",
    "</tr>",
    "</thead>",
    "<tbody>",
    "<tr>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><em>go</em></p></td>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">1.16.5</p></td>",
    "</tr>",
    "<tr>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><em>rustup</em></p></td>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">1.24.3</p></td>",
    "</tr>",
    "<tr>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><em>rustc</em></p></td>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">1.53.0</p></td>",
    "</tr>",
    "<tr>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><em>cargo</em></p></td>",
    "<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">1.53.0</p></td>",
    "</tr>",
    "</tbody>",
    "</table>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³\">âš™ï¸ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"sect2\">",
    "<h3 id=\"_go_è¨€èª\">Go è¨€èª</h3>",
    "<div class=\"paragraph\">",
    "<p><em>C</em> è¨€èªã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã™ <em>cgo</em> ã‚’ä½¿ã£ã¦ã„ã‚‹ã¨å‹•çš„ãƒªãƒ³ã‚¯ã•ã‚Œã‚‹ã‚‰ã—ã„ã€‚<br>",
    "ã‚ˆã£ã¦ <em>cgo</em> ã‚’ç„¡åŠ¹åŒ–ã—ãŸã‚Šã€ãƒªãƒ³ã‚«ãƒ¼ã«é™çš„ãƒªãƒ³ã‚¯ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã—ãŸã‚Šã™ã‚‹ã€‚</p>",
    "</div>",
    "<div class=\"exampleblock\">",
    "<div class=\"title\">Example 1. Go</div>",
    "<div class=\"content\">",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-user=\"user\"",
    "    data-host=\"local\"",
    "    ><code class=\"language-bash\"",
    "    data-lang=\"bash\">export CGO_ENABLED=0    <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>",
    "go build -ldflags '-extldflags=-static'   <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>",
    "strip /path/to/binary   <i class=\"conum\" data-value=\"3\"></i><b>(3)</b></code></pre>",
    "  </div>",
    "</div>",
    "<div class=\"colist arabic\">",
    "<table>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>",
    "<td><em>C</em> è¨€èªã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨ã—ã¦ãªã„å ´åˆã¯ <code>cgo</code> ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã ã‘ã§é™çš„ãƒªãƒ³ã‚¯ã«ãªã‚‹ã€‚</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>",
    "<td>ãƒªãƒ³ã‚«ãƒ¼ã«é™çš„ãƒªãƒ³ã‚¯ã§ã‚ã‚‹ã“ã¨ã‚’ä¼ãˆã¦ãƒ“ãƒ«ãƒ‰ã€‚<br>",
    "åˆ©ç”¨ã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ˆã£ã¦ã¯ <code>-tags</code> ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ä½¿ã£ã¦ <code>cgo</code> éƒ¨åˆ†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã€‚</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>",
    "<td>ãƒ‡ãƒãƒƒã‚°ã«ç”¨ã„ã‚‰ã‚Œã‚‹ã‚·ãƒ³ãƒœãƒ«æƒ…å ±ã‚’å‰Šé™¤ã—ã¦ã‚µã‚¤ã‚ºç¸®å°ã€‚</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect2\">",
    "<h3 id=\"_rust_è¨€èª\">Rust è¨€èª</h3>",
    "<div class=\"paragraph\">",
    "<p><code>*-musl</code> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚Œã°é™çš„ãƒªãƒ³ã‚¯ã«ãªã‚‹ã€‚</p>",
    "</div>",
    "<div class=\"exampleblock\">",
    "<div class=\"title\">Example 2. Rust</div>",
    "<div class=\"content\">",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "<div class=\"title\">x86_64 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å ´åˆ</div>",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-user=\"user\"",
    "    data-host=\"local\"",
    "    ><code class=\"language-bash\"",
    "    data-lang=\"bash\">rustup target add x86_64-unknown-linux-musl   <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>",
    "cargo build --release --target x86_64-unknown-linux-musl  <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>",
    "strip /path/to/binary   <i class=\"conum\" data-value=\"3\"></i><b>(3)</b></code></pre>",
    "  </div>",
    "</div>",
    "<div class=\"colist arabic\">",
    "<table>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>",
    "<td><code>musl</code> ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã™ã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¿½åŠ ã€‚</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>",
    "<td>é™çš„ãƒªãƒ³ã‚¯ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã«ã¯ <code>musl</code> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ä½¿ã†ã€‚</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>",
    "<td>ãƒ‡ãƒãƒƒã‚°ã«ç”¨ã„ã‚‰ã‚Œã‚‹ã‚·ãƒ³ãƒœãƒ«æƒ…å ±ã‚’å‰Šé™¤ã—ã¦ã‚µã‚¤ã‚ºç¸®å°ã€‚</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "<hr>",
    "<div class=\"admonitionblock note\">",
    "<table>",
    "<tr>",
    "<td class=\"icon\">",
    "<i class=\"fa icon-note\" title=\"Note\" data-md-icon=\"info\"></i>",
    "</td>",
    "<td class=\"content\">",
    "<div class=\"title\">é™çš„ãƒªãƒ³ã‚¯ã®ç¢ºèª</div>",
    "<div class=\"paragraph\">",
    "<p><code>file</code> ã‚³ãƒãƒ³ãƒ‰ã‚„ <code>ldd</code> ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ç¢ºèªã™ã‚‹ã€‚</p>",
    "</div>",
    "<div ",
    "    class=\"listingblock no-line-numbers command-line\">",
    "",
    "  <div class=\"content\">",
    "  <pre class=\"highlight command-line\" data-user=\"user\"",
    "    data-host=\"local\"",
    "    data-output=\"2-10\"",
    "    ><code class=\"language-bash\"",
    "    data-lang=\"bash\">file path/to/static/binary | tr , '\\n'",
    "path/to/static/binary: ELF 64-bit LSB executable",
    " x86-64",
    " version 1 (SYSV)",
    " statically linked",
    " Go BuildID=abc...",
    " not stripped</code></pre>",
    "  </div>",
    "</div>",
    "</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_dockerfile_ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®åˆ©ç”¨ä¾‹\">ğŸ³ <em>Dockerfile</em> ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®åˆ©ç”¨ä¾‹</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p>ã‚‚ã¨ã‚‚ã¨ã¯ <em>Dockerfile</em> ã§ãƒ“ãƒ«ãƒ‰ã•ã›ãŸã‹ã£ãŸã®ã§ã€ãã®ã‚µãƒ³ãƒ—ãƒ«ã€‚</p>",
    "</div>",
    "<div class=\"exampleblock\">",
    "<div class=\"title\">Example 3. Go in dockerfile</div>",
    "<div class=\"content\">",
    "<div ",
    "    class=\"listingblock\">",
    "",
    "  <div class=\"content\">",
    "  <pre class=\"highlight \" ><code class=\"language-dockerfile\"",
    "    data-lang=\"dockerfile\">FROM golang:1.16-alpine AS build-go",
    "WORKDIR /go/src",
    "",
    "RUN \\",
    "  apk --no-cache add \\  <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>",
    "    git \\",
    "    binutils",
    "",
    "### Install to '/go/bin' as static binary",
    "ENV CGO_ENABLED=0",
    "ARG GO_INSTALL=\"go install -ldflags '-extldflags=-static'\"  <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>",
    "# ghq",
    "RUN ${GO_INSTALL} github.com/x-motemen/ghq@v1.2.1",
    "",
    "# stripped",
    "WORKDIR /go/bin",
    "RUN strip $(ls)",
    "",
    "# -----------------------",
    "FROM debian:buster-slim",
    "COPY --from=build-go /go/bin /usr/local/bin/",
    "RUN ...</code></pre>",
    "  </div>",
    "</div>",
    "<div class=\"colist arabic\">",
    "<table>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>",
    "<td>å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸<sup class=\"footnote\">[<a id=\"_footnoteref_1\" class=\"footnote\" href=\"#_footnotedef_1\" title=\"View footnote.\">1</a>]</sup>ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>",
    "<td>ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã€ <code>go build</code> ã®ä»£ã‚ã‚Šã« <code>go install</code> ã‚’åˆ©ç”¨ã€‚</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"exampleblock\">",
    "<div class=\"title\">Example 4. Rust in dockerfile</div>",
    "<div class=\"content\">",
    "<div class=\"paragraph\">",
    "<p><code>*-unknown-linux-musl</code> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¿½åŠ ã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€é™çš„ãƒªãƒ³ã‚¯ã«ã§ãã‚‹ã€‚</p>",
    "</div>",
    "<div ",
    "    class=\"listingblock\">",
    "",
    "  <div class=\"content\">",
    "  <pre class=\"highlight \" ><code class=\"language-dockerfile\"",
    "    data-lang=\"dockerfile\">FROM rust:1.53-alpine AS build-rust",
    "",
    "ENV CARGO_HOME=/cargo",
    "WORKDIR ${CARGO_HOME}/bin",
    "",
    "RUN apk --no-cache add musl-dev   <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>",
    "",
    "# Install",
    "RUN \\",
    "  cargo install --version ^0.10.1 exa &amp;&amp; \\  <i class=\"conum\" data-value=\"2\"></i><b>(2)</b> <i class=\"conum\" data-value=\"3\"></i><b>(3)</b>",
    "  cargo install --version ^2.1.0 git-interactive-rebase-tool",
    "",
    "# Reduce binary size",
    "RUN strip $(ls)",
    "",
    "# -----------------------",
    "FROM debian:buster-slim",
    "COPY --from=build-rust /cargo/bin /usr/local/bin/",
    "RUN ...</code></pre>",
    "  </div>",
    "</div>",
    "<div class=\"colist arabic\">",
    "<table>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>",
    "<td>ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã®ã«å¿…è¦ãª <code>musl-dev</code> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>",
    "<td><em>Alpine</em> ãƒ™ãƒ¼ã‚¹ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãŒ <code>musl</code> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãªã®ã§ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¿½åŠ ãƒ»æŒ‡å®šã™ã‚‹å¿…è¦ãŒãªã„ã€‚</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>",
    "<td><a href=\"https://crates.io\" target=\"_blank\" rel=\"noopener\">crates.io</a> ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã€ <code>cargo install</code> ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã€‚</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_å‚è€ƒ\">ğŸ“–å‚è€ƒ</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"ulist\">",
    "<div class=\"title\">Go</div>",
    "<ul>",
    "<li>",
    "<p><a href=\"https://christina04.hatenablog.com/entry/installsuffix-cgo-is-no-longer-required\" target=\"_blank\" rel=\"noopener\">cgoã‚’ä½¿ã‚ãªã„Goã®ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã« -installsuffix cgo ãŒä¸è¦ã«ãªã£ã¦ãŸ - Carpe Diem</a></p>",
    "</li>",
    "<li>",
    "<p><a href=\"https://www.arp242.net/static-go.html\" target=\"_blank\" rel=\"noopener\">Statically compiling Go programs</a></p>",
    "</li>",
    "</ul>",
    "</div>",
    "<div class=\"ulist\">",
    "<div class=\"title\">Rust</div>",
    "<ul>",
    "<li>",
    "<p><a href=\"https://doc.rust-lang.org/edition-guide/rust-2018/platform-and-target-support/musl-support-for-fully-static-binaries.html\" target=\"_blank\" rel=\"noopener\">MUSL support for fully static binaries - The Edition Guide</a></p>",
    "</li>",
    "<li>",
    "<p><a href=\"https://blog.rust-jp.rs/tatsuya6502/posts/2019-12-statically-linked-binary/\" target=\"_blank\" rel=\"noopener\">Rustã®Linux muslã‚¿ãƒ¼ã‚²ãƒƒãƒˆ ï¼ˆãã®1ï¼šLinuxå‘ã‘ã®ãƒãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒã‚¤ãƒŠãƒªã‚’ä½œã‚‹ï¼‰</a></p>",
    "</li>",
    "</ul>",
    "</div>",
    "</div>",
    "</div>",
    "<div id=\"footnotes\">",
    "<hr>",
    "<div class=\"footnote\" id=\"_footnotedef_1\">",
    "<a href=\"#_footnoteref_1\">1</a>. <code>binutils</code> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ <code>strip</code> ã‚³ãƒãƒ³ãƒ‰ã®ãŸã‚ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã€‚",
    "</div>",
    "</div>"
  ],
  "title": "Go ã¨ Rust ã«ãŠã‘ã‚‹é™çš„ãƒªãƒ³ã‚¯ã®ãƒ“ãƒ«ãƒ‰æ–¹æ³•ï¼ˆ+ Dockerfile ã‚µãƒ³ãƒ—ãƒ«ï¼‰",
  "created_at": "2021-06-29",
  "tags": [
    "golang",
    "rust",
    "docker"
  ],
  "updated_at": "2021-06-29",
  "author": "ç§‹ã€…ã™ã™ã",
  "revision": "1.0"
}