{"filename":"golang_and_rust_statically_linked.adoc","rendered":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">ç›®æ¬¡</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_å‹•æ©Ÿ\">ğŸª“å‹•æ©Ÿ</a></li>\n<li><a href=\"#_ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³\">âš™ï¸ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_go_è¨€èª\">Go è¨€èª</a></li>\n<li><a href=\"#_rust_è¨€èª\">Rust è¨€èª</a></li>\n</ul>\n</li>\n<li><a href=\"#_dockerfile_ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®åˆ©ç”¨ä¾‹\">ğŸ³ <em>Dockerfile</em> ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®åˆ©ç”¨ä¾‹</a></li>\n<li><a href=\"#_å‚è€ƒ\">ğŸ“–å‚è€ƒ</a></li>\n</ul>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_å‹•æ©Ÿ\">ğŸª“å‹•æ©Ÿ</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>ãŸã¨ãˆã° <em>Alpine</em> ã§ãƒ“ãƒ«ãƒ‰ã—ãŸã®ã¡ã€ä»–ã® <em>Linux</em> ã§ã‚‚å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«é™çš„ãƒªãƒ³ã‚¯ã§ãƒ“ãƒ«ãƒ‰ã•ã›ãŸã„ã€‚</p>\n</div>\n<table class=\"tableblock frame-all grid-all stretch\">\n<caption class=\"title\">Table 1. å®Ÿè¡Œç’°å¢ƒ</caption>\n<colgroup>\n<col style=\"width: 50%;\">\n<col style=\"width: 50%;\">\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">Tool</th>\n<th class=\"tableblock halign-left valign-top\">Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><em>go</em></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">1.16.5</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><em>rustup</em></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">1.24.3</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><em>rustc</em></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">1.53.0</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\"><em>cargo</em></p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">1.53.0</p></td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³\">âš™ï¸ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"_go_è¨€èª\">Go è¨€èª</h3>\n<div class=\"paragraph\">\n<p><em>C</em> è¨€èªã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã™ <em>cgo</em> ã‚’ä½¿ã£ã¦ã„ã‚‹ã¨å‹•çš„ãƒªãƒ³ã‚¯ã•ã‚Œã‚‹ã‚‰ã—ã„ã€‚<br>\nã‚ˆã£ã¦ <em>cgo</em> ã‚’ç„¡åŠ¹åŒ–ã—ãŸã‚Šã€ãƒªãƒ³ã‚«ãƒ¼ã«é™çš„ãƒªãƒ³ã‚¯ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã—ãŸã‚Šã™ã‚‹ã€‚</p>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 1. Go</div>\n<div class=\"content\">\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">export CGO_ENABLED=0    <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\ngo build -ldflags '-extldflags=-static'   <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\nstrip /path/to/binary   <i class=\"conum\" data-value=\"3\"></i><b>(3)</b></code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td><em>C</em> è¨€èªã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨ã—ã¦ãªã„å ´åˆã¯ <code>cgo</code> ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã ã‘ã§é™çš„ãƒªãƒ³ã‚¯ã«ãªã‚‹ã€‚</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>ãƒªãƒ³ã‚«ãƒ¼ã«é™çš„ãƒªãƒ³ã‚¯ã§ã‚ã‚‹ã“ã¨ã‚’ä¼ãˆã¦ãƒ“ãƒ«ãƒ‰ã€‚<br>\nåˆ©ç”¨ã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ˆã£ã¦ã¯ <code>-tags</code> ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ä½¿ã£ã¦ <code>cgo</code> éƒ¨åˆ†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã€‚</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>\n<td>ãƒ‡ãƒãƒƒã‚°ã«ç”¨ã„ã‚‰ã‚Œã‚‹ã‚·ãƒ³ãƒœãƒ«æƒ…å ±ã‚’å‰Šé™¤ã—ã¦ã‚µã‚¤ã‚ºç¸®å°ã€‚</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_rust_è¨€èª\">Rust è¨€èª</h3>\n<div class=\"paragraph\">\n<p><code>*-musl</code> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚Œã°é™çš„ãƒªãƒ³ã‚¯ã«ãªã‚‹ã€‚</p>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 2. Rust</div>\n<div class=\"content\">\n<div \n    class=\"listingblock no-line-numbers command-line\">\n<div class=\"title\">x86_64 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å ´åˆ</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">rustup target add x86_64-unknown-linux-musl   <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\ncargo build --release --target x86_64-unknown-linux-musl  <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\nstrip /path/to/binary   <i class=\"conum\" data-value=\"3\"></i><b>(3)</b></code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td><code>musl</code> ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã™ã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¿½åŠ ã€‚</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>é™çš„ãƒªãƒ³ã‚¯ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã«ã¯ <code>musl</code> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ä½¿ã†ã€‚</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>\n<td>ãƒ‡ãƒãƒƒã‚°ã«ç”¨ã„ã‚‰ã‚Œã‚‹ã‚·ãƒ³ãƒœãƒ«æƒ…å ±ã‚’å‰Šé™¤ã—ã¦ã‚µã‚¤ã‚ºç¸®å°ã€‚</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<hr>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-note\" title=\"Note\" data-md-icon=\"info\"></i>\n</td>\n<td class=\"content\">\n<div class=\"title\">é™çš„ãƒªãƒ³ã‚¯ã®ç¢ºèª</div>\n<div class=\"paragraph\">\n<p><code>file</code> ã‚³ãƒãƒ³ãƒ‰ã‚„ <code>ldd</code> ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ç¢ºèªã™ã‚‹ã€‚</p>\n</div>\n<div \n    class=\"listingblock no-line-numbers command-line\">\n\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    data-output=\"2-10\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">file path/to/static/binary | tr , '\\n'\npath/to/static/binary: ELF 64-bit LSB executable\n x86-64\n version 1 (SYSV)\n statically linked\n Go BuildID=abc...\n not stripped</code></pre>\n  </div>\n</div>\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_dockerfile_ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®åˆ©ç”¨ä¾‹\">ğŸ³ <em>Dockerfile</em> ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®åˆ©ç”¨ä¾‹</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>ã‚‚ã¨ã‚‚ã¨ã¯ <em>Dockerfile</em> ã§ãƒ“ãƒ«ãƒ‰ã•ã›ãŸã‹ã£ãŸã®ã§ã€ãã®ã‚µãƒ³ãƒ—ãƒ«ã€‚</p>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 3. Go in dockerfile</div>\n<div class=\"content\">\n<div \n    class=\"listingblock\">\n\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-dockerfile\"\n    data-lang=\"dockerfile\">FROM golang:1.16-alpine AS build-go\nWORKDIR /go/src\n\nRUN \\\n  apk --no-cache add \\  <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\n    git \\\n    binutils\n\n### Install to '/go/bin' as static binary\nENV CGO_ENABLED=0\nARG GO_INSTALL=\"go install -ldflags '-extldflags=-static'\"  <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\n# ghq\nRUN ${GO_INSTALL} github.com/x-motemen/ghq@v1.2.1\n\n# stripped\nWORKDIR /go/bin\nRUN strip $(ls)\n\n# -----------------------\nFROM debian:buster-slim\nCOPY --from=build-go /go/bin /usr/local/bin/\nRUN ...</code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸<sup class=\"footnote\">[<a id=\"_footnoteref_1\" class=\"footnote\" href=\"#_footnotedef_1\" title=\"View footnote.\">1</a>]</sup>ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td>ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã€ <code>go build</code> ã®ä»£ã‚ã‚Šã« <code>go install</code> ã‚’åˆ©ç”¨ã€‚</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 4. Rust in dockerfile</div>\n<div class=\"content\">\n<div class=\"paragraph\">\n<p><code>*-unknown-linux-musl</code> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¿½åŠ ã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€é™çš„ãƒªãƒ³ã‚¯ã«ã§ãã‚‹ã€‚</p>\n</div>\n<div \n    class=\"listingblock\">\n\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-dockerfile\"\n    data-lang=\"dockerfile\">FROM rust:1.53-alpine AS build-rust\n\nENV CARGO_HOME=/cargo\nWORKDIR ${CARGO_HOME}/bin\n\nRUN apk --no-cache add musl-dev   <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\n\n# Install\nRUN \\\n  cargo install --version ^0.10.1 exa &amp;&amp; \\  <i class=\"conum\" data-value=\"2\"></i><b>(2)</b> <i class=\"conum\" data-value=\"3\"></i><b>(3)</b>\n  cargo install --version ^2.1.0 git-interactive-rebase-tool\n\n# Reduce binary size\nRUN strip $(ls)\n\n# -----------------------\nFROM debian:buster-slim\nCOPY --from=build-rust /cargo/bin /usr/local/bin/\nRUN ...</code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td>ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã®ã«å¿…è¦ãª <code>musl-dev</code> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td><em>Alpine</em> ãƒ™ãƒ¼ã‚¹ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãŒ <code>musl</code> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãªã®ã§ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¿½åŠ ãƒ»æŒ‡å®šã™ã‚‹å¿…è¦ãŒãªã„ã€‚</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>\n<td><a href=\"https://crates.io\" target=\"_blank\" rel=\"noopener\">crates.io</a> ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã€ <code>cargo install</code> ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã€‚</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_å‚è€ƒ\">ğŸ“–å‚è€ƒ</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<div class=\"title\">Go</div>\n<ul>\n<li>\n<p><a href=\"https://christina04.hatenablog.com/entry/installsuffix-cgo-is-no-longer-required\" target=\"_blank\" rel=\"noopener\">cgoã‚’ä½¿ã‚ãªã„Goã®ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã« -installsuffix cgo ãŒä¸è¦ã«ãªã£ã¦ãŸ - Carpe Diem</a></p>\n</li>\n<li>\n<p><a href=\"https://www.arp242.net/static-go.html\" target=\"_blank\" rel=\"noopener\">Statically compiling Go programs</a></p>\n</li>\n</ul>\n</div>\n<div class=\"ulist\">\n<div class=\"title\">Rust</div>\n<ul>\n<li>\n<p><a href=\"https://doc.rust-lang.org/edition-guide/rust-2018/platform-and-target-support/musl-support-for-fully-static-binaries.html\" target=\"_blank\" rel=\"noopener\">MUSL support for fully static binaries - The Edition Guide</a></p>\n</li>\n<li>\n<p><a href=\"https://blog.rust-jp.rs/tatsuya6502/posts/2019-12-statically-linked-binary/\" target=\"_blank\" rel=\"noopener\">Rustã®Linux muslã‚¿ãƒ¼ã‚²ãƒƒãƒˆ ï¼ˆãã®1ï¼šLinuxå‘ã‘ã®ãƒãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒã‚¤ãƒŠãƒªã‚’ä½œã‚‹ï¼‰</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div id=\"footnotes\">\n<hr>\n<div class=\"footnote\" id=\"_footnotedef_1\">\n<a href=\"#_footnoteref_1\">1</a>. <code>binutils</code> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ <code>strip</code> ã‚³ãƒãƒ³ãƒ‰ã®ãŸã‚ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã€‚\n</div>\n</div>","title":"Go ã¨ Rust ã«ãŠã‘ã‚‹é™çš„ãƒªãƒ³ã‚¯ã®ãƒ“ãƒ«ãƒ‰æ–¹æ³•ï¼ˆ+ Dockerfile ã‚µãƒ³ãƒ—ãƒ«ï¼‰","created_at":"2021-06-29","tags":["golang","rust","docker"],"updated_at":"2021-06-29","author":"ç§‹ã€…ã™ã™ã","revision":"1.0"}