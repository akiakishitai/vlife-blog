{"filename":"template_converter_in_asciidoc.adoc","rendered":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">目次</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_動機\">動機🤔</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_本記事でやったこと\">本記事でやったこと</a></li>\n</ul>\n</li>\n<li><a href=\"#_テンプレート\">テンプレート🥪</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_jsテンプレートエンジン\">JSテンプレートエンジン</a></li>\n<li><a href=\"#_テンプレートの作成\">テンプレートの作成</a></li>\n</ul>\n</li>\n<li><a href=\"#_テンプレートを適用して出力\">テンプレートを適用して出力💻</a></li>\n<li><a href=\"#_おわりに\">おわりに😎</a></li>\n<li><a href=\"#_参考\">参考📖</a></li>\n</ul>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_動機\">動機🤔</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><em>AsciiDoc</em> で <code>prism.js</code> の <a href=\"https://prismjs.com/plugins/command-line/\" target=\"_blank\" rel=\"noopener\">Command Line プラグイン</a> を使ってみたかった。<br>\n上記プラグインではカスタムデータ属性の指定が必要だが、標準の <code>Asciidoctor.js</code> では任意のカスタムデータ属性に対応していない。</p>\n</div>\n<div class=\"paragraph\">\n<p>よって、<a href=\"https://asciidoctor-docs.netlify.app/asciidoctor.js/3.0/extend/converter/template-converter/\" target=\"_blank\" rel=\"noopener\">テンプレートコンバーター</a>を使ってカスタムデータ属性に対応したHTML出力をさせてみる。</p>\n</div>\n<div class=\"paragraph\">\n<p>……やってみた結果としては、<a href=\"https://asciidoctor-docs.netlify.app/asciidoctor.js/current/extend/converter/custom-converter/\" target=\"_blank\" rel=\"noopener\">カスタムコンバーター</a>を使うほうがよさそうだった🥺。</p>\n</div>\n<table class=\"tableblock frame-all grid-all fit-content\">\n<caption class=\"title\">Table 1. 開発環境</caption>\n<colgroup>\n<col>\n<col>\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">ツール</th>\n<th class=\"tableblock halign-left valign-top\">バージョン</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Node</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">12.19.0</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">@asciidoctor/core</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">2.2.0</p></td>\n</tr>\n</tbody>\n</table>\n<div class=\"sect2\">\n<h3 id=\"_本記事でやったこと\">本記事でやったこと</h3>\n<div class=\"imageblock kroki\">\n<div class=\"content\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" contentScriptType=\"application/ecmascript\" contentStyleType=\"text/css\" height=\"619px\" preserveAspectRatio=\"none\" style=\"width:505px;height:619px;\" version=\"1.1\" viewBox=\"0 0 505 619\" width=\"505px\" zoomAndPan=\"magnify\"><defs><filter height=\"300%\" id=\"f8k6qlf2tw90i\" width=\"300%\" x=\"-1\" y=\"-1\"><feGaussianBlur result=\"blurOut\" stdDeviation=\"2.0\"/><feColorMatrix in=\"blurOut\" result=\"blurOut2\" type=\"matrix\" values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0\"/><feOffset dx=\"4.0\" dy=\"4.0\" in=\"blurOut2\" result=\"blurOut3\"/><feBlend in=\"SourceGraphic\" in2=\"blurOut3\" mode=\"normal\"/></filter></defs><g><ellipse cx=\"87\" cy=\"48.6998\" fill=\"#000000\" filter=\"url(#f8k6qlf2tw90i)\" rx=\"10\" ry=\"10\" style=\"stroke: none; stroke-width: 1.0;\"/><rect fill=\"#FEFECE\" filter=\"url(#f8k6qlf2tw90i)\" height=\"48.8002\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"120\" x=\"27\" y=\"127.2998\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"100\" x=\"37\" y=\"149.2999\">テンプレートエンジン</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"70\" x=\"37\" y=\"163.7\">をインストール</text><polygon fill=\"#FEFECE\" filter=\"url(#f8k6qlf2tw90i)\" points=\"42,78.6998,132,78.6998,144,90.6998,132,102.6998,42,102.6998,30,90.6998,42,78.6998\" style=\"stroke: #A80036; stroke-width: 1.5;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"18\" x=\"91\" y=\"113.6998\">無し</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"90\" x=\"42\" y=\"95.0998\">テンプレートエンジン</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"18\" x=\"144\" y=\"88.4999\">有り</text><polygon fill=\"#FEFECE\" filter=\"url(#f8k6qlf2tw90i)\" points=\"87,241.5993,99,253.5993,87,265.5993,75,253.5993,87,241.5993\" style=\"stroke: #A80036; stroke-width: 1.5;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"23\" x=\"93\" y=\"199.7996\">EJS,</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"58\" x=\"93\" y=\"212.9995\">Handlebars,</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"49\" x=\"93\" y=\"226.1994\">Nunjucks,</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"19\" x=\"93\" y=\"239.3993\">Pug</text><line style=\"stroke: #000000; stroke-width: 2.0;\" x1=\"15\" x2=\"15\" y1=\"12.1\" y2=\"602.9998\"/><rect fill=\"#FEFECE\" filter=\"url(#f8k6qlf2tw90i)\" height=\"34.4001\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"150\" x=\"182\" y=\"285.5993\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"130\" x=\"192\" y=\"307.5994\">上書きしたいノード名の確認</text><rect fill=\"#FEFECE\" filter=\"url(#f8k6qlf2tw90i)\" height=\"48.8002\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"130\" x=\"192\" y=\"374.5992\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"110\" x=\"202\" y=\"396.5993\">上書するノードと同名の</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"90\" x=\"202\" y=\"410.9994\">テンプレートを作成</text><line style=\"stroke: #000000; stroke-width: 2.0;\" x1=\"176\" x2=\"176\" y1=\"12.1\" y2=\"602.9998\"/><rect fill=\"#FEFECE\" filter=\"url(#f8k6qlf2tw90i)\" height=\"48.8002\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"100\" x=\"376\" y=\"443.3994\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"72\" x=\"386\" y=\"465.3995\">template_dirs</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"80\" x=\"386\" y=\"479.7996\">オプションを指定</text><rect fill=\"#FEFECE\" filter=\"url(#f8k6qlf2tw90i)\" height=\"48.8002\" rx=\"12.5\" ry=\"12.5\" style=\"stroke: #A80036; stroke-width: 1.5;\" width=\"87\" x=\"382.5\" y=\"512.1996\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"67\" x=\"392.5\" y=\"534.1997\">asciidoctorで</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"54\" x=\"392.5\" y=\"548.5998\">HTML出力</text><ellipse cx=\"426\" cy=\"591.9998\" fill=\"#FFFFFF\" filter=\"url(#f8k6qlf2tw90i)\" rx=\"11\" ry=\"11\" style=\"stroke: #000000; stroke-width: 1.0;\"/><ellipse cx=\"426\" cy=\"591.9998\" fill=\"#000000\" rx=\"6\" ry=\"6\" style=\"stroke: #7F7F7F; stroke-width: 1.0;\"/><line style=\"stroke: #000000; stroke-width: 2.0;\" x1=\"370\" x2=\"370\" y1=\"12.1\" y2=\"602.9998\"/><line style=\"stroke: #000000; stroke-width: 2.0;\" x1=\"486\" x2=\"486\" y1=\"12.1\" y2=\"602.9998\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"87\" x2=\"87\" y1=\"102.6998\" y2=\"127.2998\"/><polygon fill=\"#A80036\" points=\"83,117.2998,87,127.2998,91,117.2998,87,121.2998\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"144\" x2=\"157\" y1=\"90.6998\" y2=\"90.6998\"/><polygon fill=\"#A80036\" points=\"153,168.0997,157,178.0997,161,168.0997,157,172.0997\" style=\"stroke: #A80036; stroke-width: 1.5;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"157\" x2=\"157\" y1=\"90.6998\" y2=\"253.5993\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"157\" x2=\"99\" y1=\"253.5993\" y2=\"253.5993\"/><polygon fill=\"#A80036\" points=\"109,249.5993,99,253.5993,109,257.5993,105,253.5993\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"87\" x2=\"87\" y1=\"176.1\" y2=\"241.5993\"/><polygon fill=\"#A80036\" points=\"83,231.5993,87,241.5993,91,231.5993,87,235.5993\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"87\" x2=\"87\" y1=\"58.6998\" y2=\"78.6998\"/><polygon fill=\"#A80036\" points=\"83,68.6998,87,78.6998,91,68.6998,87,72.6998\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"257\" x2=\"257\" y1=\"319.9994\" y2=\"374.5992\"/><polygon fill=\"#A80036\" points=\"253,364.5992,257,374.5992,261,364.5992,257,368.5992\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"104\" x=\"261\" y=\"341.6993\">seciton, image, listing,</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"11\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"80\" x=\"261\" y=\"354.8992\">table, ulist, ...etc.</text><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"426\" x2=\"426\" y1=\"492.1996\" y2=\"512.1996\"/><polygon fill=\"#A80036\" points=\"422,502.1996,426,512.1996,430,502.1996,426,506.1996\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"426\" x2=\"426\" y1=\"560.9998\" y2=\"580.9998\"/><polygon fill=\"#A80036\" points=\"422,570.9998,426,580.9998,430,570.9998,426,574.9998\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"87\" x2=\"87\" y1=\"265.5993\" y2=\"270.5993\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"87\" x2=\"257\" y1=\"270.5993\" y2=\"270.5993\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"257\" x2=\"257\" y1=\"270.5993\" y2=\"285.5993\"/><polygon fill=\"#A80036\" points=\"253,275.5993,257,285.5993,261,275.5993,257,279.5993\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"257\" x2=\"257\" y1=\"423.3994\" y2=\"428.3994\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"257\" x2=\"426\" y1=\"428.3994\" y2=\"428.3994\"/><line style=\"stroke: #A80036; stroke-width: 1.5;\" x1=\"426\" x2=\"426\" y1=\"428.3994\" y2=\"443.3994\"/><polygon fill=\"#A80036\" points=\"422,433.3994,426,443.3994,430,433.3994,426,437.3994\" style=\"stroke: #A80036; stroke-width: 1.0;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"18\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"37\" x=\"77\" y=\"30.0999\">shell</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"18\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"80\" x=\"233\" y=\"30.0999\">filesystem</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"18\" lengthAdjust=\"spacingAndGlyphs\" textLength=\"76\" x=\"390\" y=\"30.0999\">javascript</text><!--MD5=[4189b4be0e85f85b1f7dbfc067fe5653]\n@startuml\n|shell|\nstart\n\nif (テンプレートエンジン) then (無し)\n  :テンプレートエンジン\n  をインストール;\n  -> EJS,\n  Handlebars,\n  Nunjucks,\n  Pug;\nelse (有り)\nendif\n\n|filesystem|\n:上書きしたいノード名の確認;\n-> seciton, image, listing,\ntable, ulist, ...etc.;\n:上書するノードと同名の\nテンプレートを作成;\n\n|javascript|\n:template_dirs\nオプションを指定;\n\n:asciidoctorで\nHTML出力;\n\nstop\n@enduml\n\nPlantUML version 1.2020.19(Mon Oct 12 15:10:01 GMT 2020)\n(GPL source distribution)\nJava Runtime: OpenJDK Runtime Environment\nJVM: OpenJDK 64-Bit Server VM\nDefault Encoding: UTF-8\nLanguage: en\nCountry: US\n--></g></svg>\n</div>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\"><span class=\"material-icons cursor-default\" alt=\"Note\" title=\"Note\">create</span></div>\n</td>\n<td class=\"content\">\n<em>JavaScript</em> の関数でもテンプレート作成できるが、今回は割愛。\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_テンプレート\">テンプレート🥪</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>HTMLコードを生成するJSテンプレートエンジン用のソースファイルを指す。<br>\n<code>asciidoctor.js</code> の各ノード（<em>paragraph</em> ブロックとか <em>table</em> ブロックとか）ごとのHTML出力を、このテンプレートから生成されるHTMLコードで置き換える。</p>\n</div>\n<div class=\"dlist\">\n<dl>\n<dt class=\"hdlist1\"><span class=\"flex items-center text-green-500\"><span class=\"material-icons\">check</span>メリット</span></dt>\n<dd>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>各ノードの出力をファイル単位で独立して記述できるので、上書きしたいノードに対してのみテンプレートを作成すればよい</p>\n</li>\n<li>\n<p>適用するファイルまたはディレクトリを変更するだけでHTML出力を変更できる</p>\n</li>\n</ul>\n</div>\n</dd>\n<dt class=\"hdlist1\"><span class=\"flex items-center text-red-500\"><span class=\"material-icons\">close</span>デメリット</span></dt>\n<dd>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>テンプレートエンジンの使い方を学習する必要がある</p>\n</li>\n<li>\n<p>ブラウザ環境では使えない（はず）</p>\n</li>\n</ul>\n</div>\n</dd>\n</dl>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_jsテンプレートエンジン\">JSテンプレートエンジン</h3>\n<div class=\"paragraph\">\n<p><code>Asciidoctor.js</code> がサポートするテンプレートエンジンには <code>pug</code> や <code>EJS</code> など<a href=\"https://asciidoctor-docs.netlify.app/asciidoctor.js/3.0/extend/converter/template-converter/#built-in-template-engines\" target=\"_blank\" rel=\"noopener\">いくつかある</a>。<br>\n今回はそのうちの <a href=\"https://mozilla.github.io/nunjucks/\" target=\"_blank\" rel=\"noopener\">nunjucks</a> を使ってみた。</p>\n</div>\n<div \n    class=\"listingblock command-line no-line-numbers\">\n<div class=\"title\">nunjucksインストール</div>\n  <div class=\"content\">\n  <pre class=\"highlight command-line\" data-user=\"user\"\n    data-host=\"local\"\n    ><code class=\"language-bash\"\n    data-lang=\"bash\">yarn add nunjucks</code></pre>\n  </div>\n</div>\n<div class=\"paragraph\">\n<p>ライブラリをインストールすれば、あとは自動的に <code>Asciidoctor.js</code> の方で読み込まれる。</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_テンプレートの作成\">テンプレートの作成</h3>\n<div class=\"olist arabic\">\n<ol class=\"arabic\">\n<li>\n<p>テンプレートを配置するディレクトリを作成（出力時に <code>template_dirs</code> で指定）</p>\n</li>\n<li>\n<p><strong>置き換えたいノード名と一致する名前でファイル作成</strong><br>\nノード名の一覧は <a href=\"https://asciidoctor-docs.netlify.app/asciidoctor.js/3.0/extend/converter/template-converter/#naming-convention\">こちら</a> を参照。</p>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\"><span class=\"material-icons cursor-default\" alt=\"Note\" title=\"Note\">create</span></div>\n</td>\n<td class=\"content\">\nたとえば置き換えたいノード名が <code>listing</code> ならば、作成するテンプレートは <code>listing.njk</code> というように同じ名前にする。\n</td>\n</tr>\n</table>\n</div>\n</li>\n<li>\n<p>テンプレートのコードを書く</p>\n</li>\n</ol>\n</div>\n<hr>\n<div class=\"paragraph\">\n<p>ノード名とテンプレート名を同じにすることだけ注意すれば、あとはがんばってテンプレートを書くだけ。</p>\n</div>\n<div class=\"paragraph\">\n<p>以下はその一例で、<code>prism.js</code> の <em>Command Line</em> プラグインに対応させるためにカスタムデータ属性の出力などを行っている。</p>\n</div>\n<details>\n<summary class=\"title\">テンプレートのサンプル</summary>\n<div class=\"content\">\n<div \n    class=\"listingblock\">\n<div class=\"title\">listing.njk</div>\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-markup\"\n    data-lang=\"markup\">{%- import \"macros/sourcecode.njk\" as func -%}\n\n&lt;div {{ func.roles(node) }}&gt;\n{% if node.getTitle() -%}\n  &lt;div class=\"title\"&gt;{{ node.getTitle() }}&lt;/div&gt;\n{%- endif %}\n  &lt;div class=\"content\"&gt;\n  {% if node.getStyle() === 'source' -%}\n    &lt;pre class=\"highlight {{ 'command-line' if node.getRoles().includes('command-line') -}}\" {{ func.customdata(node.getAttributes()) }}&gt;&lt;code {{ func.language(node) }}&gt;{{ node.getContent() | safe }}&lt;/code&gt;&lt;/pre&gt;\n  {% else -%}\n    &lt;pre {{- func.customdata(node.getAttributes()) }}&gt;{{ node.getContent() | safe }}&lt;/pre&gt;\n  {%- endif -%}\n  &lt;/div&gt;\n&lt;/div&gt;</code></pre>\n  </div>\n</div>\n<div \n    class=\"listingblock\">\n<div class=\"title\">macros/sourcecode.njk (マクロ用ソース)</div>\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-markup\"\n    data-lang=\"markup\">{# set id and class attributes #}\n{%- macro roles(node) -%}\n  {% if node.getId() -%}\n    id=\"{{ node.getId() }}\"\n  {%- endif %}\n    class=\"{{ ['listingblock', node.getRole()] | join(' ') | trim }}\"\n{%- endmacro -%}\n\n{# &lt;code&gt; language class and attribute #}\n{%- macro language(node) -%}\n  {%- set lang = node.getAttribute('language') -%}\n  {%- if lang -%}\n    class=\"language-{{ lang }}\"\n    data-lang=\"{{ lang }}\"\n  {%- endif -%}\n{%- endmacro -%}\n\n{# custom data attributes #}\n{% macro customdata(attrs) -%}\n  {%- set regExp = r/^data-.*/ -%}\n  {% for key, value in attrs -%}\n    {% if regExp.test(key) -%}\n      {{ key }}=\"{{ value }}\"\n    {% endif %}\n  {%- endfor %}\n{%- endmacro %}</code></pre>\n  </div>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\"><span class=\"material-icons cursor-default\" alt=\"Note\" title=\"Note\">create</span></div>\n</td>\n<td class=\"content\">\n<div class=\"title\">safe フィルター</div>\n<code>nunjucks</code> では文字列を自動エスケープするが、エスケープ処理は <code>asciidoctor</code> で行いたいので停止しておく。\n</td>\n</tr>\n</table>\n</div>\n</div>\n</details>\n<div class=\"admonitionblock tip\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\"><span class=\"material-icons cursor-default\" alt=\"Tip\" title=\"Tip\">info</span></div>\n</td>\n<td class=\"content\">\n<div class=\"title\">node オブジェクト</div>\nテンプレートには <a href=\"https://asciidoctor.github.io/asciidoctor.js/master/#abstractnode\" target=\"_blank\" rel=\"noopener\">AbstractNode</a> 型の <code>node</code> オブジェクトが引数として渡される。<br>\nテンプレート内ではこの <code>node</code> からノードのクラスや属性、テキストなどを参照する。\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_テンプレートを適用して出力\">テンプレートを適用して出力💻</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>CLIまたはAPIにおいて、先ほど作成したテンプレートファイルのあるディレクトリを <code>template_dirs</code> オプションで指定して呼び出す。</p>\n</div>\n<div \n    class=\"listingblock\">\n<div class=\"title\">main.ts</div>\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-ts\"\n    data-lang=\"ts\">import Processor from '@asciidoctor/core'\n\nconst processor = Processor()\nconst doc = processor.loadFile(\n  'path/to/adoc_file', { template_dirs: ['path/to/template/dir'] })\n\nconsole.log(doc.convert())</code></pre>\n  </div>\n</div>\n<div class=\"imageblock kroki\">\n<div class=\"content\">\n<svg id=\"mermaid-1606550455935\" width=\"996\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"331.20001220703125\" viewBox=\"0 0 996 331.20001220703125\"><style>#mermaid-1606550455935{font-family:\"trebuchet ms\",verdana,arial;font-size:16px;fill:#333;}#mermaid-1606550455935 .error-icon{fill:#552222;}#mermaid-1606550455935 .error-text{fill:#552222;stroke:#552222;}#mermaid-1606550455935 .edge-thickness-normal{stroke-width:2px;}#mermaid-1606550455935 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1606550455935 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1606550455935 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1606550455935 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1606550455935 .marker{fill:#333333;}#mermaid-1606550455935 .marker.cross{stroke:#333333;}#mermaid-1606550455935 svg{font-family:\"trebuchet ms\",verdana,arial;font-size:16px;}#mermaid-1606550455935 .label{font-family:\"trebuchet ms\",verdana,arial;color:#333;}#mermaid-1606550455935 .label text{fill:#333;}#mermaid-1606550455935 .node rect,#mermaid-1606550455935 .node circle,#mermaid-1606550455935 .node ellipse,#mermaid-1606550455935 .node polygon,#mermaid-1606550455935 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1606550455935 .node .label{text-align:center;}#mermaid-1606550455935 .node.clickable{cursor:pointer;}#mermaid-1606550455935 .arrowheadPath{fill:#333333;}#mermaid-1606550455935 .edgePath .path{stroke:#333333;stroke-width:1.5px;}#mermaid-1606550455935 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1606550455935 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1606550455935 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1606550455935 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1606550455935 .cluster text{fill:#333;}#mermaid-1606550455935 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:\"trebuchet ms\",verdana,arial;font-size:12px;background:hsl(80,100%,96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1606550455935:root{--mermaid-font-family:\"trebuchet ms\",verdana,arial;}#mermaid-1606550455935 flowchart{fill:apa;}</style><g><g class=\"output\"><g class=\"clusters\"></g><g class=\"edgePaths\"><g class=\"edgePath LS-main.ts LE-A\" id=\"L-main.ts-A\" style=\"opacity: 1;\"><path class=\"path\" d=\"M84,221.52608390476394L138,209.1999969482422L192,219.89811015578937\" marker-end=\"url(#arrowhead46)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead46\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-A LE-B\" id=\"L-A-B\" style=\"opacity: 1;\"><path class=\"path\" d=\"M256.5738726219767,209.1999969482422L321,101.5999984741211L346.500001525879,102.0999984741211\" marker-end=\"url(#arrowhead47)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead47\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-B LE-C\" id=\"L-B-C\" style=\"opacity: 1;\"><path class=\"path\" d=\"M533.6999984741211,102.0999984741211L570.6999969482422,101.5999984741211L608.699998474121,102.09999847412111\" marker-end=\"url(#arrowhead48)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead48\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-C LE-E\" id=\"L-C-E\" style=\"opacity: 1;\"><path class=\"path\" d=\"M763.4999954223631,102.09999847412111L800.5,101.5999984741211L865.0791067634739,129.89999771118164\" marker-end=\"url(#arrowhead49)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead49\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-C LE-D\" id=\"L-C-D\" style=\"opacity: 1;\"><path class=\"path\" d=\"M718.4980304138518,147.10196348263264L800.5,261.1999969482422L845.5,273.59999694824216\" marker-end=\"url(#arrowhead50)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead50\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-B LE-D\" id=\"L-B-D\" style=\"opacity: 1;\"><path class=\"path\" d=\"M478.2441090543815,157.55589094561853L570.6999969482422,292.1999969482422L685.5999984741211,292.1999969482422L800.5,292.1999969482422L845.5,292.1999969482422\" marker-end=\"url(#arrowhead51)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead51\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-D LE-A\" id=\"L-D-A\" style=\"opacity: 1;\"><path class=\"path\" d=\"M845.5,310.7999969482422L800.5,323.1999969482422L685.5999984741211,323.1999969482422L570.6999969482422,323.1999969482422L439.5999984741211,323.1999969482422L321,323.1999969482422L261.38709677419354,251.1999969482422\" marker-end=\"url(#arrowhead52)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead52\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-E LE-A\" id=\"L-E-A\" style=\"opacity: 1;\"><path class=\"path\" d=\"M883.2080703312807,171.89999771118164L800.5,230.1999969482422L685.5999984741211,230.1999969482422L570.6999969482422,230.1999969482422L439.5999984741211,230.1999969482422L321,230.1999969482422L296,230.1999969482422\" marker-end=\"url(#arrowhead53)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead53\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-A LE-main.ts\" id=\"L-A-main.ts\" style=\"opacity: 1;\"><path class=\"path\" d=\"M192,240.501883740695L138,251.1999969482422L84,238.87390999172044\" marker-end=\"url(#arrowhead54)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead54\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g></g><g class=\"edgeLabels\"><g class=\"edgeLabel\" transform=\"translate(138,209.1999969482422)\" style=\"opacity: 1;\"><g transform=\"translate(-12.5,-11)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"25\" height=\"22\"></rect><foreignObject width=\"25\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-main.ts-A\" class=\"edgeLabel L-LS-main.ts' L-LE-A\">call</span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"\" style=\"opacity: 1;\"><g transform=\"translate(0,0)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"0\" height=\"0\"></rect><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-A-B\" class=\"edgeLabel L-LS-A' L-LE-B\"></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(570.6999969482422,101.5999984741211)\" style=\"opacity: 1;\"><g transform=\"translate(-12.5,-11)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"25\" height=\"22\"></rect><foreignObject width=\"25\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-B-C\" class=\"edgeLabel L-LS-B' L-LE-C\">yes</span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(800.5,101.5999984741211)\" style=\"opacity: 1;\"><g transform=\"translate(-12.5,-11)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"25\" height=\"22\"></rect><foreignObject width=\"25\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-C-E\" class=\"edgeLabel L-LS-C' L-LE-E\">yes</span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(800.5,261.1999969482422)\" style=\"opacity: 1;\"><g transform=\"translate(-10,-11)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"20\" height=\"22\"></rect><foreignObject width=\"20\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-C-D\" class=\"edgeLabel L-LS-C' L-LE-D\">no</span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(685.5999984741211,292.1999969482422)\" style=\"opacity: 1;\"><g transform=\"translate(-10,-11)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"20\" height=\"22\"></rect><foreignObject width=\"20\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-B-D\" class=\"edgeLabel L-LS-B' L-LE-D\">no</span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"\" style=\"opacity: 1;\"><g transform=\"translate(0,0)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"0\" height=\"0\"></rect><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-D-A\" class=\"edgeLabel L-LS-D' L-LE-A\"></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"\" style=\"opacity: 1;\"><g transform=\"translate(0,0)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"0\" height=\"0\"></rect><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-E-A\" class=\"edgeLabel L-LS-E' L-LE-A\"></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"translate(138,251.1999969482422)\" style=\"opacity: 1;\"><g transform=\"translate(-29,-11)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"58\" height=\"22\"></rect><foreignObject width=\"58\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-A-main.ts\" class=\"edgeLabel L-LS-A' L-LE-main.ts\">convert</span></div></foreignObject></g></g></g><g class=\"nodes\"><g class=\"node default\" id=\"flowchart-main.ts-15\" transform=\"translate(46,230.1999969482422)\" style=\"opacity: 1;\"><rect rx=\"0\" ry=\"0\" x=\"-38\" y=\"-21\" width=\"76\" height=\"42\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-28,-11)\"><foreignObject width=\"56\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">main.ts</div></foreignObject></g></g></g><g class=\"node default\" id=\"flowchart-A-16\" transform=\"translate(244,230.1999969482422)\" style=\"opacity: 1;\"><rect rx=\"0\" ry=\"0\" x=\"-52\" y=\"-21\" width=\"104\" height=\"42\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-42,-11)\"><foreignObject width=\"84\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">asciidoctor</div></foreignObject></g></g></g><g class=\"node default\" id=\"flowchart-B-17\" transform=\"translate(439.5999984741211,101.5999984741211)\" style=\"opacity: 1;\"><polygon points=\"93.60000000000001,0 187.20000000000002,-93.60000000000001 93.60000000000001,-187.20000000000002 0,-93.60000000000001\" transform=\"translate(-93.60000000000001,93.60000000000001)\" class=\"label-container\"></polygon><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-73,-11)\"><foreignObject width=\"146\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">has template_dirs ?</div></foreignObject></g></g></g><g class=\"node default\" id=\"flowchart-C-19\" transform=\"translate(685.5999984741211,101.5999984741211)\" style=\"opacity: 1;\"><polygon points=\"77.4,0 154.8,-77.4 77.4,-154.8 0,-77.4\" transform=\"translate(-77.4,77.4)\" class=\"label-container\"></polygon><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-55,-11)\"><foreignObject width=\"110\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">has template ?</div></foreignObject></g></g></g><g class=\"node default\" id=\"flowchart-E-20\" transform=\"translate(913,150.89999771118164)\" style=\"opacity: 1;\"><rect rx=\"5\" ry=\"5\" x=\"-75\" y=\"-21\" width=\"150\" height=\"42\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-65,-11)\"><foreignObject width=\"130\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">template convert</div></foreignObject></g></g></g><g class=\"node default\" id=\"flowchart-D-22\" transform=\"translate(913,292.1999969482422)\" style=\"opacity: 1;\"><rect rx=\"5\" ry=\"5\" x=\"-67.5\" y=\"-21\" width=\"135\" height=\"42\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-57.5,-11)\"><foreignObject width=\"115\" height=\"22\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">default convert</div></foreignObject></g></g></g></g></g></g></svg>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_おわりに\">おわりに😎</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>テンプレートコンバーターの使い方についてあまり情報がなくて戦々恐々としてたけど、やってみたら簡単だった。</p>\n</div>\n<div class=\"paragraph\">\n<p>ただテンプレートエンジンの使い方も学習する必要があるのが難点。<br>\n<em>JavaScript</em> コードで完結する<a href=\"https://asciidoctor-docs.netlify.app/asciidoctor.js/current/extend/converter/custom-converter/\" target=\"_blank\" rel=\"noopener\">カスタムコンバーター</a>のほうを使ったほうがいいかもしれない。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\">参考📖</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://asciidoctor-docs.netlify.app/asciidoctor.js/3.0/extend/converter/template-converter/\" target=\"_blank\" rel=\"noopener\">Template Converter | The Docks @ Asciidoctor</a></p>\n</li>\n<li>\n<p><a href=\"https://mozilla.github.io/nunjucks/getting-started.html\" target=\"_blank\" rel=\"noopener\">Nunjucks</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","title":"AsciiDoc のテンプレートコンバーターを使ってHTML出力をカスタマイズする","created_at":"2020-11-28","tags":["asciidoc","asciidoctor.js","nunjucks"],"updated_at":"2020-11-28","author":"秋々すすき","revision":"1.0"}