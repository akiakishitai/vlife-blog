{"filename":"fatal_cannot_lock_ref_HEAD_when_git_rebase.adoc","rendered":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">目次</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_問題\">💣 問題</a></li>\n<li><a href=\"#_原因たぶん\">🔍 原因（たぶん）</a></li>\n<li><a href=\"#_解決\">💪 解決</a></li>\n</ul>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_問題\">💣 問題</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><em>fixup</em> や <em>squash</em> なコミットをまとめようと <code>git rebase</code> したときにエラー発生。</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">Error!</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">$ git rebase -i –autosquash develop\n\nfatal: cannot lock ref 'HEAD': is at 5b41137 but expected c3b1c26\nCould not apply c3b1c26… COMMIT_MESSAGE</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>ブランチのツリーは次のような状態。</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"images/codepen/example.png\" alt=\"Git Graph\">\n</div>\n<div class=\"title\">Figure 1. ブランチツリー例</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_原因たぶん\">🔍 原因（たぶん）</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>なんか <code>.git/refs/heads/</code> 直下に空ディレクトリが生成されている。\n（例では <code>akiakishitai/</code> ）</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">.git/refs/heads/ 以下を探索</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">$ ls .git/refs/heads/\nakiakishitai/  master\n\n$ ls -Al .git/refs/heads/akiakishitai/\ntotal 0</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>この空ディレクトリが <code>HEAD</code> を参照するときに使われて、でも空なので代わりに <code>master</code> の方が使われる、のかなぁ？</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_解決\">💪 解決</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>とりあえず上記の不必要な空ディレクトリを削除してから再度 <code>git rebase</code> 実行。</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"title\">空ディレクトリ削除で成功</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">$ rmdir .git/refs/heads/akiakishitai/\n$ git rebase -i –autosquash develop\n\n[detached HEAD 15204bc] ...\n...\n 3 files changed, 24 insertions(+), 7deletions(-)\nSuccessfully rebased and updated refs/heads/akiakishitai/issue123.</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>無事成功！👏</p>\n</div>\n</div>\n</div>","title":"git rebase 時に \"cannot lock ref 'HEAD'\" エラー","created_at":"2020-08-01","tags":["git"],"updated_at":"2020-10-05","author":"akiakiS","revision":"1.1"}