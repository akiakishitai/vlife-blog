{
  "filename": "github_actions_annotation.adoc",
  "rendered": [
    "<div id=\"toc\" class=\"toc\">",
    "<div id=\"toctitle\">目次</div>",
    "<ul class=\"sectlevel1\">",
    "<li><a href=\"#_はじめに\">はじめに🥞</a></li>",
    "<li><a href=\"#_github_アノテーション\"><em>GitHub</em> アノテーション🔔</a></li>",
    "<li><a href=\"#_problem_matchers\"><em>Problem Matchers</em> 🌡️</a>",
    "<ul class=\"sectlevel2\">",
    "<li><a href=\"#_定義\">定義</a></li>",
    "<li><a href=\"#_有効化無効化\">有効化/無効化</a></li>",
    "</ul>",
    "</li>",
    "<li><a href=\"#_おわりに\">おわりに😎</a></li>",
    "<li><a href=\"#_参考\">参考📖</a></li>",
    "</ul>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_はじめに\">はじめに🥞</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p>エラー発生頻度がそれなりにある場合、いちいちワークフローの実行ログを確認するのが面倒だったので、エラーメッセージをアノテーションとして表示させたかった。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>アノテーションを表示するには <a href=\"https://github.com/actions/toolkit/blob/main/docs/problem-matchers.md\"><em>Problem Matchers</em></a> を定義し、ワークフローで読み込めばいいらしい。</p>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_github_アノテーション\"><em>GitHub</em> アノテーション🔔</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p>UIに表示される特定のメッセージのこと。<br>",
    "ワークフロー実行結果の下部に表示されるやつ。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p><span class=\"image\"><img src=\"_images/github-apps/annotation.png\" alt=\"GitHubアノテーション\" width=\"480\" title=\"GitHubアノテーション\"></span></p>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_problem_matchers\"><em>Problem Matchers</em> 🌡️</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p><em>GitHub Action</em> の出力を正規表現のパターンで解析してアノテーションとして表示する機能。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p><em>Problem Matcher</em> の定義は JSONファイルに記述し、ワークフローファイルでその定義ファイルを有効化する。</p>",
    "</div>",
    "<div class=\"sect2\">",
    "<h3 id=\"_定義\">定義</h3>",
    "<div class=\"paragraph\">",
    "<p><a href=\"https://github.com/actions/toolkit/blob/main/docs/problem-matchers.md\" target=\"_blank\" rel=\"noopener\">ここのドキュメント</a>を参考にして定義する。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>指定する正規表現パターンではキャプチャグループ <code>()</code> を利用してファイル名や行番号、エラーメッセージなどを設定する。</p>",
    "</div>",
    "<div class=\"exampleblock\">",
    "<div class=\"title\">Example 1. Problem Matcherの定義例</div>",
    "<div class=\"content\">",
    "<div ",
    "    class=\"listingblock\">",
    "<div class=\"title\">.github/my-problem-matcher.json</div>",
    "  <div class=\"content\">",
    "  <pre class=\"highlight \" ><code class=\"language-json\"",
    "    data-lang=\"json\">{",
    "  \"problemMatcher\": [",
    "    {",
    "      \"owner\": \"this_matcher_ID\",  <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>",
    "      \"pattern\": [",
    "        {",
    "          \"regexp\": \"^([^:]+):(\\\\d+):(\\\\d+): (.+)$\",  <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>",
    "          \"message\": 4,  <i class=\"conum\" data-value=\"3\"></i><b>(3)</b>",
    "          \"file\": 1,",
    "          \"fromPath\": 1,",
    "          \"line\": 2,",
    "          \"column\": 3",
    "        }",
    "      ]",
    "    }",
    "  ]",
    "}</code></pre>",
    "  </div>",
    "</div>",
    "<div class=\"colist arabic\">",
    "<table>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>",
    "<td><strong>必須</strong>。<em>Problem Matcher</em> の <em>ID</em> として任意の名前をつける。</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>",
    "<td><strong>必須</strong>。出力から抽出する正規表現パターンを指定。<br>",
    "キャプチャグループを用いることで他プロパティから利用できるようにする。</td>",
    "</tr>",
    "<tr>",
    "<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>",
    "<td><strong>必須</strong>。<code>regexp</code> のグループ番号からエラーメッセージにあたる値を指定。</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"admonitionblock tip\">",
    "<table>",
    "<tr>",
    "<td class=\"icon\">",
    "<i class=\"fa icon-tip\" title=\"Tip\" data-md-icon=\"emoji_objects\"></i>",
    "</td>",
    "<td class=\"content\">",
    "<code>owner</code> , <code>regexp</code> , <code>message</code> が必須プロパティ。",
    "</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "<div class=\"sect2\">",
    "<h3 id=\"_有効化無効化\">有効化/無効化</h3>",
    "<div class=\"paragraph\">",
    "<p>ワークフローコマンドで <em>Problem Matcher</em> の有効・無効を制御する。</p>",
    "</div>",
    "<div class=\"dlist\">",
    "<dl>",
    "<dt class=\"hdlist1\">有効化</dt>",
    "<dd>",
    "<p><code>add-matcher</code> コマンドで定義 <em>JSON</em> ファイルを指定する。</p>",
    "<div ",
    "    class=\"listingblock\">",
    "<div class=\"title\">ワークフローで独自 Problem Matcher を有効化</div>",
    "  <div class=\"content\">",
    "  <pre class=\"highlight \" ><code class=\"language-yaml\"",
    "    data-lang=\"yaml\">steps:",
    "  - name: Enable problem matcher",
    "    run: echo \"::add-matcher::.github/my-problem-matcher.json\"</code></pre>",
    "  </div>",
    "</div>",
    "</dd>",
    "<dt class=\"hdlist1\">無効化</dt>",
    "<dd>",
    "<p><code>remove-matcher</code> コマンドで <em>Problem Matcher</em> の <em>ID</em> （<code>owner</code> プロパティの値）を指定する。</p>",
    "<div ",
    "    class=\"listingblock\">",
    "<div class=\"title\">独自 Problem Matcher を無効化</div>",
    "  <div class=\"content\">",
    "  <pre class=\"highlight \" ><code class=\"language-yaml\"",
    "    data-lang=\"yaml\">steps:",
    "  - name: Disable problem matcher",
    "    run: echo \"::remove-matcher owner=matcher-ID::\"</code></pre>",
    "  </div>",
    "</div>",
    "</dd>",
    "</dl>",
    "</div>",
    "<div class=\"admonitionblock tip\">",
    "<table>",
    "<tr>",
    "<td class=\"icon\">",
    "<i class=\"fa icon-tip\" title=\"Tip\" data-md-icon=\"emoji_objects\"></i>",
    "</td>",
    "<td class=\"content\">",
    "<code>add-matcher</code> ではファイルパスを指定、<br>",
    "<code>remove-matcher</code> では定義された <code>owner</code> プロパティ値を指定する。",
    "</td>",
    "</tr>",
    "</table>",
    "</div>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_おわりに\">おわりに😎</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"paragraph\">",
    "<p><em>Problem Matcher</em> の正規表現パターンさえ書ければアノテーションとして表示できることがわかった。</p>",
    "</div>",
    "<div class=\"paragraph\">",
    "<p>ワークフローのログがわかりやすくなるのでうまく利用していきたい。</p>",
    "</div>",
    "</div>",
    "</div>",
    "<div class=\"sect1\">",
    "<h2 id=\"_参考\">参考📖</h2>",
    "<div class=\"sectionbody\">",
    "<div class=\"ulist\">",
    "<ul>",
    "<li>",
    "<p><a href=\"https://github.com/actions/toolkit/blob/main/docs/problem-matchers.md\" target=\"_blank\" rel=\"noopener\">toolkit/problem-matchers.md | actions/toolkit</a></p>",
    "</li>",
    "<li>",
    "<p><a href=\"https://github.com/actions/toolkit/blob/main/docs/commands.md#problem-matchers\" target=\"_blank\" rel=\"noopener\">toolkit/commands.md | actions/toolkit</a></p>",
    "</li>",
    "</ul>",
    "</div>",
    "</div>",
    "</div>"
  ],
  "title": "GitHub ワークフローにおいて発生したエラーを Problem Matcher でアノテーションする",
  "created_at": "2021-01-25",
  "tags": [
    "github",
    "github-actions"
  ],
  "updated_at": "2021-01-25",
  "author": "秋々すすき",
  "revision": "1.0"
}