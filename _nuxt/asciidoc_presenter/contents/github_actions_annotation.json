{"filename":"github_actions_annotation.adoc","rendered":"<div id=\"toc\" class=\"toc\">\n<div id=\"toctitle\">目次</div>\n<ul class=\"sectlevel1\">\n<li><a href=\"#_はじめに\">はじめに🥞</a></li>\n<li><a href=\"#_github_アノテーション\"><em>GitHub</em> アノテーション🔔</a></li>\n<li><a href=\"#_problem_matchers\"><em>Problem Matchers</em> 🌡️</a>\n<ul class=\"sectlevel2\">\n<li><a href=\"#_定義\">定義</a></li>\n<li><a href=\"#_有効化無効化\">有効化/無効化</a></li>\n</ul>\n</li>\n<li><a href=\"#_おわりに\">おわりに😎</a></li>\n<li><a href=\"#_参考\">参考📖</a></li>\n</ul>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_はじめに\">はじめに🥞</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>エラー発生頻度がそれなりにある場合、いちいちワークフローの実行ログを確認するのが面倒だったので、エラーメッセージをアノテーションとして表示させたかった。</p>\n</div>\n<div class=\"paragraph\">\n<p>アノテーションを表示するには <a href=\"https://github.com/actions/toolkit/blob/main/docs/problem-matchers.md\"><em>Problem Matchers</em></a> を定義し、ワークフローで読み込めばいいらしい。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_github_アノテーション\"><em>GitHub</em> アノテーション🔔</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>UIに表示される特定のメッセージのこと。<br>\nワークフロー実行結果の下部に表示されるやつ。</p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image\"><img src=\"_images/github-apps/annotation.png\" alt=\"GitHubアノテーション\" width=\"480\" title=\"GitHubアノテーション\"></span></p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_problem_matchers\"><em>Problem Matchers</em> 🌡️</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><em>GitHub Action</em> の出力を正規表現のパターンで解析してアノテーションとして表示する機能。</p>\n</div>\n<div class=\"paragraph\">\n<p><em>Problem Matcher</em> の定義は JSONファイルに記述し、ワークフローファイルでその定義ファイルを有効化する。</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_定義\">定義</h3>\n<div class=\"paragraph\">\n<p><a href=\"https://github.com/actions/toolkit/blob/main/docs/problem-matchers.md\" target=\"_blank\" rel=\"noopener\">ここのドキュメント</a>を参考にして定義する。</p>\n</div>\n<div class=\"paragraph\">\n<p>指定する正規表現パターンではキャプチャグループ <code>()</code> を利用してファイル名や行番号、エラーメッセージなどを設定する。</p>\n</div>\n<div class=\"exampleblock\">\n<div class=\"title\">Example 1. Problem Matcherの定義例</div>\n<div class=\"content\">\n<div \n    class=\"listingblock\">\n<div class=\"title\">.github/my-problem-matcher.json</div>\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-json\"\n    data-lang=\"json\">{\n  \"problemMatcher\": [\n    {\n      \"owner\": \"this_matcher_ID\",  <i class=\"conum\" data-value=\"1\"></i><b>(1)</b>\n      \"pattern\": [\n        {\n          \"regexp\": \"^([^:]+):(\\\\d+):(\\\\d+): (.+)$\",  <i class=\"conum\" data-value=\"2\"></i><b>(2)</b>\n          \"message\": 4,  <i class=\"conum\" data-value=\"3\"></i><b>(3)</b>\n          \"file\": 1,\n          \"fromPath\": 1,\n          \"line\": 2,\n          \"column\": 3\n        }\n      ]\n    }\n  ]\n}</code></pre>\n  </div>\n</div>\n<div class=\"colist arabic\">\n<table>\n<tr>\n<td><i class=\"conum\" data-value=\"1\"></i><b>1</b></td>\n<td><strong>必須</strong>。<em>Problem Matcher</em> の <em>ID</em> として任意の名前をつける。</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"2\"></i><b>2</b></td>\n<td><strong>必須</strong>。出力から抽出する正規表現パターンを指定。<br>\nキャプチャグループを用いることで他プロパティから利用できるようにする。</td>\n</tr>\n<tr>\n<td><i class=\"conum\" data-value=\"3\"></i><b>3</b></td>\n<td><strong>必須</strong>。<code>regexp</code> のグループ番号からエラーメッセージにあたる値を指定。</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n<div class=\"admonitionblock tip\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-tip\" title=\"Tip\" data-md-icon=\"emoji_objects\"></i>\n</td>\n<td class=\"content\">\n<code>owner</code> , <code>regexp</code> , <code>message</code> が必須プロパティ。\n</td>\n</tr>\n</table>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"_有効化無効化\">有効化/無効化</h3>\n<div class=\"paragraph\">\n<p>ワークフローコマンドで <em>Problem Matcher</em> の有効・無効を制御する。</p>\n</div>\n<div class=\"dlist\">\n<dl>\n<dt class=\"hdlist1\">有効化</dt>\n<dd>\n<p><code>add-matcher</code> コマンドで定義 <em>JSON</em> ファイルを指定する。</p>\n<div \n    class=\"listingblock\">\n<div class=\"title\">ワークフローで独自 Problem Matcher を有効化</div>\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-yaml\"\n    data-lang=\"yaml\">steps:\n  - name: Enable problem matcher\n    run: echo \"::add-matcher::.github/my-problem-matcher.json\"</code></pre>\n  </div>\n</div>\n</dd>\n<dt class=\"hdlist1\">無効化</dt>\n<dd>\n<p><code>remove-matcher</code> コマンドで <em>Problem Matcher</em> の <em>ID</em> （<code>owner</code> プロパティの値）を指定する。</p>\n<div \n    class=\"listingblock\">\n<div class=\"title\">独自 Problem Matcher を無効化</div>\n  <div class=\"content\">\n  <pre class=\"highlight \" ><code class=\"language-yaml\"\n    data-lang=\"yaml\">steps:\n  - name: Disable problem matcher\n    run: echo \"::remove-matcher owner=matcher-ID::\"</code></pre>\n  </div>\n</div>\n</dd>\n</dl>\n</div>\n<div class=\"admonitionblock tip\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-tip\" title=\"Tip\" data-md-icon=\"emoji_objects\"></i>\n</td>\n<td class=\"content\">\n<code>add-matcher</code> ではファイルパスを指定、<br>\n<code>remove-matcher</code> では定義された <code>owner</code> プロパティ値を指定する。\n</td>\n</tr>\n</table>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_おわりに\">おわりに😎</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><em>Problem Matcher</em> の正規表現パターンさえ書ければアノテーションとして表示できることがわかった。</p>\n</div>\n<div class=\"paragraph\">\n<p>ワークフローのログがわかりやすくなるのでうまく利用していきたい。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_参考\">参考📖</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://github.com/actions/toolkit/blob/main/docs/problem-matchers.md\" target=\"_blank\" rel=\"noopener\">toolkit/problem-matchers.md | actions/toolkit</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/actions/toolkit/blob/main/docs/commands.md#problem-matchers\" target=\"_blank\" rel=\"noopener\">toolkit/commands.md | actions/toolkit</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>","title":"GitHub ワークフローにおいて発生したエラーを Problem Matcher でアノテーションする","created_at":"2021-01-25","tags":["github","github-actions"],"updated_at":"2021-01-25","author":"秋々すすき","revision":"1.0"}