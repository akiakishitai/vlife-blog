<!doctype html>
<html data-n-head-ssr lang="ja" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22ja%22%7D%7D">

<head>
  <title>Raspberry Pi の起動ストレージ（SD/SSD/USBメモリ）の寿命を伸ばす - Vがいる日々</title>
  <meta data-n-head="ssr" charset="utf-8">
  <meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1">
  <meta data-n-head="ssr" data-hid="description" name="description" content="Generate a static site with Nuxt.js">
  <meta data-n-head="ssr" data-hid="keywords" name="keywords" content="raspi,raspi4b,備忘録">
  <base href="/">
  <link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico">
  <link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link data-n-head="ssr" rel="alternate" type="application/atom+xml" href="/feeds/atom.xml" title="Atom 1.0">
  <link rel="preload" href="/_nuxt/0e5221e.js" as="script">
  <link rel="preload" href="/_nuxt/8f5170d.js" as="script">
  <link rel="preload" href="/_nuxt/css/0f5c967.css" as="style">
  <link rel="preload" href="/_nuxt/4fde5eb.js" as="script">
  <link rel="preload" href="/_nuxt/css/9f3c58f.css" as="style">
  <link rel="preload" href="/_nuxt/61ba754.js" as="script">
  <link rel="preload" href="/_nuxt/css/87938c0.css" as="style">
  <link rel="preload" href="/_nuxt/cf45fea.js" as="script">
  <link rel="preload" href="/_nuxt/css/63ee372.css" as="style">
  <link rel="preload" href="/_nuxt/73d1167.js" as="script">
  <link rel="stylesheet" href="/_nuxt/css/0f5c967.css">
  <link rel="stylesheet" href="/_nuxt/css/9f3c58f.css">
  <link rel="stylesheet" href="/_nuxt/css/87938c0.css">
  <link rel="stylesheet" href="/_nuxt/css/63ee372.css">
  <link rel="preload" href="/_nuxt/static/1675073036/posts/raspi_extend_life_of_storage/state.js" as="script">
  <link rel="preload" href="/_nuxt/static/1675073036/posts/raspi_extend_life_of_storage/payload.js" as="script">
  <link rel="preload" href="/_nuxt/static/1675073036/manifest.js" as="script">
</head>

<body>
  <div data-server-rendered="true" id="__nuxt"><!---->
    <div id="__layout">
      <div class="min-h-screen flex flex-col items-center mx-auto bg-background">
        <header class="mdc-top-app-bar relative" data-v-357cda0d>
          <div class="mdc-top-app-bar__row" data-v-357cda0d>
            <div class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start" data-v-357cda0d><a href="/" class="mdc-top-app-bar__title nuxt-link-active" data-v-357cda0d>Vがいる日々</a></div>
            <nav class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" data-v-357cda0d>
              <ul class="flex" data-v-357cda0d>
                <li data-v-357cda0d><a href="/" class="mdc-top-app-bar__action-item p-2 rounded-t hover:bg-grey-500 hover:bg-opacity-15" data-v-357cda0d>Home</a></li>
                <li class="ml-2" data-v-357cda0d><a href="/license" class="mdc-top-app-bar__action-item p-2 rounded-t hover:bg-grey-500 hover:bg-opacity-15" data-v-357cda0d>License</a></li>
              </ul>
              <ul class="flex ml-4" data-v-357cda0d>
                <li class="flex items-center" data-v-357cda0d><a href="https://twitter.com/akiakiS101" target="_blank" class="material-icons mdc-top-app-bar__action-item mdc-icon-button" data-v-357cda0d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current" data-v-357cda0d data-v-49dc8ae1>
                      <title data-v-4b4cfb63>Twitter account</title>
                      <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" data-v-4b4cfb63></path>
                    </svg></a></li>
                <li class="flex items-center" data-v-357cda0d><a href="https://github.com/akiakishitai/vlife-blog" target="_blank" class="material-icons mdc-top-app-bar__action-item mdc-icon-button" data-v-357cda0d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current" data-v-357cda0d data-v-f1b30468>
                      <title data-v-4b4cfb63>Github source</title>
                      <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" data-v-4b4cfb63></path>
                    </svg></a></li>
              </ul>
            </nav>
          </div>
        </header>
        <main class="container flex-grow text-black text-opacity-87 px-4">
          <div class="pb-6 mt-6" data-v-346bb96f>
            <h1 class="text-4xl font-light">Raspberry Pi の起動ストレージ（SD/SSD/USBメモリ）の寿命を伸ばす</h1>
            <div class="mt-4">
              <div role="table" class="mdc-chip-set" data-v-78553c6c><a href="/search?tags=raspi">
                  <div role="row" class="mdc-chip" data-v-78553c6c>
                    <div class="mdc-chip__ripple" data-v-1a8ed682></div> <i role="cell" class="material-icons mdc-chip__icon mdc-chip__icon--leading" data-v-1a8ed682>local_offer</i> <span role="cell" data-v-1a8ed682><span role="button" tabindex="0" class="mdc-chip__primary-action" data-v-1a8ed682><span class="mdc-chip__text" data-v-1a8ed682>raspi</span></span></span>
                  </div>
                </a><a href="/search?tags=raspi4b">
                  <div role="row" class="mdc-chip" data-v-78553c6c>
                    <div class="mdc-chip__ripple" data-v-1a8ed682></div> <i role="cell" class="material-icons mdc-chip__icon mdc-chip__icon--leading" data-v-1a8ed682>local_offer</i> <span role="cell" data-v-1a8ed682><span role="button" tabindex="0" class="mdc-chip__primary-action" data-v-1a8ed682><span class="mdc-chip__text" data-v-1a8ed682>raspi4b</span></span></span>
                  </div>
                </a><a href="/search?tags=%E5%82%99%E5%BF%98%E9%8C%B2">
                  <div role="row" class="mdc-chip" data-v-78553c6c>
                    <div class="mdc-chip__ripple" data-v-1a8ed682></div> <i role="cell" class="material-icons mdc-chip__icon mdc-chip__icon--leading" data-v-1a8ed682>local_offer</i> <span role="cell" data-v-1a8ed682><span role="button" tabindex="0" class="mdc-chip__primary-action" data-v-1a8ed682><span class="mdc-chip__text" data-v-1a8ed682>備忘録</span></span></span>
                  </div>
                </a></div>
              <div class="flex justify-end">
                <div class="flex items-center"><span class="material-icons text-xl opacity-87">create</span>
                  <div class="pl-1">2021年09月24日</div>
                </div>
                <div class="flex items-center ml-2"><span class="material-icons text-xl opacity-87">update</span>
                  <div class="pl-1">2021年09月24日</div>
                </div>
              </div>
            </div>
            <hr class="mt-2 border-grey-500"> <!---->
            <div class="mt-6">
              <div class="post-body line-numbers">
                <div id="toc" class="toc">
                  <div id="toctitle">目次</div>
                  <ul class="sectlevel1">
                    <li><a href="/posts/raspi_extend_life_of_storage#_はじめに">🥧はじめに</a></li>
                    <li><a href="/posts/raspi_extend_life_of_storage#_スワップの調整">🗃️スワップの調整</a></li>
                    <li><a href="/posts/raspi_extend_life_of_storage#_マウントオプションから_atime_を除外する">🔪マウントオプションから <code>atime</code> を除外する</a></li>
                    <li><a href="/posts/raspi_extend_life_of_storage#_ログ">📊ログ</a>
                      <ul class="sectlevel2">
                        <li><a href="/posts/raspi_extend_life_of_storage#_tmpfs_を使ってメモリ上にログを出力する"><code>tmpfs</code> を使ってメモリ上にログを出力する</a></li>
                        <li><a href="/posts/raspi_extend_life_of_storage#_ログの出力を抑制">ログの出力を抑制</a></li>
                        <li><a href="/posts/raspi_extend_life_of_storage#_systemd_の_journal_ログ">systemd の journal ログ</a></li>
                      </ul>
                    </li>
                    <li><a href="/posts/raspi_extend_life_of_storage#_参考">📖参考</a></li>
                  </ul>
                </div>
                <div id="preamble">
                  <div class="sectionbody">
                    <table class="tableblock frame-all grid-all fit-content">
                      <caption class="title">Table 1. 環境</caption>
                      <colgroup>
                        <col>
                        <col>
                      </colgroup>
                      <thead>
                        <tr>
                          <th class="tableblock halign-left valign-top"></th>
                          <th class="tableblock halign-left valign-top">Version</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock">Raspberry Pi 4B</p>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock">4GB</p>
                          </td>
                        </tr>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock">Raspberry Pi OS Lite</p>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock">Debian 10 (buster) 64bit</p>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="sect1">
                  <h2 id="_はじめに">🥧はじめに</h2>
                  <div class="sectionbody">
                    <div class="paragraph">
                      <p><em>Raspberry Pi 4B</em> で、起動ストレージへの書き込みを抑えて寿命を伸ばすために行ったことの備忘録。</p>
                    </div>
                  </div>
                </div>
                <div class="sect1">
                  <h2 id="_スワップの調整">🗃️スワップの調整</h2>
                  <div class="sectionbody">
                    <div class="paragraph">
                      <p>スワップはストレージの予約領域で読み書きを行うため、理論的には無効化したほうがストレージ寿命を伸ばせる。</p>
                    </div>
                    <div class="paragraph">
                      <p>ただし、</p>
                    </div>
                    <div class="ulist">
                      <ul>
                        <li>
                          <p>スワップはメモリの利用について最適化する</p>
                        </li>
                        <li>
                          <p>無効化するとシステムが不安定になる恐れがある</p>
                        </li>
                      </ul>
                    </div>
                    <div class="paragraph">
                      <p>という点から、無効化ではなくサイズを調整する方法をとった。</p>
                    </div>
                    <div class="exampleblock">
                      <div class="title">Example 1. スワップサイズの変更</div>
                      <div class="content">
                        <div class="admonitionblock note">
                          <table>
                            <tr>
                              <td class="icon">
                                <i class="fa icon-note" title="Note" data-md-icon="info"></i>
                              </td>
                              <td class="content">
                                <div class="title">推奨サイズについて</div> サーバーとしての利用＆メモリ 2GB 以上 → とりあえずメモリの半分でいい（参考：<a href="https://help.ubuntu.com/community/SwapFaq" target="_blank" rel="noopener">SwapFaq - Community Help Wiki</a>）。<br> あとはシステムの利用状況を見て増減しておく。
                              </td>
                            </tr>
                          </table>
                        </div>
                        <div class="paragraph">
                          <p>変更する場合は <a href="https://manpages.debian.org/buster/dphys-swapfile/dphys-swapfile.8.en.html" target="_blank" rel="noopener"><code>/etc/dphys-swapfile</code></a> ファイルを修正する。</p>
                        </div>
                        <div class="listingblock">
                          <div class="title">/etc/dphys-swapfile</div>
                          <div class="content">
                            <pre class="highlight"><code class="language-ini" data-lang="ini">CONF_SWAPSIZE=100   <i class="conum" data-value="1"></i><b>(1)</b>
CONF_SWAPFILE=/var/swap     <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
                          </div>
                        </div>
                        <div class="colist arabic">
                          <table>
                            <tr>
                              <td><i class="conum" data-value="1"></i><b>1</b></td>
                              <td><strong>MB</strong> 単位でスワップサイズを指定。<br> 👉 推奨サイズと異なるが、現在システムがメモリをほとんど使ってないので少なくしている。</td>
                            </tr>
                            <tr>
                              <td><i class="conum" data-value="2"></i><b>2</b></td>
                              <td>USBや外付けドライブにスワップファイルを保存したい場合はここのパスを変更する。</td>
                            </tr>
                          </table>
                        </div>
                        <div class="listingblock no-line-numbers command-line">
                          <div class="title">変更したスワップ設定を適用</div>
                          <div class="content">
                            <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="2-10"><code class="language-bash" data-lang="bash">sudo service dphys-swapfile restart</code></pre>
                          </div>
                        </div>
                        <div class="listingblock no-line-numbers command-line">
                          <div class="title">スワップの確認</div>
                          <div class="content">
                            <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="2-10"><code class="language-bash" data-lang="bash">swapon --show=NAME,TYPE,SIZE,USED
NAME      TYPE SIZE USED
/var/swap file 100M   0B</code></pre>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="sect1">
                  <h2 id="_マウントオプションから_atime_を除外する">🔪マウントオプションから <code>atime</code> を除外する</h2>
                  <div class="sectionbody">
                    <div class="paragraph">
                      <p><code>atime</code> だと頻繁に書き込み処理が発生するため、代わりに <code>noatime</code> や <code>relatime</code> を使用する。</p>
                    </div>
                    <div class="admonitionblock note">
                      <table>
                        <tr>
                          <td class="icon">
                            <i class="fa icon-note" title="Note" data-md-icon="info"></i>
                          </td>
                          <td class="content">
                            <div class="paragraph">
                              <p>ただ、最初から <code>noatime</code> に設定されているかも。</p>
                            </div>
                            <div class="listingblock no-line-numbers command-line">
                              <div class="title">マウントオプションの確認</div>
                              <div class="content">
                                <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="2-10"><code class="language-bash" data-lang="bash">findmnt --target /
TARGET SOURCE    FSTYPE OPTIONS
/      /dev/sda2 ext4   rw,<strong class="text-red-400">noatime</strong></code></pre>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </table>
                    </div>
                    <div class="exampleblock">
                      <div class="title">Example 2. /etc/fstab からマウントオプションを変更</div>
                      <div class="content">
                        <div class="listingblock no-line-numbers command-line">
                          <div class="title">/etc/fstab のサンプル</div>
                          <div class="content">
                            <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="2-10"><code class="language-ini" data-lang="ini"># Use noatime option
tmpfs   /tmp            tmpfs   rw,async,nodev,nosuid,<strong class="text-red-400 underline">noatime</strong>,size=256M,mode=0777               0 0
tmpfs   /var/log        tmpfs   rw,async,noexec,nodev,nosuid,<strong class="text-red-400 underline">noatime</strong>,size=64M,mode=0755         0 0</code></pre>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="admonitionblock tip">
                      <table>
                        <tr>
                          <td class="icon">
                            <i class="fa icon-tip" title="Tip" data-md-icon="emoji_objects"></i>
                          </td>
                          <td class="content">
                            <div class="title">アクセス日時情報について</div>
                            <div class="dlist">
                              <dl>
                                <dt class="hdlist1">atime</dt>
                                <dd>
                                  <p>ファイルが読み込まれる度にアクセス日時を書き込む。</p>
                                </dd>
                                <dt class="hdlist1">noatime</dt>
                                <dd>
                                  <p>アクセス日時を一切書き込まない。</p>
                                </dd>
                                <dt class="hdlist1">relatime</dt>
                                <dd>
                                  <p>ファイルに変更があった時だけアクセス日時を書き込む。<br>
                                    <code>noatime</code> ではうまく動かないプログラムがある場合に有効。
                                  </p>
                                </dd>
                              </dl>
                            </div>
                          </td>
                        </tr>
                      </table>
                    </div>
                  </div>
                </div>
                <div class="sect1">
                  <h2 id="_ログ">📊ログ</h2>
                  <div class="sectionbody">
                    <div class="sect2">
                      <h3 id="_tmpfs_を使ってメモリ上にログを出力する"><code>tmpfs</code> を使ってメモリ上にログを出力する</h3>
                      <div class="paragraph">
                        <p>事あるごとにログをストレージに書き込むことを止めさせ、代わりにメモリ上へ出力するようにさせる。<br> 👉 <code>/var/log</code>（とついでに <code>/tmp</code>）を <code>tmpfs</code> でマウントすればいい。</p>
                      </div>
                      <div class="admonitionblock caution">
                        <table>
                          <tr>
                            <td class="icon">
                              <i class="fa icon-caution" title="Caution" data-md-icon="local_fire_department"></i>
                            </td>
                            <td class="content"> この作業を行うと電源を落とす度にログが消えてしまうことに注意する。 </td>
                          </tr>
                        </table>
                      </div>
                      <div class="admonitionblock note">
                        <table>
                          <tr>
                            <td class="icon">
                              <i class="fa icon-note" title="Note" data-md-icon="info"></i>
                            </td>
                            <td class="content">
                              <div class="paragraph">
                                <p>やっぱりログを保存しておきたいという場合は、以下のような方法が考えられる。</p>
                              </div>
                              <div class="ulist">
                                <ul>
                                  <li>
                                    <p><code>rsyslog</code> サーバーを構築して、そこへログを転送させる</p>
                                  </li>
                                  <li>
                                    <p>ログ保存用のUSBメモリとかを用意して、そこへログを出力する</p>
                                  </li>
                                  <li>
                                    <p><code>Logwatch</code> などのログ収集ツールを使う。</p>
                                  </li>
                                </ul>
                              </div>
                            </td>
                          </tr>
                        </table>
                      </div>
                      <div class="exampleblock">
                        <div class="title">Example 3. tmpfs としてマウントさせる設定</div>
                        <div class="content">
                          <div class="paragraph">
                            <p><code>/var/log</code> と <code>/tmp</code> を <code>tmpfs</code> としてマウントするよう設定変更する。</p>
                          </div>
                          <div class="listingblock">
                            <div class="title">/etc/fstab に下記を追記</div>
                            <div class="content">
                              <pre class="highlight"><code class="language-ini" data-lang="ini">### ADD custom tmpfs
tmpfs /tmp      tmpfs  rw,async,nodev,nosuid,noatime,size=256M,mode=0777        0 0
tmpfs /var/log  tmpfs  rw,async,noexec,nodev,nosuid,noatime,size=64M,mode=0755  0 0</code></pre>
                            </div>
                          </div>
                          <div class="listingblock no-line-numbers command-line">
                            <div class="title">ログのバックアップを取っておく</div>
                            <div class="content">
                              <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="7"><code class="language-bash" data-lang="bash">sudo tar \      <i class="conum" data-value="1"></i><b>(1)</b>
    -czf /var/early-logs.tar.gz \
    --directory=/var/log .
sudo rm -rf /var/log/*      <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
                            </div>
                          </div>
                          <div class="colist arabic">
                            <table>
                              <tr>
                                <td><i class="conum" data-value="1"></i><b>1</b></td>
                                <td>現在の <code>/var/log</code> を圧縮してバックアップする。</td>
                              </tr>
                              <tr>
                                <td><i class="conum" data-value="2"></i><b>2</b></td>
                                <td>バックアップ後、<code>/var/log</code> を空にする。<br> 👉 空ディレクトリ以外に <code>tmpfs</code> をマウントしようとするとエラーが発生するため。</td>
                              </tr>
                            </table>
                          </div>
                        </div>
                      </div>
                      <div class="exampleblock">
                        <div class="title">Example 4. systemdサービスの修正</div>
                        <div class="content">
                          <div class="listingblock no-line-numbers command-line">
                            <div class="title">エラー対策に rsyslog.service を修正</div>
                            <div class="content">
                              <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="2,4-20"><code class="language-bash" data-lang="bash">sudo systemctl edit rsyslog.service</code></pre>
                            </div>
                          </div>
                          <div class="listingblock">
                            <div class="content">
                              <pre class="highlight"><code class="language-ini" data-lang="ini">[Unit]
After=local-fs.target   <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
                            </div>
                          </div>
                          <div class="colist arabic">
                            <table>
                              <tr>
                                <td><i class="conum" data-value="1"></i><b>1</b></td>
                                <td><code>fstab</code> の処理が終わってから <code>rsyslog.service</code> が起動するように修正。</td>
                              </tr>
                            </table>
                          </div>
                          <div class="listingblock no-line-numbers command-line">
                            <div class="title">修正した設定を適用</div>
                            <div class="content">
                              <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="2-10"><code class="language-bash" data-lang="bash">sudo systemctl daemon-reload</code></pre>
                            </div>
                          </div>
                        </div>
                      </div>
                      <hr>
                      <div class="paragraph">
                        <p>上記設定後、再起動して適用する。</p>
                      </div>
                      <div class="listingblock no-line-numbers command-line">
                        <div class="title">再起動して設定を適用</div>
                        <div class="content">
                          <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="2,4-10"><code class="language-bash" data-lang="bash">sudo reboot

findmnt --target /var/log   <i class="conum" data-value="1"></i><b>(1)</b>
TARGET   SOURCE FSTYPE OPTIONS
/var/log tmpfs  tmpfs  rw,nosuid,nodev,noexec,noatime,size=65536k,mode=755</code></pre>
                        </div>
                      </div>
                      <div class="colist arabic">
                        <table>
                          <tr>
                            <td><i class="conum" data-value="1"></i><b>1</b></td>
                            <td><code>/var/log</code> のマウントオプションが変更されているか確認。</td>
                          </tr>
                        </table>
                      </div>
                    </div>
                    <div class="sect2">
                      <h3 id="_ログの出力を抑制">ログの出力を抑制</h3>
                      <div class="exampleblock">
                        <div class="content">
                          <div class="listingblock no-line-numbers command-line">
                            <div class="title">rsyslog 設定を修正</div>
                            <div class="content">
                              <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="3"><code class="language-bash" data-lang="bash">sudo cp /etc/rsyslog.conf{,.bk}
sudo nano /etc/rsyslog.conf</code></pre>
                            </div>
                          </div>
                          <div class="listingblock">
                            <div class="title">デバッグ情報とプリンタ・メールのログは出力しない</div>
                            <div class="content">
                              <pre class="highlight"><code class="language-diff" data-lang="diff">diff -U 0 --label before --label after /etc/rsyslog.conf{.bk,}
--- before
+++ after
@@ -62 +62 @@
-*.*;auth,authpriv.none         -/var/log/syslog
+*.info;auth,authpriv.none      -/var/log/syslog
@@ -64,5 +64,5 @@
-daemon.*                       -/var/log/daemon.log
-kern.*                         -/var/log/kern.log
-lpr.*                          -/var/log/lpr.log
-mail.*                         -/var/log/mail.log
-user.*                         -/var/log/user.log
+daemon.warn                    -/var/log/daemon.log
+kern.warn                      -/var/log/kern.log
+#lpr.*                         -/var/log/lpr.log
+#mail.*                        -/var/log/mail.log
+user.warn                      -/var/log/user.log
@@ -74 +74 @@
-mail.info                      -/var/log/mail.info
+#mail.info                     -/var/log/mail.info
@@ -81,3 +81,3 @@
-*.=debug;\
-       auth,authpriv.none;\
-       news.none;mail.none     -/var/log/debug
+#*.=debug;\
+#      auth,authpriv.none;\
+#      news.none;mail.none     -/var/log/debug</code></pre>
                            </div>
                          </div>
                          <div class="listingblock no-line-numbers command-line">
                            <div class="title">変更したログ設定を適用</div>
                            <div class="content">
                              <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="2-10"><code class="language-bash" data-lang="bash">sudo service rsyslog restart</code></pre>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="sect2">
                      <h3 id="_systemd_の_journal_ログ">systemd の journal ログ</h3>
                      <div class="paragraph">
                        <p>デフォルトで <code>/run/log/journal</code> に保存される。<br>
                          <code>/run</code> は <code>tmpfs</code> なので、何もする必要がない。そのままでOK。
                        </p>
                      </div>
                      <div class="listingblock no-line-numbers command-line">
                        <div class="content">
                          <pre class="highlight command-line" data-user="pi" data-host="raspi" data-output="2-10"><code class="language-bash" data-lang="bash">findmnt --target /run/log/journal
TARGET SOURCE FSTYPE OPTIONS
/run   tmpfs  tmpfs  rw,nosuid,nodev,mode=755</code></pre>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="sect1">
                  <h2 id="_参考">📖参考</h2>
                  <div class="sectionbody">
                    <div class="ulist">
                      <div class="title">tmpfs</div>
                      <ul>
                        <li>
                          <p><a href="https://qiita.com/girlfellfromsky/items/953ad71ad6ed09a97dfe" target="_blank" rel="noopener">ラズパイでログディレクトリをRAM DISKに移行する手順の簡略化 - Qiita</a></p>
                        </li>
                      </ul>
                    </div>
                    <div class="ulist">
                      <div class="title">swap</div>
                      <ul>
                        <li>
                          <p><a href="https://help.ubuntu.com/community/SwapFaq" target="_blank" rel="noopener">SwapFaq - Community Help Wiki</a></p>
                        </li>
                        <li>
                          <p><a href="https://manpages.debian.org/buster/dphys-swapfile/dphys-swapfile.8.en.html" target="_blank" rel="noopener">dphys-swapfile(8) — dphys-swapfile — Debian buster — Debian Manpages</a></p>
                        </li>
                      </ul>
                    </div>
                    <div class="ulist">
                      <div class="title">rsyslog</div>
                      <ul>
                        <li>
                          <p><a href="https://knowledge.sakura.ad.jp/8969/" target="_blank" rel="noopener">多機能なログ管理システム「rsyslog」の基本的な設定 | さくらのナレッジ</a></p>
                        </li>
                      </ul>
                    </div>
                    <div class="ulist">
                      <div class="title">logrotate</div>
                      <ul>
                        <li>
                          <p><a href="https://linux.die.net/man/8/logrotate" target="_blank" rel="noopener">logrotate(8) - Linux man page</a></p>
                        </li>
                        <li>
                          <p><a href="https://qiita.com/Esfahan/items/a8058f1eb593170855a1" target="_blank" rel="noopener">任意のログをlogrotateを使って管理する - Qiita</a></p>
                        </li>
                      </ul>
                    </div>
                    <div class="ulist">
                      <div class="title">mount</div>
                      <ul>
                        <li>
                          <p><a href="https://wiki.archlinux.jp/index.php/Fstab" target="_blank" rel="noopener">fstab - ArchWiki</a></p>
                        </li>
                        <li>
                          <p><a href="https://linux.die.net/man/8/mount" target="_blank" rel="noopener">mount(8): mount filesystem - Linux man page</a></p>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="share-buttons mt-8">
              <ul class="flex items-center justify-center" data-v-6cf1db65>
                <li class="share-button ml-4 first:ml-0" data-v-6cf1db65>
                  <div data-v-6cf1db65 data-v-6b9fb88e>
                    <div rel="nofollow" class="share-button rounded-md w-10 h-10 p-2" data-v-6b9fb88e>
                      <div data-v-6cf1db65 data-v-6b9fb88e><a href="https://twitter.com/intent/tweet?text=Raspberry+Pi+%E3%81%AE%E8%B5%B7%E5%8B%95%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%EF%BC%88SD%2FSSD%2FUSB%E3%83%A1%E3%83%A2%E3%83%AA%EF%BC%89%E3%81%AE%E5%AF%BF%E5%91%BD%E3%82%92%E4%BC%B8%E3%81%B0%E3%81%99&url=https%3A%2F%2Fvlike-vlife.netlify.app%2Fposts%2Fraspi_extend_life_of_storage" target="_blank" class="material-icons mdc-icon-button w-full h-full" data-v-6cf1db65 data-v-0c784d82><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current" data-v-6cf1db65 data-v-6b9fb88e>
                            <title data-v-4b4cfb63>Twitter</title>
                            <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" data-v-4b4cfb63></path>
                          </svg></a></div>
                    </div>
                  </div>
                </li>
                <li class="share-button ml-4 first:ml-0" data-v-6cf1db65>
                  <div data-v-6cf1db65 data-v-083f3255>
                    <div rel="nofollow" class="share-button rounded-md w-10 h-10 p-2" data-v-083f3255>
                      <div data-v-6cf1db65 data-v-083f3255><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fvlike-vlife.netlify.app%2Fposts%2Fraspi_extend_life_of_storage" target="_blank" class="material-icons mdc-icon-button w-full h-full" data-v-6cf1db65 data-v-0c784d82><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current" data-v-6cf1db65 data-v-083f3255>
                            <title data-v-4b4cfb63>Facebook</title>
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" data-v-4b4cfb63></path>
                          </svg></a></div>
                    </div>
                  </div>
                </li>
                <li class="share-button ml-4 first:ml-0" data-v-6cf1db65>
                  <div data-v-6cf1db65 data-v-a2dd0576>
                    <div rel="nofollow" class="share-button rounded-md w-10 h-10 p-2" data-v-a2dd0576>
                      <div data-v-6cf1db65 data-v-a2dd0576><a href="https://getpocket.com/edit?url=https%3A%2F%2Fvlike-vlife.netlify.app%2Fposts%2Fraspi_extend_life_of_storage" target="_blank" class="material-icons mdc-icon-button w-full h-full" data-v-6cf1db65 data-v-0c784d82><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current" data-v-6cf1db65 data-v-a2dd0576>
                            <title data-v-4b4cfb63>Pocket</title>
                            <path d="M18.813 10.259l-5.646 5.419c-.32.305-.73.458-1.141.458-.41 0-.821-.153-1.141-.458l-5.646-5.419c-.657-.628-.677-1.671-.049-2.326.63-.657 1.671-.679 2.325-.05l4.511 4.322 4.517-4.322c.66-.631 1.697-.607 2.326.049.631.645.615 1.695-.045 2.326l-.011.001zm5.083-7.546c-.299-.858-1.125-1.436-2.041-1.436H2.179c-.9 0-1.717.564-2.037 1.405-.094.25-.142.511-.142.774v7.245l.084 1.441c.348 3.277 2.047 6.142 4.682 8.139.045.036.094.07.143.105l.03.023c1.411 1.03 2.989 1.728 4.694 2.072.786.158 1.591.24 2.389.24.739 0 1.481-.067 2.209-.204.088-.029.176-.045.264-.06.023 0 .049-.015.074-.029 1.633-.36 3.148-1.036 4.508-2.025l.029-.031.135-.105c2.627-1.995 4.324-4.862 4.686-8.148L24 10.678V3.445c0-.251-.031-.5-.121-.742l.017.01z" data-v-4b4cfb63></path>
                          </svg></a></div>
                    </div>
                  </div>
                </li>
                <li class="share-button ml-4 first:ml-0" data-v-6cf1db65>
                  <div data-v-6cf1db65 data-v-492a0c04>
                    <div rel="nofollow" class="share-button rounded-md w-10 h-10 p-2" data-v-492a0c04>
                      <div data-v-6cf1db65 data-v-492a0c04><button class="material-icons mdc-icon-button w-full h-full" data-v-6cf1db65 data-v-0c784d82><span title="Copy URL" class="material-icons" data-v-6cf1db65>link</span></button></div>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <ul class="grid grid-cols-2 gap-12 border-t border-b border-grey-500 py-2 mt-6">
              <li class="flex items-center justify-end"><a href="/posts/podman_unshare" class="link inline-flex justify-center px-4"><span>podman unshare コマンドを使ってコンテナから作成したファイルのパーミッション問題を解決する</span></a> <span class="material-icons transform rotate-180">double_arrow</span></li>
              <li class="flex items-center fustify-start"><span class="material-icons">double_arrow</span> <a href="/posts/linux_bash_completion" class="link inline-flex justify-center px-4"><span>bash の補完スクリプト（bash-completion）ファイルってどこに配置すればいいの？</span></a></li>
            </ul>
          </div>
        </main>
        <footer class="footerbar mt-8" data-v-a0bb2a58>
          <ul class="flex justify-center items-center" data-v-a0bb2a58>
            <li data-v-a0bb2a58><a href="/" class="p-2 block nuxt-link-active" data-v-a0bb2a58>Home</a></li>
            <li data-v-a0bb2a58><a href="/contact" class="p-2 block" data-v-a0bb2a58>お問い合わせ</a></li>
            <li data-v-a0bb2a58><a href="/privacy-policy" class="p-2 block" data-v-a0bb2a58>プライバシーポリシー</a></li>
            <li class="mx-4 absolute right-0" data-v-a0bb2a58><a href="/feeds/atom.xml" title="atom 1.0" class="p-2 block" data-v-a0bb2a58><span class="material-icons" data-v-a0bb2a58>rss_feed</span></a></li>
          </ul>
        </footer>
      </div>
    </div>
  </div>
  <script defer src="/_nuxt/static/1675073036/posts/raspi_extend_life_of_storage/state.js"></script>
  <script src="/_nuxt/0e5221e.js" defer></script>
  <script src="/_nuxt/cf45fea.js" defer></script>
  <script src="/_nuxt/73d1167.js" defer></script>
  <script src="/_nuxt/8f5170d.js" defer></script>
  <script src="/_nuxt/4fde5eb.js" defer></script>
  <script src="/_nuxt/61ba754.js" defer></script>
</body>

</html>
