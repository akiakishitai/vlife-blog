= Git LFS での管理を停止する
秋々すすき
v1.0, 2020-11-20
:created_at: 2020-11-20
:tags: git, git-lfs
:toc: left
:toc-title: 目次
:toclevels: 3
include::commons/attrs.adoc[]

== 動機😣
:site-1: https://www.gitlab.jp/blog/2020/07/10/how-to-migrate-git-lfs/[小さな画像ファイルはGit LFSで管理しない方がよい理由 | GitLab.JP^]

_Git LFS_ について

[quote,,'{site-1}']
____
サイズが数百キロバイト程度の画像ファイルを _Git LFS_ で管理することは、メリットよりもデメリットの方が大きくなる可能性が高いのでやめたほうがよいでしょう。

特に、画像ファイルが少ないはじめのうちは問題がないようでも、 画像ファイルが増えるにつれて clone や checkout の速度が遅くなるなどの問題が発生する可能性があるので注意が必要です。
____

という話があるので、小さい画像ファイルでも _Git LFS_ 管理してたのをやめることにした。

.環境
[autowidth]
|===
|App |Version

|git
|2.20.1

|git-lfs
|2.7.1
|===

== _Git LFS_ 管理をやめる手順🏃

. _Git LFS_ 管理対象のファイルを確認
+
[.command-line.no-line-numbers]
[source,bash,data-user="user",data-host="local"]
----
git lfs ls-files
----

. _Git LFS_ アンインストール
+
.Git LFS アンインストールのコマンド例
[attributes]
====

[.command-line.no-line-numbers]
[source,bash,data-user="user",data-host="local"]
----
git lfs untrack '*.png' '*.jpg' '*.jpeg'  # <1>
git rm --cached path/to/file1 path/to/file2  # <2>
git lfs uninstall  # <3>
----
<1> _Git LFS_ の追跡パターンを（ `.gitattributes` から）削除
<2> 現在の Git 管理対象からバイナリファイルを削除
<3> _Git LFS_ の _Hook_ や設定をアンインストール
====
+
.履歴からも消して綺麗にする場合
[WARNING]
====
`git rm` の代わりに下記コマンドを実行。
全履歴を書き換えて対象ファイルを無かったコトにするため、リモートリポジトリには強制上書き（ `git push -f` ）が必要になる。

[source,bash]
----
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch path/to/file1 path/to/file2" \
  --prune-empty --tag-name-filter cat -- --all
----
====

. _Git LFS_ アンインストール後のファイルをコミットし直す
+
[.command-line.no-line-numbers]
[source,bash,data-user="user",data-host="local"]
----
git add .
git commit
----

***

以上で _Git LFS_ 管理の停止完了😎。

== 参考📖

* {site-1}
* https://docs.github.com/ja/free-pro-team@latest/github/managing-large-files/removing-files-from-git-large-file-storage[ファイルを Git Large File Storage から削除する - GitHub Docs^]
